(()=>{"use strict";var e={751999:(e,r,t)=>{t.r(r);var o=t(477966),a=t(990526),s=t(54096),n=t(431437),c=t(737028),i=t(254725),l=t(610196),u=t(261317),d=t(263616),p=t(752066),g=t(804516),f=t(684802),y=t(145916),b=t(61960);globalThis.sqlite3Worker1Promiser=function e(r=e.defaultConfig){if(1===arguments.length&&"function"===typeof arguments[0]){const t=r;(r=Object.assign(Object.create(null),e.defaultConfig)).onready=t}else r=Object.assign(Object.create(null),e.defaultConfig,r);const t=Object.create(null),o=function(){},a=r.onerror||o,s=r.debug||o,n=r.generateMessageId?void 0:Object.create(null),c=r.generateMessageId||function(e){return e.type+"#"+(n[e.type]=(n[e.type]||0)+1)},i=(...e)=>{throw new Error(e.join(" "))};let l,u;return r.worker||(r.worker=e.defaultConfig.worker),"function"===typeof r.worker&&(r.worker=r.worker()),r.worker.onmessage=function(e){e=e.data,s("worker1.onmessage",e);let o=t[e.messageId];if(!o)return e&&"sqlite3-api"===e.type&&"worker1-ready"===e.result?void(r.onready&&r.onready(u)):(o=t[e.type],o&&o.onrow?void o.onrow(e):void(r.onunhandled?r.onunhandled(arguments[0]):a("sqlite3Worker1Promiser() unhandled worker message:",e)));switch(delete t[e.messageId],e.type){case"error":return void o.reject(e);case"open":l||(l=e.dbId);break;case"close":e.dbId===l&&(l=void 0)}try{o.resolve(e)}catch(n){o.reject(n)}},u=function(){let e;1===arguments.length?e=arguments[0]:2===arguments.length?(e=Object.create(null),e.type=arguments[0],e.args=arguments[1],e.dbId=e.args.dbId):i("Invalid arguments for sqlite3Worker1Promiser()-created factory."),e.dbId||"open"===e.type||(e.dbId=l),e.messageId=c(e),e.departureTime=performance.now();const o=Object.create(null);let a;o.message=e,"exec"===e.type&&e.args&&("function"===typeof e.args.callback?(a=e.messageId+":row",o.onrow=e.args.callback,e.args.callback=a,t[a]=o):"string"===typeof e.args.callback&&i("exec callback may not be a string when using the Promise interface."));let n=new Promise((function(a,n){o.resolve=a,o.reject=n,t[e.messageId]=o,s("Posting",e.type,"message to Worker dbId="+(l||"default")+":",e),r.worker.postMessage(e)}));return a&&(n=n.finally((()=>delete t[a]))),n}},globalThis.sqlite3Worker1Promiser.defaultConfig={worker:function(){return new Worker(new URL(t.p+t.u(104),t.b),{type:void 0})},onerror:(...e)=>console.error("worker1 promiser error",...e)},sqlite3Worker1Promiser.v2=function(e){let r;"function"==typeof e?(r=e,e={}):"function"===typeof e?.onready&&(r=e.onready,delete e.onready);const t=Object.create(null);e=Object.assign(e||Object.create(null),{onready:async function(e){try{r&&await r(e),t.resolve(e)}catch(o){t.reject(o)}}});const o=new Promise((function(e,r){t.resolve=e,t.reject=r}));try{this.original(e)}catch(a){t.reject(a)}return o}.bind({original:sqlite3Worker1Promiser});sqlite3Worker1Promiser.v2,self.sqlite3Worker1Promiser;const m=b.default;var v=t(562635),w=t(361369);globalThis.sqlite3ApiConfig={warn:w.constVoid};const h=i.effect(s.SqliteFactory,c.gen((function*(){const e=yield*p.NanoIdGenerator,r=m();return s.SqliteFactory.of({createSqlite:c.gen((function*(){const t=yield*c.flatMap((0,g.getLockName)("SqliteBroadcastChannel"),k);t.onMessage=e=>{switch(e._tag){case"Exec":o=[...o,e];break;case"ExecError":case"ExecSuccess":o=v.filter(o,(r=>r.id!==e.id)),a(e);break;default:(0,w.absurd)(e)}};let o=[];const a=e=>{const r=n.get(e.id);r&&(r(e),n.delete(e.id))},n=new Map,i=yield*f.Config,l=(0,f.createRuntime)(i);c.logTrace("SqliteWeb connection lock request").pipe(c.zipRight((0,g.getLockName)("SqliteConnection")),c.flatMap((e=>c.async((t=>{navigator.locks.request(e,(()=>new Promise((()=>{t(c.promise((()=>r)))}))))})))),c.tap(c.logTrace("SqliteWeb connection lock granted")),c.flatMap((e=>c.promise((()=>e.installOpfsSAHPoolVfs({name:i.name}))).pipe(c.map((r=>({sqlite:new r.OpfsSAHPoolDb("/evolu1.db"),sqlite3:e})))))),c.tap((({sqlite:e,sqlite3:r})=>{const n=(o,a)=>c.try({try:()=>{if(o.sql===q.sql){return[{file:r.capi.sqlite3_js_db_export(e)}]}return e.exec(o.sql,{returnValue:"resultRows",rowMode:"object",bind:(0,s.valuesToSqliteValues)(o.parameters||[])})},catch:y.ensureTransferableError}).pipe((0,s.maybeLogSqliteQueryExecutionTime)(o),c.match({onSuccess:r=>{t.postMessage({_tag:"ExecSuccess",id:a,result:{rows:r,changes:e.changes()}})},onFailure:e=>{t.postMessage({_tag:"ExecError",id:a,error:e})}}),l.runSync);t.onMessage=e=>{switch(e._tag){case"Exec":n(e.query,e.id);break;case"ExecSuccess":case"ExecError":a(e);break;default:(0,w.absurd)(e)}},o.forEach((e=>{n(e.query,e.id)})),o=[]}))).pipe(c.provideService(f.Config,i),l.runPromise);const u=yield*(0,g.getLockName)("SqliteTransaction");return s.Sqlite.of({exec:r=>c.flatMap(e.nanoid,(e=>c.async((o=>{n.set(e,(e=>{switch(e._tag){case"ExecSuccess":o(c.succeed(e.result));break;case"ExecError":o(c.die(e.error))}})),t.postMessage({_tag:"Exec",id:e,query:r})})))),transaction:e=>r=>c.acquireUseRelease(c.async((r=>{navigator.locks.request(u,{mode:"last"===e?"exclusive":e},(()=>new Promise((e=>{r(c.succeed(e))}))))})),(()=>r),(r=>c.sync((()=>{"last"!==e&&r()})))),export:()=>c.flatMap(e.nanoid,(e=>c.async((r=>{n.set(e,(e=>{switch(e._tag){case"ExecSuccess":r(c.succeed(e.result.rows[0].file));break;case"ExecError":r(c.die(e.error))}})),t.postMessage({_tag:"Exec",id:e,query:q})}))))})}))})}))),k=e=>c.sync((()=>{const r=new BroadcastChannel(e),t={postMessage:e=>{r.postMessage(e),t.onMessage(e)},onMessage:w.constVoid};return r.onmessage=e=>{t.onMessage(e.data)},t})),q={sql:"export database"},S=i.succeed(o.SyncFactory,{createSync:c.sync((()=>(0,d.wrap)(new Worker(new URL(t.p+t.u(339),t.b),{type:void 0}))))});a.createDb.pipe(c.provide(i.mergeAll(s.SqliteFactory.Common.pipe(i.provide(h),i.provide(l.NanoIdGeneratorLive)),l.NanoIdGeneratorLive,n.Time.Live,S,u.SyncLockLive)),c.runSync,d.expose)}},r={};function t(o){var a=r[o];if(void 0!==a)return a.exports;var s=r[o]={exports:{}};return e[o](s,s.exports,t),s.exports}t.m=e,t.x=()=>{var e=t.O(void 0,[681,960,588],(()=>t(751999)));return e=t.O(e)},(()=>{var e=[];t.O=(r,o,a,s)=>{if(!o){var n=1/0;for(u=0;u<e.length;u++){for(var[o,a,s]=e[u],c=!0,i=0;i<o.length;i++)(!1&s||n>=s)&&Object.keys(t.O).every((e=>t.O[e](o[i])))?o.splice(i--,1):(c=!1,s<n&&(n=s));if(c){e.splice(u--,1);var l=a();void 0!==l&&(r=l)}}return r}s=s||0;for(var u=e.length;u>0&&e[u-1][2]>s;u--)e[u]=e[u-1];e[u]=[o,a,s]}})(),t.d=(e,r)=>{for(var o in r)t.o(r,o)&&!t.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:r[o]})},t.f={},t.e=e=>Promise.all(Object.keys(t.f).reduce(((r,o)=>(t.f[o](e,r),r)),[])),t.u=e=>e+".js",t.miniCssF=e=>{},t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),t.o=(e,r)=>Object.prototype.hasOwnProperty.call(e,r),t.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{var e;t.g.importScripts&&(e=t.g.location+"");var r=t.g.document;if(!e&&r&&(r.currentScript&&(e=r.currentScript.src),!e)){var o=r.getElementsByTagName("script");if(o.length)for(var a=o.length-1;a>-1&&(!e||!/^http(s?):/.test(e));)e=o[a--].src}if(!e)throw new Error("Automatic publicPath is not supported in this browser");e=e.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),t.p=e})(),(()=>{t.b=self.location+"";var e={999:1};t.f.i=(r,o)=>{e[r]||importScripts(t.p+t.u(r))};var r=self.webpackChunkStarpyApp=self.webpackChunkStarpyApp||[],o=r.push.bind(r);r.push=r=>{var[a,s,n]=r;for(var c in s)t.o(s,c)&&(t.m[c]=s[c]);for(n&&n(t);a.length;)e[a.pop()]=1;o(r)}})(),(()=>{var e=t.x;t.x=()=>Promise.all([681,960,588].map(t.e,t)).then(e)})();t.x()})();
//# sourceMappingURL=999.js.map