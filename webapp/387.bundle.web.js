"use strict";(self.webpackChunkStarpyApp=self.webpackChunkStarpyApp||[]).push([[387],{41387:(e,r,o)=>{o.r(r),o.d(r,{dbWorker:()=>g});var n=o(49413),t=o(53353),s=o(26576),a=o(12821),l=o(17316),c=o(32568),d=o(51882),i=o(81690);const u=c.cE(n.c4,a.Z_X((()=>{const e=new Worker(new URL(o.p+o.u(705),o.b),{type:void 0});e.onmessage=e=>{r.onMessage(e.data)};const r={postMessage:r=>{e.postMessage(r)},onMessage:l.Q1};return r}))),g=a.JJ_(t.A0,c.JJ(t.YL,c.Jn(i.G,d.LM,s._O,u))).pipe(a.Wno)},81690:(e,r,o)=>{o.d(r,{G:()=>i});var n=o(99331),t=o(12744),s=o(72131),a=o(12821),l=o(32568);const c=self.name&&self.name.split("/")[0]?self.name.split("/")[0]:"evolu";console.info("dbname",c);const d=(0,s.Z)().then((e=>n.J8?new e.oo1.JsStorageDb("local"):new e.oo1.OpfsDb("/evolu/"+c+".db","c"))),i=l.ng(t.rk,{exec:e=>a.Yr4((function*(r){const o=yield*r(a.MCc((()=>d))),n=(0,t.q3)(e),s=o.exec(n.sql,{returnValue:"resultRows",rowMode:"object",bind:(0,t.I1)(n.parameters)});return(0,t.as)(s),{rows:s,changes:o.changes()}}))})},72131:(e,r,o)=>{o.d(r,{Z:()=>t});var n=o(83476);o(40465),self.sqlite3Worker1Promiser;const t=n.Z},40465:(e,r,o)=>{globalThis.sqlite3Worker1Promiser=function e(r=e.defaultConfig){if(1===arguments.length&&"function"==typeof arguments[0]){const o=r;(r=Object.assign(Object.create(null),e.defaultConfig)).onready=o}else r=Object.assign(Object.create(null),e.defaultConfig,r);const o=Object.create(null),n=function(){},t=r.onerror||n,s=r.debug||n,a=r.generateMessageId?void 0:Object.create(null),l=r.generateMessageId||function(e){return e.type+"#"+(a[e.type]=(a[e.type]||0)+1)},c=(...e)=>{throw new Error(e.join(" "))};let d;return r.worker||(r.worker=e.defaultConfig.worker),"function"==typeof r.worker&&(r.worker=r.worker()),r.worker.onmessage=function(e){e=e.data,s("worker1.onmessage",e);let n=o[e.messageId];if(!n)return e&&"sqlite3-api"===e.type&&"worker1-ready"===e.result?void(r.onready&&r.onready()):(n=o[e.type],n&&n.onrow?void n.onrow(e):void(r.onunhandled?r.onunhandled(arguments[0]):t("sqlite3Worker1Promiser() unhandled worker message:",e)));switch(delete o[e.messageId],e.type){case"error":return void n.reject(e);case"open":d||(d=e.dbId);break;case"close":e.dbId===d&&(d=void 0)}try{n.resolve(e)}catch(e){n.reject(e)}},function(){let e;1===arguments.length?e=arguments[0]:2===arguments.length?(e=Object.create(null),e.type=arguments[0],e.args=arguments[1],e.dbId=e.args.dbId):c("Invalid arugments for sqlite3Worker1Promiser()-created factory."),e.dbId||"open"===e.type||(e.dbId=d),e.messageId=l(e),e.departureTime=performance.now();const n=Object.create(null);let t;n.message=e,"exec"===e.type&&e.args&&("function"==typeof e.args.callback?(t=e.messageId+":row",n.onrow=e.args.callback,e.args.callback=t,o[t]=n):"string"==typeof e.args.callback&&c("exec callback may not be a string when using the Promise interface."));let a=new Promise((function(t,a){n.resolve=t,n.reject=a,o[e.messageId]=n,s("Posting",e.type,"message to Worker dbId="+(d||"default")+":",e),r.worker.postMessage(e)}));return t&&(a=a.finally((()=>delete o[t]))),a}},globalThis.sqlite3Worker1Promiser.defaultConfig={worker:function(){return new Worker(new URL(o.p+o.u(867),o.b),{type:void 0})},onerror:(...e)=>console.error("worker1 promiser error",...e)}}}]);