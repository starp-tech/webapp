"use strict";(self.webpackChunkStarpyApp=self.webpackChunkStarpyApp||[]).push([[588],{610196:(e,t,r)=>{r.r(t),r.d(t,{NanoIdGeneratorLive:()=>o});var i=r(752066),n=r(659599);const o=(0,i.createNanoIdGeneratorLive)(n.customAlphabet,n.nanoid)},261317:(e,t,r)=>{r.r(t),r.d(t,{AppStateLive:()=>a,SyncLockLive:()=>d});var i=r(922143),n=r(804516),o=r(737028),s=r(254725);const a=s.succeed(i.AppState,{init:({reloadUrl:e,onRequestSync:t})=>o.sync((()=>{if("undefined"===typeof document)return{reset:o.void};const r="evolu:reloadAllTabs",i=()=>{location.replace(e)};let n;window.addEventListener("storage",(e=>{e.key===r&&i()}));const s=()=>{null==n&&(t(),n=window.setTimeout((()=>{n=null}),50))};window.addEventListener("online",s),document.addEventListener("visibilitychange",(()=>{"hidden"!==document.visibilityState&&s()})),window.addEventListener("focus",s);return{reset:o.sync((()=>{localStorage.setItem(r,Date.now().toString()),i()}))}}))}),d=s.succeed(i.SyncLock,{tryAcquire:o.gen((function*(){yield*o.logTrace("SyncLock tryAcquire");const e=yield*(0,n.getLockName)("SyncLock"),t=o.async((t=>{navigator.locks.request(e,{ifAvailable:!0},(e=>{if(null!=e)return new Promise((e=>{o.logTrace("SyncLock acquired").pipe(o.zipRight(o.succeed({release:o.logTrace("SyncLock released").pipe(o.tap(o.sync(e)))})),t)}));o.logTrace("SyncLock not acquired").pipe(o.zipRight(o.fail(new i.SyncLockAlreadySyncingError)),t)}))}));return yield*o.acquireRelease(t,(({release:e})=>e))}))})},990526:(e,t,r)=>{r.r(t),r.d(t,{Callbacks:()=>U,DbFactory:()=>V,Index:()=>F,createDb:()=>J,deserializeQuery:()=>ue,emptyRows:()=>he,notSupportedPlatformWorker:()=>Ne,queryResultFromRows:()=>me,serializeQuery:()=>ce,upsertValueIntoTableRowColumn:()=>re});var i=r(973043),n=r(919662),o=r(342072),s=r(941757),a=r(499779),d=r(38429),p=r(837875),c=r(154258),u=r(504491),l=r(125105),h=r(581757),f=r(292075),m=r(263247),N=r(861819),y=r(858061),w=r(660571);N.SynchronizedTypeId;const g=N.makeSynchronized,v=y.get,x=(y.getAndSet,y.getAndUpdate,w.getAndUpdateEffect);y.getAndUpdateSome,w.getAndUpdateSomeEffect,w.modify,w.modifyEffect,y.modifySome,w.modifySomeEffect,y.set,y.setAndGet,y.update,w.updateEffect,y.updateAndGet,w.updateAndGetEffect,y.updateSome,w.updateSomeEffect,y.updateSomeAndGet,N.updateSomeAndGetEffectSynchronized,N.unsafeMakeSynchronized;var b=r(431437),O=r(752066),S=r(467339),W=r(145916),C=r(687883),q=r(912317),T=r(922143);const k={sql:'select "id", "mnemonic", "encryptionKey" from "evolu_owner"'},z={sql:'create table "evolu_message" ("timestamp" blob primary key, "table" blob, "row" blob, "column" blob, "value" blob)'},I={sql:'create index "index_evolu_message" on "evolu_message" ("table", "row", "column", "timestamp" desc)'},E={sql:'create table "evolu_owner" ("id" blob, "mnemonic" blob, "encryptionKey" blob, "timestamp" blob, "merkleTree" blob)'},A={sql:'insert into "evolu_owner" ("id", "mnemonic", "encryptionKey", "timestamp", "merkleTree") values (?, ?, ?, ?, ?)'},Q={sql:'select "timestamp", "merkleTree" from "evolu_owner"'},R={sql:'select "timestamp" from "evolu_message" where "table" = ? and "row" = ? and "column" = ? order by "timestamp" desc limit ?'},D={sql:'insert into "evolu_message" ("timestamp", "table", "row", "column", "value") values (?, ?, ?, ?, ?) on conflict do nothing'},B={sql:'update "evolu_owner" set "merkleTree" = ?, "timestamp" = ?'},L={sql:'select * from "evolu_message" where "timestamp" >= ? order by "timestamp"'};var P=r(54096),M=r(477966);const F=i.Struct({name:i.String,sql:i.String});class V extends(a.Tag("DbFactory")()){}const J=p.gen((function*(){const{createSqlite:e}=yield*P.SqliteFactory,{createSync:t}=yield*M.SyncFactory,r=a.empty().pipe(a.add(O.NanoIdGenerator,yield*O.NanoIdGenerator),a.add(b.Time,yield*b.Time),a.add(T.SyncLock,yield*T.SyncLock)),i=yield*d.make(),n=e=>t=>p.flatMap(d.await(i),(r=>p.flatMap(P.Sqlite,(r=>r.transaction(e.transaction)(t))).pipe(p.provide(r)))),s=yield*g(new Map);return{init:(n,o,s,c,u,l)=>p.gen((function*(){yield*p.logDebug(["Db init",{schema:n}]);const h=yield*e,f=a.add(r,P.Sqlite,h),m=yield*K.pipe(p.tap(G(n)),p.flatMap((e=>e.tables.map((e=>e.name)).includes("evolu_owner")?H:Y(l).pipe(p.tap(X(o))))),h.transaction("exclusive"),p.provide(f)),N=yield*t.pipe(p.provide(r));return yield*N.init(m),d.unsafeDone(i,p.succeed(f.pipe(a.add(q.Owner,m),a.add(M.Sync,N),a.add(U,{onError:s,onSyncStateChange:c,onReceive:u})))),m})),loadQueries:e=>p.logDebug(["Db loadQueries",{queries:e}]).pipe(p.zipRight($(e,s)),n({transaction:"shared"})),mutate:(e,t)=>p.gen((function*(){yield*p.logDebug(["Db mutate",{mutations:e,queriesToRefresh:t}]);const r=yield*b.Time,i=yield*P.Sqlite,[n,a]=o.partition(e,(e=>e.table.startsWith("_")));for(const e of a){if(ee(e).some((({column:e,value:t})=>"isDeleted"===e&&1===t)))yield*i.exec({sql:`delete from "${e.table}" where "id" = ?;`,parameters:[e.id]});else{const t=ee(e);for(const e of t){const i=yield*r.now;yield*re(e,t,i)}}}return n.length>0&&(yield*p.tap(X(n),ae)),yield*$(t,s)})).pipe(n({transaction:"exclusive"})),resetOwner:()=>p.logTrace("Db resetOwner").pipe(p.tap(se),n({transaction:"last"})),restoreOwner:(e,t)=>p.logTrace("Db restoreOwner").pipe(p.tap(se),p.tap(p.flatMap(K,G(e))),p.tap(Y(t)),n({transaction:"last"})),ensureSchema:e=>K.pipe(p.flatMap(G(e)),n({transaction:"exclusive"})),sync:e=>p.logDebug(["Db sync",{queriesToRefresh:e}]).pipe(p.zipRight(ae()),p.zipRight($(e,s)),n({transaction:"shared"})),exportDatabase:()=>p.logTrace("Db exportDatabase").pipe(p.zipRight(P.Sqlite),p.flatMap((e=>e.export())),n({transaction:"exclusive"}))}})),U=a.GenericTag("Callbacks"),$=(e,t)=>p.gen((function*(){const r=yield*P.Sqlite,i=yield*x(t,(t=>p.map(p.forEach(e,(e=>{const t=ue(e);return r.exec(t).pipe(p.tap(j(t)),p.map((({rows:t})=>[e,t])))})),(e=>new Map([...t,...e]))))),n=yield*v(t);return e.map((e=>({query:e,patches:(0,S.makePatches)(i.get(e),n.get(e)||[])})))})),j=e=>e.options?.logExplainQueryPlan?P.Sqlite.pipe(p.flatMap((t=>t.exec({...e,sql:`EXPLAIN QUERY PLAN ${e.sql}`}))),p.tap(s.log("ExplainQueryPlan",e)),p.tap((({rows:e})=>s.log((0,P.drawSqliteQueryPlan)(e)))),p.map(c.constVoid)):p.void,K=p.gen((function*(e){yield*p.logTrace("Db getSchema");const t=yield*P.Sqlite;return{tables:yield*p.map(t.exec({sql:"\nselect\n  sqlite_master.name as tableName,\n  table_info.name as columnName\nfrom\n  sqlite_master\n  join pragma_table_info(sqlite_master.name) as table_info\n    ".trim()}),(({rows:e})=>{const t=new Map;return e.forEach((e=>{const{tableName:r,columnName:i}=e;t.has(r)||t.set(r,[]),t.get(r)?.push(i)})),globalThis.Array.from(t,(([e,t])=>({name:e,columns:t})))})),indexes:yield*p.map(t.exec({sql:"\nselect\n  name, sql\nfrom\n  sqlite_master\nwhere\n  type='index' and\n  name not like 'sqlite_%' and\n  name not like 'index_evolu_%'\n".trim()}),(e=>o.map(e.rows,(e=>({name:e.name,sql:e.sql.replace("CREATE INDEX","create index")})))))}})),G=e=>t=>p.gen((function*(){yield*p.logTrace("Db ensureSchema");const r=[];if(e.tables.forEach((e=>{const i=t.tables.find((t=>t.name===e.name));i?o.differenceWith(m.Equivalence)(e.columns,i.columns).forEach((t=>{r.push(`alter table "${e.name}" add column "${t}" blob;`)})):r.push(`\n  create table ${e.name} (\n    "id" text primary key,\n    ${e.columns.filter((e=>"id"!==e)).map((e=>`"${e}" blob`)).join(", ")}\n  );`.trim())})),o.differenceWith(_)(t.indexes,o.intersectionWith(_)(t.indexes,e.indexes)).forEach((e=>{r.push(`drop index "${e.name}";`)})),o.differenceWith(_)(e.indexes,t.indexes).forEach((e=>{r.push(`${e.sql};`)})),r.length>0){const e=yield*P.Sqlite;yield*e.exec({sql:r.join("\n")})}})),_=(e,t)=>e.name===t.name&&e.sql===t.sql,H=p.logTrace("Db readOwner").pipe(p.zipRight(P.Sqlite),p.flatMap((e=>e.exec(k))),p.map((({rows:[e]})=>({id:e.id,mnemonic:e.mnemonic,encryptionKey:e.encryptionKey})))),Y=e=>p.logTrace("Db createOwner").pipe(p.zipRight(p.all([(0,q.makeOwner)(e),P.Sqlite,b.makeInitialTimestamp])),p.tap((([e,t,r])=>p.all([t.exec(z),t.exec(I),t.exec(E),t.exec({...A,parameters:[e.id,e.mnemonic,e.encryptionKey,(0,b.timestampToString)(r),(0,b.merkleTreeToString)(b.initialMerkleTree)]})]))),p.map((([e])=>e))),X=e=>p.gen((function*(t){const{timestamp:r,merkleTree:i}=yield*Z,[n,o]=yield*p.mapAccum(e.flatMap(ee),r,((e,t)=>p.map((0,b.sendTimestamp)(e),(e=>[e,{...t,timestamp:(0,b.timestampToString)(e)}])))),s=yield*te(i,o);return yield*oe(n,s),o})),Z=P.Sqlite.pipe(p.flatMap((e=>e.exec(Q))),p.map((({rows:[{timestamp:e,merkleTree:t}]})=>({timestamp:(0,b.unsafeTimestampFromString)(e),merkleTree:t})))),ee=e=>(0,c.pipe)(Object.entries(e.values),o.filterMap((([t,r])=>void 0===r||e.isInsert&&null==r?u.none():u.some([t,r]))),o.map((([t,r])=>({table:e.table,row:e.id,column:t,value:"boolean"===typeof r||r instanceof Date?(0,C.cast)(r):r})))),te=(e,t)=>p.gen((function*(){const r=yield*P.Sqlite;for(const i of t){const n=(0,b.unsafeTimestampFromString)(i.timestamp),o=yield*p.map(r.exec({...R,parameters:[i.table,i.row,i.column,1]}),(({rows:e})=>e.length>0?e[0].timestamp:null));if((null==o||o<i.timestamp)&&(yield*re(i,t,n.millis)),null==o||o!==i.timestamp){const{changes:t}=yield*r.exec({...D,parameters:[i.timestamp,i.table,i.row,i.column,i.value]});1===t&&(e=(0,b.insertIntoMerkleTree)(e,n))}}return e})),re=(e,t,r)=>P.Sqlite.pipe(p.map((t=>{const i=(0,C.cast)(new Date(r));return t.exec({sql:`\n    insert into\n      "${e.table}" ("id", "${e.column}", "createdAt", "updatedAt")\n    values\n      (?, ?, ?, ?)\n    on conflict do update set\n      "${e.column}" = ?,\n      "updatedAt" = ?\n        `.trim(),parameters:[e.row,e.value,i,i,e.value,i]})})),p.flatMap((e=>p.catchSomeDefect(e,(r=>n.is(ie)(r)?u.some(ne(t).pipe(p.zipRight(e))):u.none()))))),ie=i.Struct({message:i.Union(i.String.pipe(i.includes("no such table")),i.String.pipe(i.includes("no such column")),i.String.pipe(i.includes("has no column")))}),ne=e=>p.gen((function*(){const t=new Map;e.forEach((e=>{const r=t.get(e.table);null!=r?r.columns.includes(e.column)||t.set(e.table,{name:e.table,columns:r.columns.concat(e.column)}):t.set(e.table,{name:e.table,columns:[e.column,"createdAt","updatedAt"]})}));const r=o.fromIterable(t.values());yield*p.flatMap(K,G({tables:r,indexes:[]}))})),oe=(e,t)=>p.flatMap(P.Sqlite,(r=>r.exec({...B,parameters:[(0,b.merkleTreeToString)(t),(0,b.timestampToString)(e)]}))),se=p.gen((function*(){yield*p.logTrace("Db dropAllTables");const e=yield*P.Sqlite,t=yield*K;yield*p.forEach(t.tables,(t=>e.exec({sql:`drop table "${t.name}"`})))})),ae=(e=[])=>T.SyncLock.pipe(p.flatMap((e=>e.tryAcquire)),p.matchEffect({onFailure:()=>p.void,onSuccess:()=>de(e)}),p.scoped,p.forkDaemon),de=(e=[])=>p.gen((function*(t){const r=yield*P.Sqlite,i=yield*M.Sync,n=yield*U,o=yield*b.Time,s=yield*Z.pipe(r.transaction("shared"),p.map((t=>({...t,messages:e}))),p.flatMap(h.make));n.onSyncStateChange({_tag:"SyncStateIsSyncing"}),yield*h.get(s).pipe(p.flatMap(i.sync),p.flatMap(pe),p.repeat({schedule:f.recurs(50),until:u.match({onNone:()=>p.gen((function*(){return n.onSyncStateChange({_tag:"SyncStateIsSynced",time:yield*o.now}),!0})),onSome:e=>p.gen((function*(){return yield*h.set(s,e),!1}))})}),p.catchAllDefect((e=>p.fail((0,W.makeUnexpectedError)((0,W.ensureTransferableError)(e))))),p.catchTag("SyncStateIsNotSynced",(e=>p.succeed(n.onSyncStateChange(e)))),p.catchAll((e=>p.succeed(n.onError(e)))))})),pe=e=>p.flatMap(P.Sqlite,(t=>p.gen((function*(r){const{onReceive:i}=yield*U,n=yield*Z,o=yield*p.reduce(e.messages,n.timestamp,((e,t)=>(0,b.receiveTimestamp)({local:e,remote:(0,b.unsafeTimestampFromString)(t.timestamp)}))),s=yield*te(n.merkleTree,e.messages);return e.messages.length>0&&(yield*oe(o,s),i()),yield*(0,b.diffMerkleTrees)(e.merkleTree,s).pipe(p.flatMap((e=>t.exec({...L,parameters:[(0,b.timestampToString)((0,b.makeSyncTimestamp)(e))]}))),p.map((({rows:e})=>({messages:e,merkleTree:s,timestamp:o}))),p.option)})).pipe(t.transaction("exclusive")))),ce=({sql:e,parameters:t=[],options:r})=>{const i={sql:e,parameters:t.map((e=>l.isUint8Array(e)?o.fromIterable(e):(0,P.isJsonObjectOrArray)(e)?{json:e}:e)),...r&&{options:r}};return JSON.stringify(i)},ue=e=>{const t=JSON.parse(e);return{...t,parameters:t.parameters.map((e=>o.isArray(e)?new Uint8Array(e):"object"===typeof e&&null!=e?e.json:e))}},le=[],he=()=>le,fe=new WeakMap,me=e=>{let t=fe.get(e);return null==t&&(t={rows:e,row:e[0]},fe.set(e,t)),t},Ne={init:()=>p.fail({_tag:"NotSupportedPlatformError"}),loadQueries:()=>p.succeed([]),mutate:()=>p.succeed([]),resetOwner:()=>p.void,restoreOwner:()=>p.void,ensureSchema:()=>p.void,sync:()=>p.succeed([]),exportDatabase:()=>p.succeed(new Uint8Array)}},467339:(e,t,r)=>{r.r(t),r.d(t,{applyPatches:()=>o,areEqual:()=>a,makePatches:()=>s});var i=r(342072),n=r(125105);const o=(e,t)=>e.reduce(((e,t)=>{switch(t.op){case"replaceAll":return t.value;case"replaceAt":return i.replace(e,t.index,t.value)}}),t),s=(e,t)=>{if(void 0===e)return[{op:"replaceAll",value:t}];if(e.length!==t.length)return[{op:"replaceAll",value:t}];const r=e.length,i=[];for(let n=0;n<r;n++){const r=e[n],o=t[n];for(const e in r)if(!a(r[e],o[e])){i.push({op:"replaceAt",value:o,index:n});break}}return r>0&&i.length===r?[{op:"replaceAll",value:t}]:i},a=(e,t)=>{if(e===t)return!0;if(typeof e!==typeof t)return!1;if("object"===typeof e&&null!==e&&null!==t){const r=n.isUint8Array(e),o=n.isUint8Array(t);if(r&&o){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r]!==t[r])return!1;return!0}const s=i.isArray(e),d=i.isArray(t);if(s&&d){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!a(e[r],t[r]))return!1;return!0}if(!r&&!o&&!s&&!d){const r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(const n of r)if(!a(e[n],t[n]))return!1;return!0}}return!1}},804516:(e,t,r)=>{r.r(t),r.d(t,{EvoluFactory:()=>Rt,createIndexes:()=>Vt,getLockName:()=>Jt});var i=r(674232),n=r(973043),o=r(342072),s=r(499779),a=r(837875),d=r(154258),p=r(350025),c=r(962047),u=r(504491),l=r(125105),h=r(939739),f=r(464580);const m=(0,f.freeze)({is:e=>"AlterTableNode"===e.kind,create:e=>(0,f.freeze)({kind:"AlterTableNode",table:e}),cloneWithTableProps:(e,t)=>(0,f.freeze)({...e,...t}),cloneWithColumnAlteration:(e,t)=>(0,f.freeze)({...e,columnAlterations:e.columnAlterations?[...e.columnAlterations,t]:[t]})});var N=r(861509);const y=(0,f.freeze)({is:e=>"CreateIndexNode"===e.kind,create:e=>(0,f.freeze)({kind:"CreateIndexNode",name:N.IdentifierNode.create(e)}),cloneWith:(e,t)=>(0,f.freeze)({...e,...t}),cloneWithColumns:(e,t)=>(0,f.freeze)({...e,columns:[...e.columns||[],...t]})}),w=(0,f.freeze)({is:e=>"CreateSchemaNode"===e.kind,create:(e,t)=>(0,f.freeze)({kind:"CreateSchemaNode",schema:N.IdentifierNode.create(e),...t}),cloneWith:(e,t)=>(0,f.freeze)({...e,...t})}),g=["preserve rows","delete rows","drop"],v=(0,f.freeze)({is:e=>"CreateTableNode"===e.kind,create:e=>(0,f.freeze)({kind:"CreateTableNode",table:e,columns:(0,f.freeze)([])}),cloneWithColumn:(e,t)=>(0,f.freeze)({...e,columns:(0,f.freeze)([...e.columns,t])}),cloneWithConstraint:(e,t)=>(0,f.freeze)({...e,constraints:e.constraints?(0,f.freeze)([...e.constraints,t]):(0,f.freeze)([t])}),cloneWithFrontModifier:(e,t)=>(0,f.freeze)({...e,frontModifiers:e.frontModifiers?(0,f.freeze)([...e.frontModifiers,t]):(0,f.freeze)([t])}),cloneWithEndModifier:(e,t)=>(0,f.freeze)({...e,endModifiers:e.endModifiers?(0,f.freeze)([...e.endModifiers,t]):(0,f.freeze)([t])}),cloneWith:(e,t)=>(0,f.freeze)({...e,...t})});var x=r(176764);const b=(0,f.freeze)({is:e=>"DropIndexNode"===e.kind,create:(e,t)=>(0,f.freeze)({kind:"DropIndexNode",name:x.SchemableIdentifierNode.create(e),...t}),cloneWith:(e,t)=>(0,f.freeze)({...e,...t})}),O=(0,f.freeze)({is:e=>"DropSchemaNode"===e.kind,create:(e,t)=>(0,f.freeze)({kind:"DropSchemaNode",schema:N.IdentifierNode.create(e),...t}),cloneWith:(e,t)=>(0,f.freeze)({...e,...t})}),S=(0,f.freeze)({is:e=>"DropTableNode"===e.kind,create:(e,t)=>(0,f.freeze)({kind:"DropTableNode",table:e,...t}),cloneWith:(e,t)=>(0,f.freeze)({...e,...t})});var W=r(532234);const C=(0,f.freeze)({is:e=>"AddColumnNode"===e.kind,create:e=>(0,f.freeze)({kind:"AddColumnNode",column:e})});var q=r(11602);const T=(0,f.freeze)({is:e=>"ColumnDefinitionNode"===e.kind,create:(e,t)=>(0,f.freeze)({kind:"ColumnDefinitionNode",column:q.ColumnNode.create(e),dataType:t}),cloneWithFrontModifier:(e,t)=>(0,f.freeze)({...e,frontModifiers:e.frontModifiers?(0,f.freeze)([...e.frontModifiers,t]):[t]}),cloneWithEndModifier:(e,t)=>(0,f.freeze)({...e,endModifiers:e.endModifiers?(0,f.freeze)([...e.endModifiers,t]):[t]}),cloneWith:(e,t)=>(0,f.freeze)({...e,...t})}),k=(0,f.freeze)({is:e=>"DropColumnNode"===e.kind,create:e=>(0,f.freeze)({kind:"DropColumnNode",column:q.ColumnNode.create(e)})}),z=(0,f.freeze)({is:e=>"RenameColumnNode"===e.kind,create:(e,t)=>(0,f.freeze)({kind:"RenameColumnNode",column:q.ColumnNode.create(e),renameTo:q.ColumnNode.create(t)})});var I=r(210922);const E=(0,f.freeze)({is:e=>"CheckConstraintNode"===e.kind,create:(e,t)=>(0,f.freeze)({kind:"CheckConstraintNode",expression:e,name:t?N.IdentifierNode.create(t):void 0})}),A=["no action","restrict","cascade","set null","set default"],Q=(0,f.freeze)({is:e=>"ReferencesNode"===e.kind,create:(e,t)=>(0,f.freeze)({kind:"ReferencesNode",table:e,columns:(0,f.freeze)([...t])}),cloneWithOnDelete:(e,t)=>(0,f.freeze)({...e,onDelete:t}),cloneWithOnUpdate:(e,t)=>(0,f.freeze)({...e,onUpdate:t})});var R=r(56274),D=r(16149),B=r(286833),L=r(769539);function P(e){return(0,B.isOperationNodeSource)(e)?e.toOperationNode():L.ValueNode.createImmediate(e)}const M=(0,f.freeze)({is:e=>"GeneratedNode"===e.kind,create:e=>(0,f.freeze)({kind:"GeneratedNode",...e}),createWithExpression:e=>(0,f.freeze)({kind:"GeneratedNode",always:!0,expression:e}),cloneWith:(e,t)=>(0,f.freeze)({...e,...t})}),F=(0,f.freeze)({is:e=>"DefaultValueNode"===e.kind,create:e=>(0,f.freeze)({kind:"DefaultValueNode",defaultValue:e})});function V(e){if(A.includes(e))return e;throw new Error(`invalid OnModifyForeignAction ${e}`)}class J{#e;constructor(e){this.#e=e}autoIncrement(){return new J(T.cloneWith(this.#e,{autoIncrement:!0}))}identity(){return new J(T.cloneWith(this.#e,{identity:!0}))}primaryKey(){return new J(T.cloneWith(this.#e,{primaryKey:!0}))}references(e){const t=(0,D.parseStringReference)(e);if(!t.table||R.SelectAllNode.is(t.column))throw new Error(`invalid call references('${e}'). The reference must have format table.column or schema.table.column`);return new J(T.cloneWith(this.#e,{references:Q.create(t.table,[t.column])}))}onDelete(e){if(!this.#e.references)throw new Error("on delete constraint can only be added for foreign keys");return new J(T.cloneWith(this.#e,{references:Q.cloneWithOnDelete(this.#e.references,V(e))}))}onUpdate(e){if(!this.#e.references)throw new Error("on update constraint can only be added for foreign keys");return new J(T.cloneWith(this.#e,{references:Q.cloneWithOnUpdate(this.#e.references,V(e))}))}unique(){return new J(T.cloneWith(this.#e,{unique:!0}))}notNull(){return new J(T.cloneWith(this.#e,{notNull:!0}))}unsigned(){return new J(T.cloneWith(this.#e,{unsigned:!0}))}defaultTo(e){return new J(T.cloneWith(this.#e,{defaultTo:F.create(P(e))}))}check(e){return new J(T.cloneWith(this.#e,{check:E.create(e.toOperationNode())}))}generatedAlwaysAs(e){return new J(T.cloneWith(this.#e,{generated:M.createWithExpression(e.toOperationNode())}))}generatedAlwaysAsIdentity(){return new J(T.cloneWith(this.#e,{generated:M.create({identity:!0,always:!0})}))}generatedByDefaultAsIdentity(){return new J(T.cloneWith(this.#e,{generated:M.create({identity:!0,byDefault:!0})}))}stored(){if(!this.#e.generated)throw new Error("stored() can only be called after generatedAlwaysAs");return new J(T.cloneWith(this.#e,{generated:M.cloneWith(this.#e.generated,{stored:!0})}))}modifyFront(e){return new J(T.cloneWithFrontModifier(this.#e,e.toOperationNode()))}nullsNotDistinct(){return new J(T.cloneWith(this.#e,{nullsNotDistinct:!0}))}ifNotExists(){return new J(T.cloneWith(this.#e,{ifNotExists:!0}))}modifyEnd(e){return new J(T.cloneWithEndModifier(this.#e,e.toOperationNode()))}$call(e){return e(this)}toOperationNode(){return this.#e}}(0,I.preventAwait)(J,"don't await ColumnDefinitionBuilder instances directly.");const U=(0,f.freeze)({is:e=>"ModifyColumnNode"===e.kind,create:e=>(0,f.freeze)({kind:"ModifyColumnNode",column:e})});var $=r(608489);const j=(0,f.freeze)({is:e=>"ForeignKeyConstraintNode"===e.kind,create:(e,t,r,i)=>(0,f.freeze)({kind:"ForeignKeyConstraintNode",columns:e,references:Q.create(t,r),name:i?N.IdentifierNode.create(i):void 0}),cloneWith:(e,t)=>(0,f.freeze)({...e,...t})});class K{#e;constructor(e){this.#e=e}onDelete(e){return new K(j.cloneWith(this.#e,{onDelete:V(e)}))}onUpdate(e){return new K(j.cloneWith(this.#e,{onUpdate:V(e)}))}$call(e){return e(this)}toOperationNode(){return this.#e}}(0,I.preventAwait)(K,"don't await ForeignKeyConstraintBuilder instances directly.");const G=(0,f.freeze)({is:e=>"AddConstraintNode"===e.kind,create:e=>(0,f.freeze)({kind:"AddConstraintNode",constraint:e})}),_=(0,f.freeze)({is:e=>"UniqueConstraintNode"===e.kind,create:(e,t,r)=>(0,f.freeze)({kind:"UniqueConstraintNode",columns:(0,f.freeze)(e.map(q.ColumnNode.create)),name:t?N.IdentifierNode.create(t):void 0,nullsNotDistinct:r}),cloneWith:(e,t)=>(0,f.freeze)({...e,...t})}),H=(0,f.freeze)({is:e=>"DropConstraintNode"===e.kind,create:e=>(0,f.freeze)({kind:"DropConstraintNode",constraintName:N.IdentifierNode.create(e)}),cloneWith:(e,t)=>(0,f.freeze)({...e,...t})}),Y=(0,f.freeze)({is:e=>"AlterColumnNode"===e.kind,create:(e,t,r)=>(0,f.freeze)({kind:"AlterColumnNode",column:q.ColumnNode.create(e),[t]:r})});class X{#t;constructor(e){this.#t=e}setDataType(e){return new Z(Y.create(this.#t,"dataType",(0,$.parseDataTypeExpression)(e)))}setDefault(e){return new Z(Y.create(this.#t,"setDefault",P(e)))}dropDefault(){return new Z(Y.create(this.#t,"dropDefault",!0))}setNotNull(){return new Z(Y.create(this.#t,"setNotNull",!0))}dropNotNull(){return new Z(Y.create(this.#t,"dropNotNull",!0))}$call(e){return e(this)}}(0,I.preventAwait)(X,"don't await AlterColumnBuilder instances");class Z{#r;constructor(e){this.#r=e}toOperationNode(){return this.#r}}(0,I.preventAwait)(Z,"don't await AlteredColumnBuilder instances");class ee{#i;constructor(e){this.#i=(0,f.freeze)(e)}toOperationNode(){return this.#i.executor.transformQuery(this.#i.node,this.#i.queryId)}compile(){return this.#i.executor.compileQuery(this.toOperationNode(),this.#i.queryId)}async execute(){await this.#i.executor.executeQuery(this.compile(),this.#i.queryId)}}(0,I.preventAwait)(ee,"don't await AlterTableExecutor instances directly. To execute the query you need to call `execute`");class te{#i;constructor(e){this.#i=(0,f.freeze)(e)}onDelete(e){return new te({...this.#i,constraintBuilder:this.#i.constraintBuilder.onDelete(e)})}onUpdate(e){return new te({...this.#i,constraintBuilder:this.#i.constraintBuilder.onUpdate(e)})}$call(e){return e(this)}toOperationNode(){return this.#i.executor.transformQuery(m.cloneWithTableProps(this.#i.node,{addConstraint:G.create(this.#i.constraintBuilder.toOperationNode())}),this.#i.queryId)}compile(){return this.#i.executor.compileQuery(this.toOperationNode(),this.#i.queryId)}async execute(){await this.#i.executor.executeQuery(this.compile(),this.#i.queryId)}}(0,I.preventAwait)(te,"don't await AlterTableAddForeignKeyConstraintBuilder instances directly. To execute the query you need to call `execute`");class re{#i;constructor(e){this.#i=(0,f.freeze)(e)}ifExists(){return new re({...this.#i,node:m.cloneWithTableProps(this.#i.node,{dropConstraint:H.cloneWith(this.#i.node.dropConstraint,{ifExists:!0})})})}cascade(){return new re({...this.#i,node:m.cloneWithTableProps(this.#i.node,{dropConstraint:H.cloneWith(this.#i.node.dropConstraint,{modifier:"cascade"})})})}restrict(){return new re({...this.#i,node:m.cloneWithTableProps(this.#i.node,{dropConstraint:H.cloneWith(this.#i.node.dropConstraint,{modifier:"restrict"})})})}$call(e){return e(this)}toOperationNode(){return this.#i.executor.transformQuery(this.#i.node,this.#i.queryId)}compile(){return this.#i.executor.compileQuery(this.toOperationNode(),this.#i.queryId)}async execute(){await this.#i.executor.executeQuery(this.compile(),this.#i.queryId)}}(0,I.preventAwait)(re,"don't await AlterTableDropConstraintBuilder instances directly. To execute the query you need to call `execute`");const ie=(0,f.freeze)({is:e=>"PrimaryKeyConstraintNode"===e.kind,create:(e,t)=>(0,f.freeze)({kind:"PrimaryKeyConstraintNode",columns:(0,f.freeze)(e.map(q.ColumnNode.create)),name:t?N.IdentifierNode.create(t):void 0})}),ne=(0,f.freeze)({is:e=>"AddIndexNode"===e.kind,create:e=>(0,f.freeze)({kind:"AddIndexNode",name:N.IdentifierNode.create(e)}),cloneWith:(e,t)=>(0,f.freeze)({...e,...t}),cloneWithColumns:(e,t)=>(0,f.freeze)({...e,columns:[...e.columns||[],...t]})});var oe=r(249350);class se{#i;constructor(e){this.#i=(0,f.freeze)(e)}unique(){return new se({...this.#i,node:m.cloneWithTableProps(this.#i.node,{addIndex:ne.cloneWith(this.#i.node.addIndex,{unique:!0})})})}column(e){return new se({...this.#i,node:m.cloneWithTableProps(this.#i.node,{addIndex:ne.cloneWithColumns(this.#i.node.addIndex,[(0,D.parseOrderedColumnName)(e)])})})}columns(e){return new se({...this.#i,node:m.cloneWithTableProps(this.#i.node,{addIndex:ne.cloneWithColumns(this.#i.node.addIndex,e.map(D.parseOrderedColumnName))})})}expression(e){return new se({...this.#i,node:m.cloneWithTableProps(this.#i.node,{addIndex:ne.cloneWithColumns(this.#i.node.addIndex,[e.toOperationNode()])})})}using(e){return new se({...this.#i,node:m.cloneWithTableProps(this.#i.node,{addIndex:ne.cloneWith(this.#i.node.addIndex,{using:oe.RawNode.createWithSql(e)})})})}$call(e){return e(this)}toOperationNode(){return this.#i.executor.transformQuery(this.#i.node,this.#i.queryId)}compile(){return this.#i.executor.compileQuery(this.toOperationNode(),this.#i.queryId)}async execute(){await this.#i.executor.executeQuery(this.compile(),this.#i.queryId)}}(0,I.preventAwait)(se,"don't await AlterTableAddIndexBuilder instances directly. To execute the query you need to call `execute`");class ae{#e;constructor(e){this.#e=e}toOperationNode(){return this.#e}nullsNotDistinct(){return new ae(_.cloneWith(this.#e,{nullsNotDistinct:!0}))}}(0,I.preventAwait)(ae,"don't await UniqueConstraintNodeBuilder instances directly.");class de{#i;constructor(e){this.#i=(0,f.freeze)(e)}renameTo(e){return new ee({...this.#i,node:m.cloneWithTableProps(this.#i.node,{renameTo:(0,W.parseTable)(e)})})}setSchema(e){return new ee({...this.#i,node:m.cloneWithTableProps(this.#i.node,{setSchema:N.IdentifierNode.create(e)})})}alterColumn(e,t){const r=t(new X(e));return new pe({...this.#i,node:m.cloneWithColumnAlteration(this.#i.node,r.toOperationNode())})}dropColumn(e){return new pe({...this.#i,node:m.cloneWithColumnAlteration(this.#i.node,k.create(e))})}renameColumn(e,t){return new pe({...this.#i,node:m.cloneWithColumnAlteration(this.#i.node,z.create(e,t))})}addColumn(e,t,r=f.noop){const i=r(new J(T.create(e,(0,$.parseDataTypeExpression)(t))));return new pe({...this.#i,node:m.cloneWithColumnAlteration(this.#i.node,C.create(i.toOperationNode()))})}modifyColumn(e,t,r=f.noop){const i=r(new J(T.create(e,(0,$.parseDataTypeExpression)(t))));return new pe({...this.#i,node:m.cloneWithColumnAlteration(this.#i.node,U.create(i.toOperationNode()))})}addUniqueConstraint(e,t,r=f.noop){const i=r(new ae(_.create(t,e)));return new ee({...this.#i,node:m.cloneWithTableProps(this.#i.node,{addConstraint:G.create(i.toOperationNode())})})}addCheckConstraint(e,t){return new ee({...this.#i,node:m.cloneWithTableProps(this.#i.node,{addConstraint:G.create(E.create(t.toOperationNode(),e))})})}addForeignKeyConstraint(e,t,r,i){return new te({...this.#i,constraintBuilder:new K(j.create(t.map(q.ColumnNode.create),(0,W.parseTable)(r),i.map(q.ColumnNode.create),e))})}addPrimaryKeyConstraint(e,t){return new ee({...this.#i,node:m.cloneWithTableProps(this.#i.node,{addConstraint:G.create(ie.create(t,e))})})}dropConstraint(e){return new re({...this.#i,node:m.cloneWithTableProps(this.#i.node,{dropConstraint:H.create(e)})})}addIndex(e){return new se({...this.#i,node:m.cloneWithTableProps(this.#i.node,{addIndex:ne.create(e)})})}dropIndex(e){return new ee({...this.#i,node:m.cloneWithTableProps(this.#i.node,{dropIndex:b.create(e)})})}$call(e){return e(this)}}(0,I.preventAwait)(de,"don't await AlterTableBuilder instances");class pe{#i;constructor(e){this.#i=(0,f.freeze)(e)}alterColumn(e,t){const r=t(new X(e));return new pe({...this.#i,node:m.cloneWithColumnAlteration(this.#i.node,r.toOperationNode())})}dropColumn(e){return new pe({...this.#i,node:m.cloneWithColumnAlteration(this.#i.node,k.create(e))})}renameColumn(e,t){return new pe({...this.#i,node:m.cloneWithColumnAlteration(this.#i.node,z.create(e,t))})}addColumn(e,t,r=f.noop){const i=r(new J(T.create(e,(0,$.parseDataTypeExpression)(t))));return new pe({...this.#i,node:m.cloneWithColumnAlteration(this.#i.node,C.create(i.toOperationNode()))})}modifyColumn(e,t,r=f.noop){const i=r(new J(T.create(e,(0,$.parseDataTypeExpression)(t))));return new pe({...this.#i,node:m.cloneWithColumnAlteration(this.#i.node,U.create(i.toOperationNode()))})}toOperationNode(){return this.#i.executor.transformQuery(this.#i.node,this.#i.queryId)}compile(){return this.#i.executor.compileQuery(this.toOperationNode(),this.#i.queryId)}async execute(){await this.#i.executor.executeQuery(this.compile(),this.#i.queryId)}}(0,I.preventAwait)(pe,"don't await AlterTableColumnAlteringBuilder instances directly. To execute the query you need to call `execute`");var ce=r(314271),ue=r(430144),le=r(146774);class he extends le.OperationNodeTransformer{transformValue(e){return{...super.transformValue(e),immediate:!0}}}class fe{#i;constructor(e){this.#i=(0,f.freeze)(e)}ifNotExists(){return new fe({...this.#i,node:y.cloneWith(this.#i.node,{ifNotExists:!0})})}unique(){return new fe({...this.#i,node:y.cloneWith(this.#i.node,{unique:!0})})}nullsNotDistinct(){return new fe({...this.#i,node:y.cloneWith(this.#i.node,{nullsNotDistinct:!0})})}on(e){return new fe({...this.#i,node:y.cloneWith(this.#i.node,{table:(0,W.parseTable)(e)})})}column(e){return new fe({...this.#i,node:y.cloneWithColumns(this.#i.node,[(0,D.parseOrderedColumnName)(e)])})}columns(e){return new fe({...this.#i,node:y.cloneWithColumns(this.#i.node,e.map(D.parseOrderedColumnName))})}expression(e){return new fe({...this.#i,node:y.cloneWithColumns(this.#i.node,[e.toOperationNode()])})}using(e){return new fe({...this.#i,node:y.cloneWith(this.#i.node,{using:oe.RawNode.createWithSql(e)})})}where(...e){const t=new he;return new fe({...this.#i,node:ue.QueryNode.cloneWithWhere(this.#i.node,t.transformNode((0,ce.parseValueBinaryOperationOrExpression)(e)))})}$call(e){return e(this)}toOperationNode(){return this.#i.executor.transformQuery(this.#i.node,this.#i.queryId)}compile(){return this.#i.executor.compileQuery(this.toOperationNode(),this.#i.queryId)}async execute(){await this.#i.executor.executeQuery(this.compile(),this.#i.queryId)}}(0,I.preventAwait)(fe,"don't await CreateIndexBuilder instances directly. To execute the query you need to call `execute`");class me{#i;constructor(e){this.#i=(0,f.freeze)(e)}ifNotExists(){return new me({...this.#i,node:w.cloneWith(this.#i.node,{ifNotExists:!0})})}$call(e){return e(this)}toOperationNode(){return this.#i.executor.transformQuery(this.#i.node,this.#i.queryId)}compile(){return this.#i.executor.compileQuery(this.toOperationNode(),this.#i.queryId)}async execute(){await this.#i.executor.executeQuery(this.compile(),this.#i.queryId)}}function Ne(e){if(g.includes(e))return e;throw new Error(`invalid OnCommitAction ${e}`)}(0,I.preventAwait)(me,"don't await CreateSchemaBuilder instances directly. To execute the query you need to call `execute`");var ye=r(716175);class we{#i;constructor(e){this.#i=(0,f.freeze)(e)}temporary(){return new we({...this.#i,node:v.cloneWith(this.#i.node,{temporary:!0})})}onCommit(e){return new we({...this.#i,node:v.cloneWith(this.#i.node,{onCommit:Ne(e)})})}ifNotExists(){return new we({...this.#i,node:v.cloneWith(this.#i.node,{ifNotExists:!0})})}addColumn(e,t,r=f.noop){const i=r(new J(T.create(e,(0,$.parseDataTypeExpression)(t))));return new we({...this.#i,node:v.cloneWithColumn(this.#i.node,i.toOperationNode())})}addPrimaryKeyConstraint(e,t){return new we({...this.#i,node:v.cloneWithConstraint(this.#i.node,ie.create(t,e))})}addUniqueConstraint(e,t,r=f.noop){const i=r(new ae(_.create(t,e)));return new we({...this.#i,node:v.cloneWithConstraint(this.#i.node,i.toOperationNode())})}addCheckConstraint(e,t){return new we({...this.#i,node:v.cloneWithConstraint(this.#i.node,E.create(t.toOperationNode(),e))})}addForeignKeyConstraint(e,t,r,i,n=f.noop){const o=n(new K(j.create(t.map(q.ColumnNode.create),(0,W.parseTable)(r),i.map(q.ColumnNode.create),e)));return new we({...this.#i,node:v.cloneWithConstraint(this.#i.node,o.toOperationNode())})}modifyFront(e){return new we({...this.#i,node:v.cloneWithFrontModifier(this.#i.node,e.toOperationNode())})}modifyEnd(e){return new we({...this.#i,node:v.cloneWithEndModifier(this.#i.node,e.toOperationNode())})}as(e){return new we({...this.#i,node:v.cloneWith(this.#i.node,{selectQuery:(0,ye.parseExpression)(e)})})}$call(e){return e(this)}toOperationNode(){return this.#i.executor.transformQuery(this.#i.node,this.#i.queryId)}compile(){return this.#i.executor.compileQuery(this.toOperationNode(),this.#i.queryId)}async execute(){await this.#i.executor.executeQuery(this.compile(),this.#i.queryId)}}(0,I.preventAwait)(we,"don't await CreateTableBuilder instances directly. To execute the query you need to call `execute`");class ge{#i;constructor(e){this.#i=(0,f.freeze)(e)}on(e){return new ge({...this.#i,node:b.cloneWith(this.#i.node,{table:(0,W.parseTable)(e)})})}ifExists(){return new ge({...this.#i,node:b.cloneWith(this.#i.node,{ifExists:!0})})}cascade(){return new ge({...this.#i,node:b.cloneWith(this.#i.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#i.executor.transformQuery(this.#i.node,this.#i.queryId)}compile(){return this.#i.executor.compileQuery(this.toOperationNode(),this.#i.queryId)}async execute(){await this.#i.executor.executeQuery(this.compile(),this.#i.queryId)}}(0,I.preventAwait)(ge,"don't await DropIndexBuilder instances directly. To execute the query you need to call `execute`");class ve{#i;constructor(e){this.#i=(0,f.freeze)(e)}ifExists(){return new ve({...this.#i,node:O.cloneWith(this.#i.node,{ifExists:!0})})}cascade(){return new ve({...this.#i,node:O.cloneWith(this.#i.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#i.executor.transformQuery(this.#i.node,this.#i.queryId)}compile(){return this.#i.executor.compileQuery(this.toOperationNode(),this.#i.queryId)}async execute(){await this.#i.executor.executeQuery(this.compile(),this.#i.queryId)}}(0,I.preventAwait)(ve,"don't await DropSchemaBuilder instances directly. To execute the query you need to call `execute`");class xe{#i;constructor(e){this.#i=(0,f.freeze)(e)}ifExists(){return new xe({...this.#i,node:S.cloneWith(this.#i.node,{ifExists:!0})})}cascade(){return new xe({...this.#i,node:S.cloneWith(this.#i.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#i.executor.transformQuery(this.#i.node,this.#i.queryId)}compile(){return this.#i.executor.compileQuery(this.toOperationNode(),this.#i.queryId)}async execute(){await this.#i.executor.executeQuery(this.compile(),this.#i.queryId)}}(0,I.preventAwait)(xe,"don't await DropTableBuilder instances directly. To execute the query you need to call `execute`");var be=r(426048),Oe=r(691031);const Se=(0,f.freeze)({is:e=>"CreateViewNode"===e.kind,create:e=>(0,f.freeze)({kind:"CreateViewNode",name:x.SchemableIdentifierNode.create(e)}),cloneWith:(e,t)=>(0,f.freeze)({...e,...t})});class We{#n=new he;transformQuery(e){return this.#n.transformNode(e.node)}transformResult(e){return Promise.resolve(e.result)}}class Ce{#i;constructor(e){this.#i=(0,f.freeze)(e)}temporary(){return new Ce({...this.#i,node:Se.cloneWith(this.#i.node,{temporary:!0})})}materialized(){return new Ce({...this.#i,node:Se.cloneWith(this.#i.node,{materialized:!0})})}ifNotExists(){return new Ce({...this.#i,node:Se.cloneWith(this.#i.node,{ifNotExists:!0})})}orReplace(){return new Ce({...this.#i,node:Se.cloneWith(this.#i.node,{orReplace:!0})})}columns(e){return new Ce({...this.#i,node:Se.cloneWith(this.#i.node,{columns:e.map(D.parseColumnName)})})}as(e){const t=e.withPlugin(new We).toOperationNode();return new Ce({...this.#i,node:Se.cloneWith(this.#i.node,{as:t})})}$call(e){return e(this)}toOperationNode(){return this.#i.executor.transformQuery(this.#i.node,this.#i.queryId)}compile(){return this.#i.executor.compileQuery(this.toOperationNode(),this.#i.queryId)}async execute(){await this.#i.executor.executeQuery(this.compile(),this.#i.queryId)}}(0,I.preventAwait)(Ce,"don't await CreateViewBuilder instances directly. To execute the query you need to call `execute`");const qe=(0,f.freeze)({is:e=>"DropViewNode"===e.kind,create:e=>(0,f.freeze)({kind:"DropViewNode",name:x.SchemableIdentifierNode.create(e)}),cloneWith:(e,t)=>(0,f.freeze)({...e,...t})});class Te{#i;constructor(e){this.#i=(0,f.freeze)(e)}materialized(){return new Te({...this.#i,node:qe.cloneWith(this.#i.node,{materialized:!0})})}ifExists(){return new Te({...this.#i,node:qe.cloneWith(this.#i.node,{ifExists:!0})})}cascade(){return new Te({...this.#i,node:qe.cloneWith(this.#i.node,{cascade:!0})})}$call(e){return e(this)}toOperationNode(){return this.#i.executor.transformQuery(this.#i.node,this.#i.queryId)}compile(){return this.#i.executor.compileQuery(this.toOperationNode(),this.#i.queryId)}async execute(){await this.#i.executor.executeQuery(this.compile(),this.#i.queryId)}}(0,I.preventAwait)(Te,"don't await DropViewBuilder instances directly. To execute the query you need to call `execute`");var ke=r(291788);const ze=(0,f.freeze)({is:e=>"CreateTypeNode"===e.kind,create:e=>(0,f.freeze)({kind:"CreateTypeNode",name:e}),cloneWithEnum:(e,t)=>(0,f.freeze)({...e,enum:ke.ValueListNode.create(t.map((e=>L.ValueNode.createImmediate(e))))})});class Ie{#i;constructor(e){this.#i=(0,f.freeze)(e)}toOperationNode(){return this.#i.executor.transformQuery(this.#i.node,this.#i.queryId)}asEnum(e){return new Ie({...this.#i,node:ze.cloneWithEnum(this.#i.node,e)})}$call(e){return e(this)}compile(){return this.#i.executor.compileQuery(this.toOperationNode(),this.#i.queryId)}async execute(){await this.#i.executor.executeQuery(this.compile(),this.#i.queryId)}}(0,I.preventAwait)(Ie,"don't await CreateTypeBuilder instances directly. To execute the query you need to call `execute`");const Ee=(0,f.freeze)({is:e=>"DropTypeNode"===e.kind,create:e=>(0,f.freeze)({kind:"DropTypeNode",name:e}),cloneWith:(e,t)=>(0,f.freeze)({...e,...t})});class Ae{#i;constructor(e){this.#i=(0,f.freeze)(e)}ifExists(){return new Ae({...this.#i,node:Ee.cloneWith(this.#i.node,{ifExists:!0})})}$call(e){return e(this)}toOperationNode(){return this.#i.executor.transformQuery(this.#i.node,this.#i.queryId)}compile(){return this.#i.executor.compileQuery(this.toOperationNode(),this.#i.queryId)}async execute(){await this.#i.executor.executeQuery(this.compile(),this.#i.queryId)}}function Qe(e){if(e.includes(".")){const t=e.split(".").map(Re);if(2===t.length)return x.SchemableIdentifierNode.createWithSchema(t[0],t[1]);throw new Error(`invalid schemable identifier ${e}`)}return x.SchemableIdentifierNode.create(e)}function Re(e){return e.trim()}(0,I.preventAwait)(Ae,"don't await DropTypeBuilder instances directly. To execute the query you need to call `execute`");class De{#o;constructor(e){this.#o=e}createTable(e){return new we({queryId:(0,be.createQueryId)(),executor:this.#o,node:v.create((0,W.parseTable)(e))})}dropTable(e){return new xe({queryId:(0,be.createQueryId)(),executor:this.#o,node:S.create((0,W.parseTable)(e))})}createIndex(e){return new fe({queryId:(0,be.createQueryId)(),executor:this.#o,node:y.create(e)})}dropIndex(e){return new ge({queryId:(0,be.createQueryId)(),executor:this.#o,node:b.create(e)})}createSchema(e){return new me({queryId:(0,be.createQueryId)(),executor:this.#o,node:w.create(e)})}dropSchema(e){return new ve({queryId:(0,be.createQueryId)(),executor:this.#o,node:O.create(e)})}alterTable(e){return new de({queryId:(0,be.createQueryId)(),executor:this.#o,node:m.create((0,W.parseTable)(e))})}createView(e){return new Ce({queryId:(0,be.createQueryId)(),executor:this.#o,node:Se.create(e)})}dropView(e){return new Te({queryId:(0,be.createQueryId)(),executor:this.#o,node:qe.create(e)})}createType(e){return new Ie({queryId:(0,be.createQueryId)(),executor:this.#o,node:ze.create(Qe(e))})}dropType(e){return new Ae({queryId:(0,be.createQueryId)(),executor:this.#o,node:Ee.create(Qe(e))})}withPlugin(e){return new De(this.#o.withPlugin(e))}withoutPlugins(){return new De(this.#o.withoutPlugins())}withSchema(e){return new De(this.#o.withPluginAtFront(new Oe.WithSchemaPlugin(e)))}}var Be=r(172695);class Le{ref(e){return new Be.DynamicReferenceBuilder(e)}}class Pe{#s;constructor(e){this.#s=e}async provideConnection(e){const t=await this.#s.acquireConnection();try{return await e(t)}finally{await this.#s.releaseConnection(t)}}}var Me=r(384391),Fe=r(884432);class Ve extends Fe.QueryExecutorBase{#a;#d;#p;constructor(e,t,r,i=[]){super(i),this.#a=e,this.#d=t,this.#p=r}get adapter(){return this.#d}compileQuery(e){return this.#a.compileQuery(e)}provideConnection(e){return this.#p.provideConnection(e)}withPlugins(e){return new Ve(this.#a,this.#d,this.#p,[...this.plugins,...e])}withPlugin(e){return new Ve(this.#a,this.#d,this.#p,[...this.plugins,e])}withPluginAtFront(e){return new Ve(this.#a,this.#d,this.#p,[e,...this.plugins])}withConnectionProvider(e){return new Ve(this.#a,this.#d,e,[...this.plugins])}withoutPlugins(){return new Ve(this.#a,this.#d,this.#p,[])}}function Je(){return"undefined"!==typeof performance&&(0,f.isFunction)(performance.now)?performance.now():Date.now()}class Ue{#s;#c;#u;#l;#h;#f=new WeakSet;constructor(e,t){this.#l=!1,this.#s=e,this.#c=t}async init(){if(this.#h)throw new Error("driver has already been destroyed");this.#u||(this.#u=this.#s.init().then((()=>{this.#l=!0})).catch((e=>(this.#u=void 0,Promise.reject(e))))),await this.#u}async acquireConnection(){if(this.#h)throw new Error("driver has already been destroyed");this.#l||await this.init();const e=await this.#s.acquireConnection();return this.#f.has(e)||(this.#m()&&this.#N(e),this.#f.add(e)),e}async releaseConnection(e){await this.#s.releaseConnection(e)}beginTransaction(e,t){return this.#s.beginTransaction(e,t)}commitTransaction(e){return this.#s.commitTransaction(e)}rollbackTransaction(e){return this.#s.rollbackTransaction(e)}async destroy(){this.#u&&(await this.#u,this.#h||(this.#h=this.#s.destroy().catch((e=>(this.#h=void 0,Promise.reject(e))))),await this.#h)}#m(){return this.#c.isLevelEnabled("query")||this.#c.isLevelEnabled("error")}#N(e){const t=e.executeQuery;e.executeQuery=async r=>{let i;const n=Je();try{return await t.call(e,r)}catch(o){throw i=o,await this.#y(o,r,n),o}finally{i||await this.#w(r,n)}}}async#y(e,t,r){await this.#c.error((()=>({level:"error",error:e,query:t,queryDurationMillis:this.#g(r)})))}async#w(e,t){await this.#c.query((()=>({level:"query",query:e,queryDurationMillis:this.#g(t)})))}#g(e){return Je()-e}}const $e=()=>{};class je{#v;#x;constructor(e){this.#v=e}async provideConnection(e){for(;this.#x;)await this.#x.catch($e);return this.#x=this.#b(e).finally((()=>{this.#x=void 0})),this.#x}async#b(e){return await e(this.#v)}}const Ke=["read uncommitted","read committed","repeatable read","serializable","snapshot"];var Ge=r(643366);(0,f.freeze)(["query","error"]);class _e{#O;#S;constructor(e){(0,f.isFunction)(e)?(this.#S=e,this.#O=(0,f.freeze)({query:!0,error:!0})):(this.#S=He,this.#O=(0,f.freeze)({query:e.includes("query"),error:e.includes("error")}))}isLevelEnabled(e){return this.#O[e]}async query(e){this.#O.query&&await this.#S(e())}async error(e){this.#O.error&&await this.#S(e())}}function He(e){"query"===e.level?(console.log(`kysely:query: ${e.query.sql}`),console.log(`kysely:query: duration: ${e.queryDurationMillis.toFixed(1)}ms`)):"error"===e.level&&(e.error instanceof Error?console.error(`kysely:error: ${e.error.stack??e.error.message}`):console.error(`kysely:error: ${JSON.stringify({error:e.error,query:e.query.sql,queryDurationMillis:e.queryDurationMillis})}`))}var Ye=r(20589),Xe=r(323964);class Ze extends Me.QueryCreator{#i;constructor(e){let t,r;if(i=e,(0,f.isObject)(i)&&(0,f.isObject)(i.config)&&(0,f.isObject)(i.driver)&&(0,f.isObject)(i.executor)&&(0,f.isObject)(i.dialect))t={executor:e.executor},r={...e};else{const i=e.dialect,n=i.createDriver(),o=i.createQueryCompiler(),s=i.createAdapter(),a=new _e(e.log??[]),d=new Ue(n,a),p=new Pe(d),c=new Ve(o,s,p,e.plugins??[]);t={executor:c},r={config:e,executor:c,dialect:i,driver:d}}var i;super(t),this.#i=(0,f.freeze)(r)}get schema(){return new De(this.#i.executor)}get dynamic(){return new Le}get introspection(){return this.#i.dialect.createIntrospector(this.withoutPlugins())}case(e){return new Ye.CaseBuilder({node:Xe.CaseNode.create((0,f.isUndefined)(e)?void 0:(0,ye.parseExpression)(e))})}get fn(){return(0,Ge.createFunctionModule)()}transaction(){return new rt({...this.#i})}connection(){return new tt({...this.#i})}withPlugin(e){return new Ze({...this.#i,executor:this.#i.executor.withPlugin(e)})}withoutPlugins(){return new Ze({...this.#i,executor:this.#i.executor.withoutPlugins()})}withSchema(e){return new Ze({...this.#i,executor:this.#i.executor.withPluginAtFront(new Oe.WithSchemaPlugin(e))})}withTables(){return new Ze({...this.#i})}async destroy(){await this.#i.driver.destroy()}get isTransaction(){return!1}getExecutor(){return this.#i.executor}executeQuery(e,t=(0,be.createQueryId)()){const r=(i=e,(0,f.isObject)(i)&&(0,f.isFunction)(i.compile)?e.compile():e);var i;return this.getExecutor().executeQuery(r,t)}}class et extends Ze{#i;constructor(e){super(e),this.#i=e}get isTransaction(){return!0}transaction(){throw new Error("calling the transaction method for a Transaction is not supported")}connection(){throw new Error("calling the connection method for a Transaction is not supported")}async destroy(){throw new Error("calling the destroy method for a Transaction is not supported")}withPlugin(e){return new et({...this.#i,executor:this.#i.executor.withPlugin(e)})}withoutPlugins(){return new et({...this.#i,executor:this.#i.executor.withoutPlugins()})}withSchema(e){return new et({...this.#i,executor:this.#i.executor.withPluginAtFront(new Oe.WithSchemaPlugin(e))})}withTables(){return new et({...this.#i})}}class tt{#i;constructor(e){this.#i=(0,f.freeze)(e)}async execute(e){return this.#i.executor.provideConnection((async t=>{const r=this.#i.executor.withConnectionProvider(new je(t)),i=new Ze({...this.#i,executor:r});return await e(i)}))}}(0,I.preventAwait)(tt,"don't await ConnectionBuilder instances directly. To execute the query you need to call the `execute` method");class rt{#i;constructor(e){this.#i=(0,f.freeze)(e)}setIsolationLevel(e){return new rt({...this.#i,isolationLevel:e})}async execute(e){const{isolationLevel:t,...r}=this.#i,i={isolationLevel:t};return function(e){if(e.isolationLevel&&!Ke.includes(e.isolationLevel))throw new Error(`invalid transaction isolation level ${e.isolationLevel}`)}(i),this.#i.executor.provideConnection((async t=>{const n=this.#i.executor.withConnectionProvider(new je(t)),o=new et({...r,executor:n});try{await this.#i.driver.beginTransaction(t,i);const r=await e(o);return await this.#i.driver.commitTransaction(t),r}catch(s){throw await this.#i.driver.rollbackTransaction(t),s}}))}}(0,I.preventAwait)(rt,"don't await TransactionBuilder instances directly. To execute the transaction you need to call the `execute` method");class it{get supportsCreateIfNotExists(){return!0}get supportsTransactionalDdl(){return!1}get supportsReturning(){return!1}get supportsOutput(){return!1}}class nt extends it{get supportsTransactionalDdl(){return!1}get supportsReturning(){return!0}async acquireMigrationLock(e,t){}async releaseMigrationLock(e,t){}}class ot{async init(){}async acquireConnection(){return new st}async beginTransaction(){}async commitTransaction(){}async rollbackTransaction(){}async releaseConnection(){}async destroy(){}}class st{async executeQuery(){return{rows:[]}}async*streamQuery(){}}var at=r(72396);class dt{nodeStack=[];get parentNode(){return this.nodeStack[this.nodeStack.length-2]}#W=(0,f.freeze)({AliasNode:this.visitAlias.bind(this),ColumnNode:this.visitColumn.bind(this),IdentifierNode:this.visitIdentifier.bind(this),SchemableIdentifierNode:this.visitSchemableIdentifier.bind(this),RawNode:this.visitRaw.bind(this),ReferenceNode:this.visitReference.bind(this),SelectQueryNode:this.visitSelectQuery.bind(this),SelectionNode:this.visitSelection.bind(this),TableNode:this.visitTable.bind(this),FromNode:this.visitFrom.bind(this),SelectAllNode:this.visitSelectAll.bind(this),AndNode:this.visitAnd.bind(this),OrNode:this.visitOr.bind(this),ValueNode:this.visitValue.bind(this),ValueListNode:this.visitValueList.bind(this),PrimitiveValueListNode:this.visitPrimitiveValueList.bind(this),ParensNode:this.visitParens.bind(this),JoinNode:this.visitJoin.bind(this),OperatorNode:this.visitOperator.bind(this),WhereNode:this.visitWhere.bind(this),InsertQueryNode:this.visitInsertQuery.bind(this),DeleteQueryNode:this.visitDeleteQuery.bind(this),ReturningNode:this.visitReturning.bind(this),CreateTableNode:this.visitCreateTable.bind(this),AddColumnNode:this.visitAddColumn.bind(this),ColumnDefinitionNode:this.visitColumnDefinition.bind(this),DropTableNode:this.visitDropTable.bind(this),DataTypeNode:this.visitDataType.bind(this),OrderByNode:this.visitOrderBy.bind(this),OrderByItemNode:this.visitOrderByItem.bind(this),GroupByNode:this.visitGroupBy.bind(this),GroupByItemNode:this.visitGroupByItem.bind(this),UpdateQueryNode:this.visitUpdateQuery.bind(this),ColumnUpdateNode:this.visitColumnUpdate.bind(this),LimitNode:this.visitLimit.bind(this),OffsetNode:this.visitOffset.bind(this),OnConflictNode:this.visitOnConflict.bind(this),OnDuplicateKeyNode:this.visitOnDuplicateKey.bind(this),CreateIndexNode:this.visitCreateIndex.bind(this),DropIndexNode:this.visitDropIndex.bind(this),ListNode:this.visitList.bind(this),PrimaryKeyConstraintNode:this.visitPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.visitUniqueConstraint.bind(this),ReferencesNode:this.visitReferences.bind(this),CheckConstraintNode:this.visitCheckConstraint.bind(this),WithNode:this.visitWith.bind(this),CommonTableExpressionNode:this.visitCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.visitCommonTableExpressionName.bind(this),HavingNode:this.visitHaving.bind(this),CreateSchemaNode:this.visitCreateSchema.bind(this),DropSchemaNode:this.visitDropSchema.bind(this),AlterTableNode:this.visitAlterTable.bind(this),DropColumnNode:this.visitDropColumn.bind(this),RenameColumnNode:this.visitRenameColumn.bind(this),AlterColumnNode:this.visitAlterColumn.bind(this),ModifyColumnNode:this.visitModifyColumn.bind(this),AddConstraintNode:this.visitAddConstraint.bind(this),DropConstraintNode:this.visitDropConstraint.bind(this),ForeignKeyConstraintNode:this.visitForeignKeyConstraint.bind(this),CreateViewNode:this.visitCreateView.bind(this),DropViewNode:this.visitDropView.bind(this),GeneratedNode:this.visitGenerated.bind(this),DefaultValueNode:this.visitDefaultValue.bind(this),OnNode:this.visitOn.bind(this),ValuesNode:this.visitValues.bind(this),SelectModifierNode:this.visitSelectModifier.bind(this),CreateTypeNode:this.visitCreateType.bind(this),DropTypeNode:this.visitDropType.bind(this),ExplainNode:this.visitExplain.bind(this),DefaultInsertValueNode:this.visitDefaultInsertValue.bind(this),AggregateFunctionNode:this.visitAggregateFunction.bind(this),OverNode:this.visitOver.bind(this),PartitionByNode:this.visitPartitionBy.bind(this),PartitionByItemNode:this.visitPartitionByItem.bind(this),SetOperationNode:this.visitSetOperation.bind(this),BinaryOperationNode:this.visitBinaryOperation.bind(this),UnaryOperationNode:this.visitUnaryOperation.bind(this),UsingNode:this.visitUsing.bind(this),FunctionNode:this.visitFunction.bind(this),CaseNode:this.visitCase.bind(this),WhenNode:this.visitWhen.bind(this),JSONReferenceNode:this.visitJSONReference.bind(this),JSONPathNode:this.visitJSONPath.bind(this),JSONPathLegNode:this.visitJSONPathLeg.bind(this),JSONOperatorChainNode:this.visitJSONOperatorChain.bind(this),TupleNode:this.visitTuple.bind(this),MergeQueryNode:this.visitMergeQuery.bind(this),MatchedNode:this.visitMatched.bind(this),AddIndexNode:this.visitAddIndex.bind(this),CastNode:this.visitCast.bind(this),FetchNode:this.visitFetch.bind(this),TopNode:this.visitTop.bind(this),OutputNode:this.visitOutput.bind(this)});visitNode=e=>{this.nodeStack.push(e),this.#W[e.kind](e),this.nodeStack.pop()}}var pt=r(871624),ct=r(367071),ut=r(657444),lt=r(938691);class ht extends dt{#C="";#q=[];get numParameters(){return this.#q.length}compileQuery(e){return this.#C="",this.#q=[],this.nodeStack.splice(0,this.nodeStack.length),this.visitNode(e),(0,f.freeze)({query:e,sql:this.getSql(),parameters:[...this.#q]})}getSql(){return this.#C}visitSelectQuery(e){const t=void 0!==this.parentNode&&!ct.ParensNode.is(this.parentNode)&&!at.InsertQueryNode.is(this.parentNode)&&!v.is(this.parentNode)&&!Se.is(this.parentNode)&&!ut.SetOperationNode.is(this.parentNode);void 0===this.parentNode&&e.explain&&(this.visitNode(e.explain),this.append(" ")),t&&this.append("("),e.with&&(this.visitNode(e.with),this.append(" ")),this.append("select"),e.distinctOn&&(this.append(" "),this.compileDistinctOn(e.distinctOn)),e.frontModifiers?.length&&(this.append(" "),this.compileList(e.frontModifiers," ")),e.top&&(this.append(" "),this.visitNode(e.top)),e.selections&&(this.append(" "),this.compileList(e.selections)),e.from&&(this.append(" "),this.visitNode(e.from)),e.joins&&(this.append(" "),this.compileList(e.joins," ")),e.where&&(this.append(" "),this.visitNode(e.where)),e.groupBy&&(this.append(" "),this.visitNode(e.groupBy)),e.having&&(this.append(" "),this.visitNode(e.having)),e.setOperations&&(this.append(" "),this.compileList(e.setOperations," ")),e.orderBy&&(this.append(" "),this.visitNode(e.orderBy)),e.limit&&(this.append(" "),this.visitNode(e.limit)),e.offset&&(this.append(" "),this.visitNode(e.offset)),e.fetch&&(this.append(" "),this.visitNode(e.fetch)),e.endModifiers?.length&&(this.append(" "),this.compileList(this.sortSelectModifiers([...e.endModifiers])," ")),t&&this.append(")")}visitFrom(e){this.append("from "),this.compileList(e.froms)}visitSelection(e){this.visitNode(e.selection)}visitColumn(e){this.visitNode(e.column)}compileDistinctOn(e){this.append("distinct on ("),this.compileList(e),this.append(")")}compileList(e,t=", "){const r=e.length-1;for(let i=0;i<=r;i++)this.visitNode(e[i]),i<r&&this.append(t)}visitWhere(e){this.append("where "),this.visitNode(e.where)}visitHaving(e){this.append("having "),this.visitNode(e.having)}visitInsertQuery(e){const t=this.nodeStack.find(ue.QueryNode.is),r=t!==e;!r&&e.explain&&(this.visitNode(e.explain),this.append(" ")),r&&!lt.MergeQueryNode.is(t)&&this.append("("),e.with&&(this.visitNode(e.with),this.append(" ")),this.append(e.replace?"replace":"insert"),e.ignore&&this.append(" ignore"),e.top&&(this.append(" "),this.visitNode(e.top)),e.into&&(this.append(" into "),this.visitNode(e.into)),e.columns&&(this.append(" ("),this.compileList(e.columns),this.append(")")),e.output&&(this.append(" "),this.visitNode(e.output)),e.values&&(this.append(" "),this.visitNode(e.values)),e.defaultValues&&(this.append(" "),this.append("default values")),e.onConflict&&(this.append(" "),this.visitNode(e.onConflict)),e.onDuplicateKey&&(this.append(" "),this.visitNode(e.onDuplicateKey)),e.returning&&(this.append(" "),this.visitNode(e.returning)),r&&!lt.MergeQueryNode.is(t)&&this.append(")")}visitValues(e){this.append("values "),this.compileList(e.values)}visitDeleteQuery(e){const t=this.nodeStack.find(ue.QueryNode.is)!==e;!t&&e.explain&&(this.visitNode(e.explain),this.append(" ")),t&&this.append("("),e.with&&(this.visitNode(e.with),this.append(" ")),this.append("delete "),e.top&&(this.visitNode(e.top),this.append(" ")),this.visitNode(e.from),e.output&&(this.append(" "),this.visitNode(e.output)),e.using&&(this.append(" "),this.visitNode(e.using)),e.joins&&(this.append(" "),this.compileList(e.joins," ")),e.where&&(this.append(" "),this.visitNode(e.where)),e.orderBy&&(this.append(" "),this.visitNode(e.orderBy)),e.limit&&(this.append(" "),this.visitNode(e.limit)),e.returning&&(this.append(" "),this.visitNode(e.returning)),t&&this.append(")")}visitReturning(e){this.append("returning "),this.compileList(e.selections)}visitAlias(e){this.visitNode(e.node),this.append(" as "),this.visitNode(e.alias)}visitReference(e){e.table&&(this.visitNode(e.table),this.append(".")),this.visitNode(e.column)}visitSelectAll(e){this.append("*")}visitIdentifier(e){this.append(this.getLeftIdentifierWrapper()),this.compileUnwrappedIdentifier(e),this.append(this.getRightIdentifierWrapper())}compileUnwrappedIdentifier(e){if(!(0,f.isString)(e.name))throw new Error("a non-string identifier was passed to compileUnwrappedIdentifier.");this.append(this.sanitizeIdentifier(e.name))}visitAnd(e){this.visitNode(e.left),this.append(" and "),this.visitNode(e.right)}visitOr(e){this.visitNode(e.left),this.append(" or "),this.visitNode(e.right)}visitValue(e){e.immediate?this.appendImmediateValue(e.value):this.appendValue(e.value)}visitValueList(e){this.append("("),this.compileList(e.values),this.append(")")}visitTuple(e){this.append("("),this.compileList(e.values),this.append(")")}visitPrimitiveValueList(e){this.append("(");const{values:t}=e;for(let r=0;r<t.length;++r)this.appendValue(t[r]),r!==t.length-1&&this.append(", ");this.append(")")}visitParens(e){this.append("("),this.visitNode(e.node),this.append(")")}visitJoin(e){this.append(Nt[e.joinType]),this.append(" "),this.visitNode(e.table),e.on&&(this.append(" "),this.visitNode(e.on))}visitOn(e){this.append("on "),this.visitNode(e.on)}visitRaw(e){const{sqlFragments:t,parameters:r}=e;for(let i=0;i<t.length;++i)this.append(t[i]),r.length>i&&this.visitNode(r[i])}visitOperator(e){this.append(e.operator)}visitTable(e){this.visitNode(e.table)}visitSchemableIdentifier(e){e.schema&&(this.visitNode(e.schema),this.append(".")),this.visitNode(e.identifier)}visitCreateTable(e){this.append("create "),e.frontModifiers&&e.frontModifiers.length>0&&(this.compileList(e.frontModifiers," "),this.append(" ")),e.temporary&&this.append("temporary "),this.append("table "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.table),e.selectQuery?(this.append(" as "),this.visitNode(e.selectQuery)):(this.append(" ("),this.compileList([...e.columns,...e.constraints??[]]),this.append(")"),e.onCommit&&(this.append(" on commit "),this.append(e.onCommit)),e.endModifiers&&e.endModifiers.length>0&&(this.append(" "),this.compileList(e.endModifiers," ")))}visitColumnDefinition(e){e.ifNotExists&&this.append("if not exists "),this.visitNode(e.column),this.append(" "),this.visitNode(e.dataType),e.unsigned&&this.append(" unsigned"),e.frontModifiers&&e.frontModifiers.length>0&&(this.append(" "),this.compileList(e.frontModifiers," ")),e.generated&&(this.append(" "),this.visitNode(e.generated)),e.identity&&this.append(" identity"),e.defaultTo&&(this.append(" "),this.visitNode(e.defaultTo)),e.notNull&&this.append(" not null"),e.unique&&this.append(" unique"),e.nullsNotDistinct&&this.append(" nulls not distinct"),e.primaryKey&&this.append(" primary key"),e.autoIncrement&&(this.append(" "),this.append(this.getAutoIncrement())),e.references&&(this.append(" "),this.visitNode(e.references)),e.check&&(this.append(" "),this.visitNode(e.check)),e.endModifiers&&e.endModifiers.length>0&&(this.append(" "),this.compileList(e.endModifiers," "))}getAutoIncrement(){return"auto_increment"}visitReferences(e){this.append("references "),this.visitNode(e.table),this.append(" ("),this.compileList(e.columns),this.append(")"),e.onDelete&&(this.append(" on delete "),this.append(e.onDelete)),e.onUpdate&&(this.append(" on update "),this.append(e.onUpdate))}visitDropTable(e){this.append("drop table "),e.ifExists&&this.append("if exists "),this.visitNode(e.table),e.cascade&&this.append(" cascade")}visitDataType(e){this.append(e.dataType)}visitOrderBy(e){this.append("order by "),this.compileList(e.items)}visitOrderByItem(e){this.visitNode(e.orderBy),e.direction&&(this.append(" "),this.visitNode(e.direction))}visitGroupBy(e){this.append("group by "),this.compileList(e.items)}visitGroupByItem(e){this.visitNode(e.groupBy)}visitUpdateQuery(e){const t=this.nodeStack.find(ue.QueryNode.is),r=t!==e;!r&&e.explain&&(this.visitNode(e.explain),this.append(" ")),r&&!lt.MergeQueryNode.is(t)&&this.append("("),e.with&&(this.visitNode(e.with),this.append(" ")),this.append("update "),e.top&&(this.visitNode(e.top),this.append(" ")),e.table&&(this.visitNode(e.table),this.append(" ")),this.append("set "),e.updates&&this.compileList(e.updates),e.output&&(this.append(" "),this.visitNode(e.output)),e.from&&(this.append(" "),this.visitNode(e.from)),e.joins&&(this.append(" "),this.compileList(e.joins," ")),e.where&&(this.append(" "),this.visitNode(e.where)),e.limit&&(this.append(" "),this.visitNode(e.limit)),e.returning&&(this.append(" "),this.visitNode(e.returning)),r&&!lt.MergeQueryNode.is(t)&&this.append(")")}visitColumnUpdate(e){this.visitNode(e.column),this.append(" = "),this.visitNode(e.value)}visitLimit(e){this.append("limit "),this.visitNode(e.limit)}visitOffset(e){this.append("offset "),this.visitNode(e.offset)}visitOnConflict(e){this.append("on conflict"),e.columns?(this.append(" ("),this.compileList(e.columns),this.append(")")):e.constraint?(this.append(" on constraint "),this.visitNode(e.constraint)):e.indexExpression&&(this.append(" ("),this.visitNode(e.indexExpression),this.append(")")),e.indexWhere&&(this.append(" "),this.visitNode(e.indexWhere)),!0===e.doNothing?this.append(" do nothing"):e.updates&&(this.append(" do update set "),this.compileList(e.updates),e.updateWhere&&(this.append(" "),this.visitNode(e.updateWhere)))}visitOnDuplicateKey(e){this.append("on duplicate key update "),this.compileList(e.updates)}visitCreateIndex(e){this.append("create "),e.unique&&this.append("unique "),this.append("index "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.name),e.table&&(this.append(" on "),this.visitNode(e.table)),e.using&&(this.append(" using "),this.visitNode(e.using)),e.columns&&(this.append(" ("),this.compileList(e.columns),this.append(")")),e.nullsNotDistinct&&this.append(" nulls not distinct"),e.where&&(this.append(" "),this.visitNode(e.where))}visitDropIndex(e){this.append("drop index "),e.ifExists&&this.append("if exists "),this.visitNode(e.name),e.table&&(this.append(" on "),this.visitNode(e.table)),e.cascade&&this.append(" cascade")}visitCreateSchema(e){this.append("create schema "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.schema)}visitDropSchema(e){this.append("drop schema "),e.ifExists&&this.append("if exists "),this.visitNode(e.schema),e.cascade&&this.append(" cascade")}visitPrimaryKeyConstraint(e){e.name&&(this.append("constraint "),this.visitNode(e.name),this.append(" ")),this.append("primary key ("),this.compileList(e.columns),this.append(")")}visitUniqueConstraint(e){e.name&&(this.append("constraint "),this.visitNode(e.name),this.append(" ")),this.append("unique"),e.nullsNotDistinct&&this.append(" nulls not distinct"),this.append(" ("),this.compileList(e.columns),this.append(")")}visitCheckConstraint(e){e.name&&(this.append("constraint "),this.visitNode(e.name),this.append(" ")),this.append("check ("),this.visitNode(e.expression),this.append(")")}visitForeignKeyConstraint(e){e.name&&(this.append("constraint "),this.visitNode(e.name),this.append(" ")),this.append("foreign key ("),this.compileList(e.columns),this.append(") "),this.visitNode(e.references),e.onDelete&&(this.append(" on delete "),this.append(e.onDelete)),e.onUpdate&&(this.append(" on update "),this.append(e.onUpdate))}visitList(e){this.compileList(e.items)}visitWith(e){this.append("with "),e.recursive&&this.append("recursive "),this.compileList(e.expressions)}visitCommonTableExpression(e){this.visitNode(e.name),this.append(" as "),(0,f.isBoolean)(e.materialized)&&(e.materialized||this.append("not "),this.append("materialized ")),this.visitNode(e.expression)}visitCommonTableExpressionName(e){this.visitNode(e.table),e.columns&&(this.append("("),this.compileList(e.columns),this.append(")"))}visitAlterTable(e){this.append("alter table "),this.visitNode(e.table),this.append(" "),e.renameTo&&(this.append("rename to "),this.visitNode(e.renameTo)),e.setSchema&&(this.append("set schema "),this.visitNode(e.setSchema)),e.addConstraint&&this.visitNode(e.addConstraint),e.dropConstraint&&this.visitNode(e.dropConstraint),e.columnAlterations&&this.compileColumnAlterations(e.columnAlterations),e.addIndex&&this.visitNode(e.addIndex),e.dropIndex&&this.visitNode(e.dropIndex)}visitAddColumn(e){this.append("add column "),this.visitNode(e.column)}visitRenameColumn(e){this.append("rename column "),this.visitNode(e.column),this.append(" to "),this.visitNode(e.renameTo)}visitDropColumn(e){this.append("drop column "),this.visitNode(e.column)}visitAlterColumn(e){this.append("alter column "),this.visitNode(e.column),this.append(" "),e.dataType&&(this.announcesNewColumnDataType()&&this.append("type "),this.visitNode(e.dataType),e.dataTypeExpression&&(this.append("using "),this.visitNode(e.dataTypeExpression))),e.setDefault&&(this.append("set default "),this.visitNode(e.setDefault)),e.dropDefault&&this.append("drop default"),e.setNotNull&&this.append("set not null"),e.dropNotNull&&this.append("drop not null")}visitModifyColumn(e){this.append("modify column "),this.visitNode(e.column)}visitAddConstraint(e){this.append("add "),this.visitNode(e.constraint)}visitDropConstraint(e){this.append("drop constraint "),e.ifExists&&this.append("if exists "),this.visitNode(e.constraintName),"cascade"===e.modifier?this.append(" cascade"):"restrict"===e.modifier&&this.append(" restrict")}visitSetOperation(e){this.append(e.operator),this.append(" "),e.all&&this.append("all "),this.visitNode(e.expression)}visitCreateView(e){this.append("create "),e.orReplace&&this.append("or replace "),e.materialized&&this.append("materialized "),e.temporary&&this.append("temporary "),this.append("view "),e.ifNotExists&&this.append("if not exists "),this.visitNode(e.name),this.append(" "),e.columns&&(this.append("("),this.compileList(e.columns),this.append(") ")),e.as&&(this.append("as "),this.visitNode(e.as))}visitDropView(e){this.append("drop "),e.materialized&&this.append("materialized "),this.append("view "),e.ifExists&&this.append("if exists "),this.visitNode(e.name),e.cascade&&this.append(" cascade")}visitGenerated(e){this.append("generated "),e.always&&this.append("always "),e.byDefault&&this.append("by default "),this.append("as "),e.identity&&this.append("identity"),e.expression&&(this.append("("),this.visitNode(e.expression),this.append(")")),e.stored&&this.append(" stored")}visitDefaultValue(e){this.append("default "),this.visitNode(e.defaultValue)}visitSelectModifier(e){e.rawModifier?this.visitNode(e.rawModifier):this.append(ft[e.modifier]),e.of&&(this.append(" of "),this.compileList(e.of,", "))}visitCreateType(e){this.append("create type "),this.visitNode(e.name),e.enum&&(this.append(" as enum "),this.visitNode(e.enum))}visitDropType(e){this.append("drop type "),e.ifExists&&this.append("if exists "),this.visitNode(e.name)}visitExplain(e){this.append("explain"),(e.options||e.format)&&(this.append(" "),this.append(this.getLeftExplainOptionsWrapper()),e.options&&(this.visitNode(e.options),e.format&&this.append(this.getExplainOptionsDelimiter())),e.format&&(this.append("format"),this.append(this.getExplainOptionAssignment()),this.append(e.format)),this.append(this.getRightExplainOptionsWrapper()))}visitDefaultInsertValue(e){this.append("default")}visitAggregateFunction(e){this.append(e.func),this.append("("),e.distinct&&this.append("distinct "),this.compileList(e.aggregated),this.append(")"),e.filter&&(this.append(" filter("),this.visitNode(e.filter),this.append(")")),e.over&&(this.append(" "),this.visitNode(e.over))}visitOver(e){this.append("over("),e.partitionBy&&(this.visitNode(e.partitionBy),e.orderBy&&this.append(" ")),e.orderBy&&this.visitNode(e.orderBy),this.append(")")}visitPartitionBy(e){this.append("partition by "),this.compileList(e.items)}visitPartitionByItem(e){this.visitNode(e.partitionBy)}visitBinaryOperation(e){this.visitNode(e.leftOperand),this.append(" "),this.visitNode(e.operator),this.append(" "),this.visitNode(e.rightOperand)}visitUnaryOperation(e){this.visitNode(e.operator),this.isMinusOperator(e.operator)||this.append(" "),this.visitNode(e.operand)}isMinusOperator(e){return pt.OperatorNode.is(e)&&"-"===e.operator}visitUsing(e){this.append("using "),this.compileList(e.tables)}visitFunction(e){this.append(e.func),this.append("("),this.compileList(e.arguments),this.append(")")}visitCase(e){this.append("case"),e.value&&(this.append(" "),this.visitNode(e.value)),e.when&&(this.append(" "),this.compileList(e.when," ")),e.else&&(this.append(" else "),this.visitNode(e.else)),this.append(" end"),e.isStatement&&this.append(" case")}visitWhen(e){this.append("when "),this.visitNode(e.condition),e.result&&(this.append(" then "),this.visitNode(e.result))}visitJSONReference(e){this.visitNode(e.reference),this.visitNode(e.traversal)}visitJSONPath(e){e.inOperator&&this.visitNode(e.inOperator),this.append("'$");for(const t of e.pathLegs)this.visitNode(t);this.append("'")}visitJSONPathLeg(e){const t="ArrayLocation"===e.type;this.append(t?"[":"."),this.append(String(e.value)),t&&this.append("]")}visitJSONOperatorChain(e){for(let t=0,r=e.values.length;t<r;t++)t===r-1?this.visitNode(e.operator):this.append("->"),this.visitNode(e.values[t])}visitMergeQuery(e){e.with&&(this.visitNode(e.with),this.append(" ")),this.append("merge "),e.top&&(this.visitNode(e.top),this.append(" ")),this.append("into "),this.visitNode(e.into),e.using&&(this.append(" "),this.visitNode(e.using)),e.whens&&(this.append(" "),this.compileList(e.whens," ")),e.output&&(this.append(" "),this.visitNode(e.output))}visitMatched(e){e.not&&this.append("not "),this.append("matched"),e.bySource&&this.append(" by source")}visitAddIndex(e){this.append("add "),e.unique&&this.append("unique "),this.append("index "),this.visitNode(e.name),e.columns&&(this.append(" ("),this.compileList(e.columns),this.append(")")),e.using&&(this.append(" using "),this.visitNode(e.using))}visitCast(e){this.append("cast("),this.visitNode(e.expression),this.append(" as "),this.visitNode(e.dataType),this.append(")")}visitFetch(e){this.append("fetch next "),this.visitNode(e.rowCount),this.append(` rows ${e.modifier}`)}visitOutput(e){this.append("output "),this.compileList(e.selections)}visitTop(e){this.append(`top(${e.expression})`),e.modifiers&&this.append(` ${e.modifiers}`)}append(e){this.#C+=e}appendValue(e){this.addParameter(e),this.append(this.getCurrentParameterPlaceholder())}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getCurrentParameterPlaceholder(){return"$"+this.numParameters}getLeftExplainOptionsWrapper(){return"("}getExplainOptionAssignment(){return" "}getExplainOptionsDelimiter(){return", "}getRightExplainOptionsWrapper(){return")"}sanitizeIdentifier(e){const t=this.getLeftIdentifierWrapper(),r=this.getRightIdentifierWrapper();let i="";for(const n of e)i+=n,n===t?i+=t:n===r&&(i+=r);return i}addParameter(e){this.#q.push(e)}appendImmediateValue(e){if((0,f.isString)(e))this.append(`'${e}'`);else if((0,f.isNumber)(e)||(0,f.isBoolean)(e))this.append(e.toString());else if((0,f.isNull)(e))this.append("null");else if((0,f.isDate)(e))this.appendImmediateValue(e.toISOString());else{if(!(0,f.isBigInt)(e))throw new Error(`invalid immediate value ${e}`);this.appendImmediateValue(e.toString())}}sortSelectModifiers(e){return e.sort(((e,t)=>e.modifier&&t.modifier?mt[e.modifier]-mt[t.modifier]:1)),(0,f.freeze)(e)}compileColumnAlterations(e){this.compileList(e)}announcesNewColumnDataType(){return!0}}const ft=(0,f.freeze)({ForKeyShare:"for key share",ForNoKeyUpdate:"for no key update",ForUpdate:"for update",ForShare:"for share",NoWait:"nowait",SkipLocked:"skip locked",Distinct:"distinct"}),mt=(0,f.freeze)({ForKeyShare:1,ForNoKeyUpdate:1,ForUpdate:1,ForShare:1,NoWait:2,SkipLocked:2,Distinct:0}),Nt=(0,f.freeze)({InnerJoin:"inner join",LeftJoin:"left join",RightJoin:"right join",FullJoin:"full join",LateralInnerJoin:"inner join lateral",LateralLeftJoin:"left join lateral",Using:"using"}),yt=/"/g;class wt extends ht{getCurrentParameterPlaceholder(){return"?"}getLeftExplainOptionsWrapper(){return""}getRightExplainOptionsWrapper(){return""}getLeftIdentifierWrapper(){return'"'}getRightIdentifierWrapper(){return'"'}getAutoIncrement(){return"autoincrement"}sanitizeIdentifier(e){return e.replace(yt,'""')}visitDefaultInsertValue(e){this.append("null")}}var gt=r(684802),vt=r(752066);let xt,bt,Ot,St=!1;let Wt;const Ct=(e,t)=>{"string"!==typeof t.data&&!0!==St&&(clearTimeout(xt),xt=void 0,xt=setTimeout((()=>{St=!0,e({refreshQueries:!0})(),clearTimeout(xt),xt=void 0,bt=setTimeout((()=>{St=!1}),500)}),500))},qt=(e,t,r)=>t.externalWebsocketConnection?(t.externalWebsocketConnection.send(JSON.stringify({message:"subscribe",channelId:r.id})),t.externalWebsocketConnection.addEventListener("message",(t=>Ct(e,t))),t.externalWebsocketConnection):t.enableWebsocketConnection?(Wt=new WebSocket(t.syncUrl?.replace("http","ws")),Wt.addEventListener("message",(t=>Ct(e,t))),Wt.onerror=e=>{console.error("WebSocket error:",e)},Wt.onclose=()=>{Ot=setTimeout((()=>qt(e,t,r)),3e3)},Wt.onopen=()=>{Wt.send(JSON.stringify({message:"subscribe",channelId:r.id})),clearTimeout(Ot)},Wt):void 0;var Tt=r(990526),kt=r(467339),zt=r(145916),It=r(922143),Et=r(54096),At=r(790623),Qt=r(477966);class Rt extends(s.Tag("EvoluFactory")()){}Rt.Common=p.effect(Rt,a.gen((function*(){const e=yield*a.map(a.serviceOption(It.FlushSync),u.getOrElse((()=>e=>e()))),t=s.empty().pipe(s.add(Tt.DbFactory,yield*Tt.DbFactory),s.add(vt.NanoIdGenerator,yield*vt.NanoIdGenerator),s.add(It.FlushSync,e),s.add(It.AppState,yield*It.AppState)),r=new Map;return Rt.of({createEvolu:(e,{indexes:i,initialData:n,mnemonic:o,...s}={})=>{const d=(0,gt.createRuntime)(s),p=s?.name||gt.defaultConfig.name,c={tables:Dt(e),indexes:i||[]};let u=r.get(p);return null==u?(u=Lt(c,d,n,o).pipe(a.provide(t),d.runSync),r.set(p,u)):u.ensureSchema(c),u}})})));const Dt=e=>(0,d.pipe)(Bt(e),h.toEntries,o.map((([e,t])=>({name:e,columns:Object.keys(Bt(t))})))),Bt=e=>{const t={},r=i.getPropertySignatures(e.ast);for(let i=0;i<r.length;i++){const e=r[i];t[e.name]=(0,n.make)(e.type)}return t},Lt=(e,t,r,i)=>a.gen((function*(){yield*a.logTrace("EvoluFactory createEvolu");const n=yield*gt.Config,s=yield*Tt.DbFactory,p=yield*It.AppState,u=yield*vt.NanoIdGenerator,h=yield*It.FlushSync,f=yield*s.createDb,m=yield*(0,At.makeStore)(null),N=yield*(0,At.makeStore)(null),y=yield*(0,At.makeStore)(new Map),w=yield*(0,At.makeStore)(Qt.initialSyncState),g=new Map,v=new Map,x=e=>e.pipe(a.catchAllDefect((e=>a.fail((0,zt.makeUnexpectedError)(e)))),a.tapError(a.logError),a.tapError(m.setState)),b=(0,d.flow)(x,t.runFork),O=(0,d.flow)(x,t.runSync),S=(0,d.flow)(x,t.runPromise),W=yield*a.provideService(Pt(r),vt.NanoIdGenerator,u),C=({refreshQueries:e})=>()=>{a.flatMap(f.sync(e?[...v.keys()]:[]),z()).pipe(b)};f.init(e,W,(e=>{a.fail(e).pipe(b)}),(e=>{a.logDebug(["Evolu handleSyncStateChange",{state:e}]).pipe(a.zipRight(w.setState(e)),b)}),(()=>{a.gen((function*(){yield*a.logTrace("Evolu handleDbReceive"),A();const e=[...v.keys()];e.length>0&&(yield*a.flatMap(f.loadQueries(e),z()))})).pipe(b)}),i).pipe(a.tap(C({refreshQueries:!1})),a.flatMap(N.setState),a.catchTag("NotSupportedPlatformError",(()=>a.void)),b);let q=!1;const T=new Promise((e=>{N.subscribe((()=>{const t=N.getState();q||"string"!==typeof t?.id||(q=!0,e(qt(C,n,t)))}))})),k=yield*p.init({onRequestSync:C({refreshQueries:!0}),reloadUrl:n.reloadUrl}),z=e=>t=>a.logDebug(["Evolu handlePatches",{patches:t}]).pipe(a.zipRight(I(t)),a.tap((e=>a.forEach(t,(({query:t})=>E(t,e.get(t)||(0,Tt.emptyRows)()))))),a.tap((t=>{e?.flushSync?h((()=>{y.setState(t).pipe(O)})):y.setState(t).pipe(O)}))),I=e=>a.sync((()=>{const t=y.getState();if(0===e.length)return t;const r=o.map(e,(({query:e,patches:r})=>[e,(0,kt.applyPatches)(r,t.get(e)||(0,Tt.emptyRows)())]));return new Map([...t,...r])})),E=(e,t)=>a.sync((()=>{const r=g.get(e);if(!r)return;const i=(0,Tt.queryResultFromRows)(t);"fulfilled"!==r.promise.status?r.resolve(i):r.promise=Promise.resolve(i),Object.assign(r.promise,{status:"fulfilled",value:i}),r.releaseOnResolve&&g.delete(e)})),A=()=>{[...g.entries()].filter((([e])=>!v.has(e))).forEach((([e,t])=>{"fulfilled"===t.promise.status?g.delete(e):t.releaseOnResolve=!0}))},Q=(()=>{let e=[];return(t,{id:r,...i},n)=>{a.logDebug(["Evolu mutate",{table:t,id:r,values:i}]).pipe(O);const s=null==r;return s&&(r=u.rowId.pipe(O)),e=[...e,[{table:t,id:r,values:i,isInsert:s},n]],1===e.length&&queueMicrotask((()=>{const[t,r]=o.unzip(e);e=[];const i=r.filter(l.isNotUndefined);A(),f.mutate(t,[...v.keys()]).pipe(a.flatMap(z({flushSync:i.length>0})),a.tap((()=>{i.forEach((e=>e()))})),b)})),{id:r}}})(),R={socket:T,subscribeError:m.subscribe,getError:m.getState,createQuery:(e,t)=>(0,d.pipe)(e(Mt).compile(),(e=>{if((0,Et.isSqlMutation)(e.sql))throw new Error("SQL mutation (INSERT, UPDATE, DELETE, etc.) isn't allowed in the Evolu `createQuery` function. Kysely suggests it because there is no read-only Kysely yet, and removing such an API is not possible. For mutations, use Evolu mutation API.");const r=e.parameters;return{sql:e.sql,parameters:r,...t&&{options:t}}}),(e=>(0,Tt.serializeQuery)(e))),loadQuery:(()=>{let e=[];return t=>{a.logDebug(["Evolu loadQuery",{query:(0,Tt.deserializeQuery)(t)}]).pipe(O);let r=g.get(t);if(!r){let i=d.constVoid;const n=new Promise((e=>{i=e}));r={resolve:i,promise:n,releaseOnResolve:!1},g.set(t,r),e=[...e,t],1===e.length&&queueMicrotask((()=>{f.loadQueries(o.dedupe(e)).pipe(a.flatMap(z()),b),e=[]}))}return r.promise}})(),loadQueries:e=>e.map(R.loadQuery),subscribeQuery:e=>t=>{v.set(e,c.increment(v.get(e)??0));const r=y.subscribe(t);return()=>{const t=v.get(e);null!=t&&t>1?v.set(e,c.decrement(t)):v.delete(e),r()}},getQuery:e=>(0,Tt.queryResultFromRows)(y.getState().get(e)||(0,Tt.emptyRows)()),subscribeOwner:N.subscribe,getOwner:N.getState,subscribeSyncState:w.subscribe,getSyncState:w.getState,create:Q,update:Q,createOrUpdate:Q,resetOwner:e=>a.gen((function*(){yield*f.resetOwner(),!1!==e?.reload&&(yield*k.reset)})).pipe(S),restoreOwner:(t,r)=>a.gen((function*(){yield*f.restoreOwner(e,t),!1!==r?.reload&&(yield*k.reset)})).pipe(S),reloadApp:()=>{k.reset.pipe(b)},ensureSchema:e=>{f.ensureSchema(e).pipe(b)},exportDatabase:()=>f.exportDatabase().pipe(S)};return R})),Pt=(e=d.constVoid)=>a.map(vt.NanoIdGenerator,(t=>{const r=[],i=(e,{id:i,...n})=>(null==i&&(i=t.rowId.pipe(a.runSync)),r.push({isInsert:!0,id:i,table:e,values:n}),{id:i});return e({create:i,createOrUpdate:i}),r})),Mt=new Ze({dialect:{createAdapter:()=>new nt,createDriver:()=>new ot,createIntrospector(){throw"Not implemeneted"},createQueryCompiler:()=>new wt}}),Ft=Mt.schema.createIndex.bind(Mt.schema),Vt=e=>e(Ft).map((e=>({name:e.toOperationNode().name.name,sql:e.compile().sql}))),Jt=e=>a.map(gt.Config,(t=>`evolu:${t.name}:${e}`))},687883:(e,t,r)=>{r.r(t),r.d(t,{Id:()=>o,NonEmptyString1000:()=>m,PositiveInt:()=>N,SqliteBoolean:()=>d,SqliteDate:()=>a,String:()=>h,String1000:()=>f,cast:()=>p,database:()=>l,id:()=>s,table:()=>c});var i=r(973043),n=r(54096);const o=i.String.pipe(i.pattern(/^[\w-]{21}$/),i.brand("Id")),s=e=>o.pipe(i.brand(e)),a=i.String.pipe(i.filter((e=>!isNaN(Date.parse(e)))),i.brand("SqliteDate")),d=i.Number.pipe(i.int(),i.filter((e=>0===e||1===e)),i.brand("SqliteBoolean"));function p(e){return"boolean"===typeof e?!0===e?1:0:"number"===typeof e?1===e:e instanceof Date?e.toISOString():new Date(e)}const c=e=>i.Struct(e).pipe(i.extend(u)),u=i.Struct({createdAt:a,updatedAt:a,isDeleted:d}),l=i.Struct,h=i.String.pipe(i.filter((e=>{if(!(0,n.maybeJson)(e))return!0;try{JSON.parse(e)}catch(t){return!0}return!1}),{message:()=>"a string that is not stringified JSON"}),i.brand("String")),f=h.pipe(i.maxLength(1e3),i.brand("String1000")),m=h.pipe(i.minLength(1),i.maxLength(1e3),i.brand("NonEmptyString1000")),N=i.Number.pipe(i.int(),i.positive(),i.brand("PositiveInt"))},922143:(e,t,r)=>{r.r(t),r.d(t,{AppState:()=>o,FlushSync:()=>n,SyncLock:()=>s,SyncLockAlreadySyncingError:()=>a});var i=r(499779);const n=i.GenericTag("FlushSync");class o extends(i.Tag("AppState")()){}class s extends(i.Tag("SyncLock")()){}class a{constructor(){this._tag="SyncLockAlreadySyncingError"}}},54096:(e,t,r)=>{r.r(t),r.d(t,{Sqlite:()=>p,SqliteFactory:()=>c,drawSqliteQueryPlan:()=>b,isJsonObjectOrArray:()=>u,isSqlMutation:()=>v,maybeJson:()=>y,maybeLogSqliteQueryExecutionTime:()=>x,maybeParseJson:()=>h,valuesToSqliteValues:()=>l});var i=r(941757),n=r(499779),o=r(837875),s=r(676966),a=r(350025),d=r(125105);const p=n.GenericTag("Sqlite");class c extends(n.Tag("SqliteFactory")()){}c.Common=a.effect(c,o.map(c,(e=>({createSqlite:o.logTrace("SqliteFactory createSqlite").pipe(o.zipRight(e.createSqlite),o.map((e=>({...e,exec:t=>e.exec(t).pipe(o.tap((e=>{h(e.rows)})),o.tap((e=>["begin","rollback","commit"].includes(t.sql)?o.logDebug(`SQLiteCommon ${t.sql} transaction`):o.logDebug(["SQLiteCommon exec",t,e])))),transaction:t=>r=>"shared"===t?e.transaction(t)(r):o.flatMap(p,(e=>o.acquireUseRelease(e.exec({sql:"begin"}),(()=>r),((t,r)=>s.isFailure(r)?e.exec({sql:"rollback"}):e.exec({sql:"commit"}))))).pipe(e.transaction(t))}))))}))));const u=e=>null!==e&&"object"===typeof e&&!d.isUint8Array(e),l=e=>e.map((e=>u(e)?JSON.stringify(e):e)),h=e=>{f(e)},f=e=>{for(let t=0;t<e.length;++t)e[t]=m(e[t]);return e},m=e=>d.isString(e)?N(e):Array.isArray(e)?f(e):"object"!==typeof e||null===e||d.isUint8Array(e)?e:w(e),N=e=>{if(y(e))try{return m(JSON.parse(e))}catch(t){}return e},y=e=>null!=e.match(/^[[{]/),w=e=>{for(const t in e)e[t]=m(e[t]);return e},g=new RegExp(`\\b(${["alter","create","delete","drop","insert","replace","update"].join("|")})\\b`),v=e=>g.test(e),x=e=>t=>e.options?.logQueryExecutionTime?o.Do.pipe(o.let("start",(()=>performance.now())),o.bind("result",(()=>t)),o.let("elapsed",(({start:e})=>performance.now()-e)),o.tap((({elapsed:t})=>i.log(`QueryExecutionTime: ${t}ms`,e))),o.map((({result:e})=>e))):t,b=e=>e.map((t=>{let r=t.parent,i=0;for(;;){const t=e.find((e=>e.id===r));if(!t)break;r=t.parent,i++}return`${"  ".repeat(i)}${t.detail}`})).join("\n")},790623:(e,t,r)=>{r.r(t),r.d(t,{makeStore:()=>n});var i=r(837875);const n=e=>i.sync((()=>{const t=new Set;let r=e;return{subscribe:e=>(t.add(e),()=>{t.delete(e)}),getState:()=>r,setState:e=>i.sync((()=>{e!==r&&(r=e,t.forEach((e=>e())))}))}}))},941757:(e,t,r)=>{r.r(t),r.d(t,{Console:()=>s,TypeId:()=>o,assert:()=>c,clear:()=>u,consoleWith:()=>p,count:()=>l,countReset:()=>h,debug:()=>f,dir:()=>m,dirxml:()=>N,error:()=>y,group:()=>w,info:()=>g,log:()=>v,setConsole:()=>d,table:()=>x,time:()=>b,timeLog:()=>O,trace:()=>S,warn:()=>W,withConsole:()=>a,withGroup:()=>C,withTime:()=>q});var i=r(636109),n=r(893443);const o=n.TypeId,s=n.consoleTag,a=i.withConsole,d=i.setConsole,p=i.consoleWith,c=i.assert,u=i.clear,l=i.count,h=i.countReset,f=i.debug,m=i.dir,N=i.dirxml,y=i.error,w=i.group,g=i.info,v=i.log,x=i.table,b=i.time,O=i.timeLog,S=i.trace,W=i.warn,C=i.withGroup,q=i.withTime},172695:(e,t,r)=>{r.r(t),r.d(t,{DynamicReferenceBuilder:()=>s,isDynamicReferenceBuilder:()=>a});var i=r(286833),n=r(16149),o=r(464580);class s{#T;get dynamicReference(){return this.#T}get refType(){}constructor(e){this.#T=e}toOperationNode(){return(0,n.parseSimpleReferenceExpression)(this.#T)}}function a(e){return(0,o.isObject)(e)&&(0,i.isOperationNodeSource)(e)&&(0,o.isString)(e.dynamicReference)}},558743:(e,t,r)=>{r.r(t),r.d(t,{createExpressionBuilder:()=>B,expressionBuilder:()=>L});var i=r(623973),n=r(266125),o=r(532234),s=r(691031),a=r(426048),d=r(643366),p=r(16149),c=r(314271),u=r(367071),l=r(685121),h=r(871624),f=r(464580);const m=(0,f.freeze)({is:e=>"UnaryOperationNode"===e.kind,create:(e,t)=>(0,f.freeze)({kind:"UnaryOperationNode",operator:e,operand:t})});function N(e,t){return m.create(h.OperatorNode.create(e),(0,p.parseReferenceExpression)(t))}var y=r(673221),w=r(684664),g=r(20589),v=r(323964),x=r(457004),b=r(861509),O=r(307523);const S=(0,f.freeze)({is:e=>"JSONPathLegNode"===e.kind,create:(e,t)=>(0,f.freeze)({kind:"JSONPathLegNode",type:e,value:t})});var W=r(707742),C=r(766874),q=r(286833),T=r(769539);class k{#e;constructor(e){this.#e=e}at(e){return this.#k("ArrayLocation",e)}key(e){return this.#k("Member",e)}#k(e,t){return C.JSONReferenceNode.is(this.#e)?new z(C.JSONReferenceNode.cloneWithTraversal(this.#e,W.JSONPathNode.is(this.#e.traversal)?W.JSONPathNode.cloneWithLeg(this.#e.traversal,S.create(e,t)):O.JSONOperatorChainNode.cloneWithValue(this.#e.traversal,T.ValueNode.createImmediate(t)))):new z(W.JSONPathNode.cloneWithLeg(this.#e,S.create(e,t)))}}class z extends k{#e;constructor(e){super(e),this.#e=e}get expressionType(){}as(e){return new I(this,e)}$castTo(){return new k(this.#e)}$notNull(){return new k(this.#e)}toOperationNode(){return this.#e}}class I{#z;#I;constructor(e,t){this.#z=e,this.#I=t}get expression(){return this.#z}get alias(){return this.#I}toOperationNode(){return x.AliasNode.create(this.#z.toOperationNode(),(0,q.isOperationNodeSource)(this.#I)?this.#I.toOperationNode():b.IdentifierNode.create(this.#I))}}var E=r(112083),A=r(823819);const Q=(0,f.freeze)({is:e=>"TupleNode"===e.kind,create:e=>(0,f.freeze)({kind:"TupleNode",values:(0,f.freeze)(e)})});var R=r(608489);const D=(0,f.freeze)({is:e=>"CastNode"===e.kind,create:(e,t)=>(0,f.freeze)({kind:"CastNode",expression:e,dataType:t})});function B(e=w.NOOP_QUERY_EXECUTOR){function t(e,t){return new l.ExpressionWrapper(N(e,t))}const r=Object.assign((function(e,t,r){return new l.ExpressionWrapper((0,c.parseValueBinaryOperation)(e,t,r))}),{fn:void 0,eb:void 0,selectFrom:t=>(0,i.createSelectQueryBuilder)({queryId:(0,a.createQueryId)(),executor:e,queryNode:n.SelectQueryNode.createFrom((0,o.parseTableExpressionOrList)(t))}),case:e=>new g.CaseBuilder({node:v.CaseNode.create((0,f.isUndefined)(e)?void 0:(0,p.parseReferenceExpression)(e))}),ref:(e,t)=>(0,f.isUndefined)(t)?new l.ExpressionWrapper((0,p.parseStringReference)(e)):new k((0,p.parseJSONReference)(e,t)),jsonPath:()=>new k(W.JSONPathNode.create()),table:e=>new l.ExpressionWrapper((0,o.parseTable)(e)),val:e=>new l.ExpressionWrapper((0,y.parseValueExpression)(e)),refTuple:(...e)=>new l.ExpressionWrapper(Q.create(e.map(p.parseReferenceExpression))),tuple:(...e)=>new l.ExpressionWrapper(Q.create(e.map(y.parseValueExpression))),lit:e=>new l.ExpressionWrapper((0,y.parseSafeImmediateValue)(e)),unary:t,not:e=>t("not",e),exists:e=>t("exists",e),neg:e=>t("-",e),between:(e,t,r)=>new l.ExpressionWrapper(E.BinaryOperationNode.create((0,p.parseReferenceExpression)(e),h.OperatorNode.create("between"),A.AndNode.create((0,y.parseValueExpression)(t),(0,y.parseValueExpression)(r)))),betweenSymmetric:(e,t,r)=>new l.ExpressionWrapper(E.BinaryOperationNode.create((0,p.parseReferenceExpression)(e),h.OperatorNode.create("between symmetric"),A.AndNode.create((0,y.parseValueExpression)(t),(0,y.parseValueExpression)(r)))),and:e=>(0,f.isReadonlyArray)(e)?new l.ExpressionWrapper((0,c.parseFilterList)(e,"and")):new l.ExpressionWrapper((0,c.parseFilterObject)(e,"and")),or:e=>(0,f.isReadonlyArray)(e)?new l.ExpressionWrapper((0,c.parseFilterList)(e,"or")):new l.ExpressionWrapper((0,c.parseFilterObject)(e,"or")),parens(...e){const t=(0,c.parseValueBinaryOperationOrExpression)(e);return u.ParensNode.is(t)?new l.ExpressionWrapper(t):new l.ExpressionWrapper(u.ParensNode.create(t))},cast:(e,t)=>new l.ExpressionWrapper(D.create((0,p.parseReferenceExpression)(e),(0,R.parseDataTypeExpression)(t))),withSchema:t=>B(e.withPluginAtFront(new s.WithSchemaPlugin(t)))});return r.fn=(0,d.createFunctionModule)(),r.eb=r,r}function L(e){return B()}},685121:(e,t,r)=>{r.r(t),r.d(t,{AliasedExpressionWrapper:()=>u,AndWrapper:()=>h,ExpressionWrapper:()=>c,OrWrapper:()=>l});var i=r(457004),n=r(823819),o=r(861509),s=r(286833),a=r(570135),d=r(367071),p=r(314271);class c{#e;constructor(e){this.#e=e}get expressionType(){}as(e){return new u(this,e)}or(...e){return new l(a.OrNode.create(this.#e,(0,p.parseValueBinaryOperationOrExpression)(e)))}and(...e){return new h(n.AndNode.create(this.#e,(0,p.parseValueBinaryOperationOrExpression)(e)))}$castTo(){return new c(this.#e)}$notNull(){return new c(this.#e)}toOperationNode(){return this.#e}}class u{#E;#I;constructor(e,t){this.#E=e,this.#I=t}get expression(){return this.#E}get alias(){return this.#I}toOperationNode(){return i.AliasNode.create(this.#E.toOperationNode(),(0,s.isOperationNodeSource)(this.#I)?this.#I.toOperationNode():o.IdentifierNode.create(this.#I))}}class l{#e;constructor(e){this.#e=e}get expressionType(){}as(e){return new u(this,e)}or(...e){return new l(a.OrNode.create(this.#e,(0,p.parseValueBinaryOperationOrExpression)(e)))}$castTo(){return new l(this.#e)}toOperationNode(){return d.ParensNode.create(this.#e)}}class h{#e;constructor(e){this.#e=e}get expressionType(){}as(e){return new u(this,e)}and(...e){return new h(n.AndNode.create(this.#e,(0,p.parseValueBinaryOperationOrExpression)(e)))}$castTo(){return new h(this.#e)}toOperationNode(){return d.ParensNode.create(this.#e)}}},457004:(e,t,r)=>{r.r(t),r.d(t,{AliasNode:()=>n});var i=r(464580);const n=(0,i.freeze)({is:e=>"AliasNode"===e.kind,create:(e,t)=>(0,i.freeze)({kind:"AliasNode",node:e,alias:t})})},823819:(e,t,r)=>{r.r(t),r.d(t,{AndNode:()=>n});var i=r(464580);const n=(0,i.freeze)({is:e=>"AndNode"===e.kind,create:(e,t)=>(0,i.freeze)({kind:"AndNode",left:e,right:t})})},112083:(e,t,r)=>{r.r(t),r.d(t,{BinaryOperationNode:()=>n});var i=r(464580);const n=(0,i.freeze)({is:e=>"BinaryOperationNode"===e.kind,create:(e,t,r)=>(0,i.freeze)({kind:"BinaryOperationNode",leftOperand:e,operator:t,rightOperand:r})})},323964:(e,t,r)=>{r.r(t),r.d(t,{CaseNode:()=>o});var i=r(464580),n=r(901872);const o=(0,i.freeze)({is:e=>"CaseNode"===e.kind,create:e=>(0,i.freeze)({kind:"CaseNode",value:e}),cloneWithWhen:(e,t)=>(0,i.freeze)({...e,when:(0,i.freeze)(e.when?[...e.when,t]:[t])}),cloneWithThen:(e,t)=>(0,i.freeze)({...e,when:e.when?(0,i.freeze)([...e.when.slice(0,-1),n.WhenNode.cloneWithResult(e.when[e.when.length-1],t)]):void 0}),cloneWith:(e,t)=>(0,i.freeze)({...e,...t})})},11602:(e,t,r)=>{r.r(t),r.d(t,{ColumnNode:()=>o});var i=r(464580),n=r(861509);const o=(0,i.freeze)({is:e=>"ColumnNode"===e.kind,create:e=>(0,i.freeze)({kind:"ColumnNode",column:n.IdentifierNode.create(e)})})},674875:(e,t,r)=>{r.r(t),r.d(t,{DeleteQueryNode:()=>a});var i=r(464580),n=r(162760),o=r(356578);const s=(0,i.freeze)({is:e=>"UsingNode"===e.kind,create:e=>(0,i.freeze)({kind:"UsingNode",tables:(0,i.freeze)(e)}),cloneWithTables:(e,t)=>(0,i.freeze)({...e,tables:(0,i.freeze)([...e.tables,...t])})}),a=(0,i.freeze)({is:e=>"DeleteQueryNode"===e.kind,create:(e,t)=>(0,i.freeze)({kind:"DeleteQueryNode",from:n.FromNode.create(e),...t&&{with:t}}),cloneWithOrderByItems:(e,t)=>(0,i.freeze)({...e,orderBy:e.orderBy?o.OrderByNode.cloneWithItems(e.orderBy,t):o.OrderByNode.create(t)}),cloneWithoutOrderBy:e=>(0,i.freeze)({...e,orderBy:void 0}),cloneWithLimit:(e,t)=>(0,i.freeze)({...e,limit:t}),cloneWithoutLimit:e=>(0,i.freeze)({...e,limit:void 0}),cloneWithUsing:(e,t)=>(0,i.freeze)({...e,using:void 0!==e.using?s.cloneWithTables(e.using,t):s.create(t)})})},162760:(e,t,r)=>{r.r(t),r.d(t,{FromNode:()=>n});var i=r(464580);const n=(0,i.freeze)({is:e=>"FromNode"===e.kind,create:e=>(0,i.freeze)({kind:"FromNode",froms:(0,i.freeze)(e)}),cloneWithFroms:(e,t)=>(0,i.freeze)({...e,froms:(0,i.freeze)([...e.froms,...t])})})},861509:(e,t,r)=>{r.r(t),r.d(t,{IdentifierNode:()=>n});var i=r(464580);const n=(0,i.freeze)({is:e=>"IdentifierNode"===e.kind,create:e=>(0,i.freeze)({kind:"IdentifierNode",name:e})})},72396:(e,t,r)=>{r.r(t),r.d(t,{InsertQueryNode:()=>n});var i=r(464580);const n=(0,i.freeze)({is:e=>"InsertQueryNode"===e.kind,create:(e,t,r)=>(0,i.freeze)({kind:"InsertQueryNode",into:e,...t&&{with:t},replace:r}),createWithoutInto:()=>(0,i.freeze)({kind:"InsertQueryNode"}),cloneWith:(e,t)=>(0,i.freeze)({...e,...t})})},310519:(e,t,r)=>{r.r(t),r.d(t,{JoinNode:()=>a});var i=r(464580),n=r(823819),o=r(570135);const s=(0,i.freeze)({is:e=>"OnNode"===e.kind,create:e=>(0,i.freeze)({kind:"OnNode",on:e}),cloneWithOperation:(e,t,r)=>(0,i.freeze)({...e,on:"And"===t?n.AndNode.create(e.on,r):o.OrNode.create(e.on,r)})}),a=(0,i.freeze)({is:e=>"JoinNode"===e.kind,create:(e,t)=>(0,i.freeze)({kind:"JoinNode",joinType:e,table:t,on:void 0}),createWithOn:(e,t,r)=>(0,i.freeze)({kind:"JoinNode",joinType:e,table:t,on:s.create(r)}),cloneWithOn:(e,t)=>(0,i.freeze)({...e,on:e.on?s.cloneWithOperation(e.on,"And",t):s.create(t)})})},307523:(e,t,r)=>{r.r(t),r.d(t,{JSONOperatorChainNode:()=>n});var i=r(464580);const n=(0,i.freeze)({is:e=>"JSONOperatorChainNode"===e.kind,create:e=>(0,i.freeze)({kind:"JSONOperatorChainNode",operator:e,values:(0,i.freeze)([])}),cloneWithValue:(e,t)=>(0,i.freeze)({...e,values:(0,i.freeze)([...e.values,t])})})},707742:(e,t,r)=>{r.r(t),r.d(t,{JSONPathNode:()=>n});var i=r(464580);const n=(0,i.freeze)({is:e=>"JSONPathNode"===e.kind,create:e=>(0,i.freeze)({kind:"JSONPathNode",inOperator:e,pathLegs:(0,i.freeze)([])}),cloneWithLeg:(e,t)=>(0,i.freeze)({...e,pathLegs:(0,i.freeze)([...e.pathLegs,t])})})},766874:(e,t,r)=>{r.r(t),r.d(t,{JSONReferenceNode:()=>n});var i=r(464580);const n=(0,i.freeze)({is:e=>"JSONReferenceNode"===e.kind,create:(e,t)=>(0,i.freeze)({kind:"JSONReferenceNode",reference:e,traversal:t}),cloneWithTraversal:(e,t)=>(0,i.freeze)({...e,traversal:t})})},137861:(e,t,r)=>{r.r(t),r.d(t,{LimitNode:()=>n});var i=r(464580);const n=(0,i.freeze)({is:e=>"LimitNode"===e.kind,create:e=>(0,i.freeze)({kind:"LimitNode",limit:e})})},938691:(e,t,r)=>{r.r(t),r.d(t,{MergeQueryNode:()=>o});var i=r(464580),n=r(901872);const o=(0,i.freeze)({is:e=>"MergeQueryNode"===e.kind,create:(e,t)=>(0,i.freeze)({kind:"MergeQueryNode",into:e,...t&&{with:t}}),cloneWithUsing:(e,t)=>(0,i.freeze)({...e,using:t}),cloneWithWhen:(e,t)=>(0,i.freeze)({...e,whens:e.whens?(0,i.freeze)([...e.whens,t]):(0,i.freeze)([t])}),cloneWithThen:(e,t)=>(0,i.freeze)({...e,whens:e.whens?(0,i.freeze)([...e.whens.slice(0,-1),n.WhenNode.cloneWithResult(e.whens[e.whens.length-1],t)]):void 0})})},286833:(e,t,r)=>{r.r(t),r.d(t,{isOperationNodeSource:()=>n});var i=r(464580);function n(e){return(0,i.isObject)(e)&&(0,i.isFunction)(e.toOperationNode)}},146774:(e,t,r)=>{r.r(t),r.d(t,{OperationNodeTransformer:()=>n});var i=r(464580);class n{nodeStack=[];#A=(0,i.freeze)({AliasNode:this.transformAlias.bind(this),ColumnNode:this.transformColumn.bind(this),IdentifierNode:this.transformIdentifier.bind(this),SchemableIdentifierNode:this.transformSchemableIdentifier.bind(this),RawNode:this.transformRaw.bind(this),ReferenceNode:this.transformReference.bind(this),SelectQueryNode:this.transformSelectQuery.bind(this),SelectionNode:this.transformSelection.bind(this),TableNode:this.transformTable.bind(this),FromNode:this.transformFrom.bind(this),SelectAllNode:this.transformSelectAll.bind(this),AndNode:this.transformAnd.bind(this),OrNode:this.transformOr.bind(this),ValueNode:this.transformValue.bind(this),ValueListNode:this.transformValueList.bind(this),PrimitiveValueListNode:this.transformPrimitiveValueList.bind(this),ParensNode:this.transformParens.bind(this),JoinNode:this.transformJoin.bind(this),OperatorNode:this.transformOperator.bind(this),WhereNode:this.transformWhere.bind(this),InsertQueryNode:this.transformInsertQuery.bind(this),DeleteQueryNode:this.transformDeleteQuery.bind(this),ReturningNode:this.transformReturning.bind(this),CreateTableNode:this.transformCreateTable.bind(this),AddColumnNode:this.transformAddColumn.bind(this),ColumnDefinitionNode:this.transformColumnDefinition.bind(this),DropTableNode:this.transformDropTable.bind(this),DataTypeNode:this.transformDataType.bind(this),OrderByNode:this.transformOrderBy.bind(this),OrderByItemNode:this.transformOrderByItem.bind(this),GroupByNode:this.transformGroupBy.bind(this),GroupByItemNode:this.transformGroupByItem.bind(this),UpdateQueryNode:this.transformUpdateQuery.bind(this),ColumnUpdateNode:this.transformColumnUpdate.bind(this),LimitNode:this.transformLimit.bind(this),OffsetNode:this.transformOffset.bind(this),OnConflictNode:this.transformOnConflict.bind(this),OnDuplicateKeyNode:this.transformOnDuplicateKey.bind(this),CreateIndexNode:this.transformCreateIndex.bind(this),DropIndexNode:this.transformDropIndex.bind(this),ListNode:this.transformList.bind(this),PrimaryKeyConstraintNode:this.transformPrimaryKeyConstraint.bind(this),UniqueConstraintNode:this.transformUniqueConstraint.bind(this),ReferencesNode:this.transformReferences.bind(this),CheckConstraintNode:this.transformCheckConstraint.bind(this),WithNode:this.transformWith.bind(this),CommonTableExpressionNode:this.transformCommonTableExpression.bind(this),CommonTableExpressionNameNode:this.transformCommonTableExpressionName.bind(this),HavingNode:this.transformHaving.bind(this),CreateSchemaNode:this.transformCreateSchema.bind(this),DropSchemaNode:this.transformDropSchema.bind(this),AlterTableNode:this.transformAlterTable.bind(this),DropColumnNode:this.transformDropColumn.bind(this),RenameColumnNode:this.transformRenameColumn.bind(this),AlterColumnNode:this.transformAlterColumn.bind(this),ModifyColumnNode:this.transformModifyColumn.bind(this),AddConstraintNode:this.transformAddConstraint.bind(this),DropConstraintNode:this.transformDropConstraint.bind(this),ForeignKeyConstraintNode:this.transformForeignKeyConstraint.bind(this),CreateViewNode:this.transformCreateView.bind(this),DropViewNode:this.transformDropView.bind(this),GeneratedNode:this.transformGenerated.bind(this),DefaultValueNode:this.transformDefaultValue.bind(this),OnNode:this.transformOn.bind(this),ValuesNode:this.transformValues.bind(this),SelectModifierNode:this.transformSelectModifier.bind(this),CreateTypeNode:this.transformCreateType.bind(this),DropTypeNode:this.transformDropType.bind(this),ExplainNode:this.transformExplain.bind(this),DefaultInsertValueNode:this.transformDefaultInsertValue.bind(this),AggregateFunctionNode:this.transformAggregateFunction.bind(this),OverNode:this.transformOver.bind(this),PartitionByNode:this.transformPartitionBy.bind(this),PartitionByItemNode:this.transformPartitionByItem.bind(this),SetOperationNode:this.transformSetOperation.bind(this),BinaryOperationNode:this.transformBinaryOperation.bind(this),UnaryOperationNode:this.transformUnaryOperation.bind(this),UsingNode:this.transformUsing.bind(this),FunctionNode:this.transformFunction.bind(this),CaseNode:this.transformCase.bind(this),WhenNode:this.transformWhen.bind(this),JSONReferenceNode:this.transformJSONReference.bind(this),JSONPathNode:this.transformJSONPath.bind(this),JSONPathLegNode:this.transformJSONPathLeg.bind(this),JSONOperatorChainNode:this.transformJSONOperatorChain.bind(this),TupleNode:this.transformTuple.bind(this),MergeQueryNode:this.transformMergeQuery.bind(this),MatchedNode:this.transformMatched.bind(this),AddIndexNode:this.transformAddIndex.bind(this),CastNode:this.transformCast.bind(this),FetchNode:this.transformFetch.bind(this),TopNode:this.transformTop.bind(this),OutputNode:this.transformOutput.bind(this)});transformNode(e){if(!e)return e;this.nodeStack.push(e);const t=this.transformNodeImpl(e);return this.nodeStack.pop(),(0,i.freeze)(t)}transformNodeImpl(e){return this.#A[e.kind](e)}transformNodeList(e){return e?(0,i.freeze)(e.map((e=>this.transformNode(e)))):e}transformSelectQuery(e){return{kind:"SelectQueryNode",from:this.transformNode(e.from),selections:this.transformNodeList(e.selections),distinctOn:this.transformNodeList(e.distinctOn),joins:this.transformNodeList(e.joins),groupBy:this.transformNode(e.groupBy),orderBy:this.transformNode(e.orderBy),where:this.transformNode(e.where),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),limit:this.transformNode(e.limit),offset:this.transformNode(e.offset),with:this.transformNode(e.with),having:this.transformNode(e.having),explain:this.transformNode(e.explain),setOperations:this.transformNodeList(e.setOperations),fetch:this.transformNode(e.fetch),top:this.transformNode(e.top)}}transformSelection(e){return{kind:"SelectionNode",selection:this.transformNode(e.selection)}}transformColumn(e){return{kind:"ColumnNode",column:this.transformNode(e.column)}}transformAlias(e){return{kind:"AliasNode",node:this.transformNode(e.node),alias:this.transformNode(e.alias)}}transformTable(e){return{kind:"TableNode",table:this.transformNode(e.table)}}transformFrom(e){return{kind:"FromNode",froms:this.transformNodeList(e.froms)}}transformReference(e){return{kind:"ReferenceNode",column:this.transformNode(e.column),table:this.transformNode(e.table)}}transformAnd(e){return{kind:"AndNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformOr(e){return{kind:"OrNode",left:this.transformNode(e.left),right:this.transformNode(e.right)}}transformValueList(e){return{kind:"ValueListNode",values:this.transformNodeList(e.values)}}transformParens(e){return{kind:"ParensNode",node:this.transformNode(e.node)}}transformJoin(e){return{kind:"JoinNode",joinType:e.joinType,table:this.transformNode(e.table),on:this.transformNode(e.on)}}transformRaw(e){return{kind:"RawNode",sqlFragments:(0,i.freeze)([...e.sqlFragments]),parameters:this.transformNodeList(e.parameters)}}transformWhere(e){return{kind:"WhereNode",where:this.transformNode(e.where)}}transformInsertQuery(e){return{kind:"InsertQueryNode",into:this.transformNode(e.into),columns:this.transformNodeList(e.columns),values:this.transformNode(e.values),returning:this.transformNode(e.returning),onConflict:this.transformNode(e.onConflict),onDuplicateKey:this.transformNode(e.onDuplicateKey),with:this.transformNode(e.with),ignore:e.ignore,replace:e.replace,explain:this.transformNode(e.explain),defaultValues:e.defaultValues,top:this.transformNode(e.top),output:this.transformNode(e.output)}}transformValues(e){return{kind:"ValuesNode",values:this.transformNodeList(e.values)}}transformDeleteQuery(e){return{kind:"DeleteQueryNode",from:this.transformNode(e.from),using:this.transformNode(e.using),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),returning:this.transformNode(e.returning),with:this.transformNode(e.with),orderBy:this.transformNode(e.orderBy),limit:this.transformNode(e.limit),explain:this.transformNode(e.explain),top:this.transformNode(e.top),output:this.transformNode(e.output)}}transformReturning(e){return{kind:"ReturningNode",selections:this.transformNodeList(e.selections)}}transformCreateTable(e){return{kind:"CreateTableNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),constraints:this.transformNodeList(e.constraints),temporary:e.temporary,ifNotExists:e.ifNotExists,onCommit:e.onCommit,frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),selectQuery:this.transformNode(e.selectQuery)}}transformColumnDefinition(e){return{kind:"ColumnDefinitionNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),references:this.transformNode(e.references),primaryKey:e.primaryKey,autoIncrement:e.autoIncrement,unique:e.unique,notNull:e.notNull,unsigned:e.unsigned,defaultTo:this.transformNode(e.defaultTo),check:this.transformNode(e.check),generated:this.transformNode(e.generated),frontModifiers:this.transformNodeList(e.frontModifiers),endModifiers:this.transformNodeList(e.endModifiers),nullsNotDistinct:e.nullsNotDistinct,identity:e.identity,ifNotExists:e.ifNotExists}}transformAddColumn(e){return{kind:"AddColumnNode",column:this.transformNode(e.column)}}transformDropTable(e){return{kind:"DropTableNode",table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformOrderBy(e){return{kind:"OrderByNode",items:this.transformNodeList(e.items)}}transformOrderByItem(e){return{kind:"OrderByItemNode",orderBy:this.transformNode(e.orderBy),direction:this.transformNode(e.direction)}}transformGroupBy(e){return{kind:"GroupByNode",items:this.transformNodeList(e.items)}}transformGroupByItem(e){return{kind:"GroupByItemNode",groupBy:this.transformNode(e.groupBy)}}transformUpdateQuery(e){return{kind:"UpdateQueryNode",table:this.transformNode(e.table),from:this.transformNode(e.from),joins:this.transformNodeList(e.joins),where:this.transformNode(e.where),updates:this.transformNodeList(e.updates),returning:this.transformNode(e.returning),with:this.transformNode(e.with),explain:this.transformNode(e.explain),limit:this.transformNode(e.limit),top:this.transformNode(e.top),output:this.transformNode(e.output)}}transformColumnUpdate(e){return{kind:"ColumnUpdateNode",column:this.transformNode(e.column),value:this.transformNode(e.value)}}transformLimit(e){return{kind:"LimitNode",limit:this.transformNode(e.limit)}}transformOffset(e){return{kind:"OffsetNode",offset:this.transformNode(e.offset)}}transformOnConflict(e){return{kind:"OnConflictNode",columns:this.transformNodeList(e.columns),constraint:this.transformNode(e.constraint),indexExpression:this.transformNode(e.indexExpression),indexWhere:this.transformNode(e.indexWhere),updates:this.transformNodeList(e.updates),updateWhere:this.transformNode(e.updateWhere),doNothing:e.doNothing}}transformOnDuplicateKey(e){return{kind:"OnDuplicateKeyNode",updates:this.transformNodeList(e.updates)}}transformCreateIndex(e){return{kind:"CreateIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists,where:this.transformNode(e.where),nullsNotDistinct:e.nullsNotDistinct}}transformList(e){return{kind:"ListNode",items:this.transformNodeList(e.items)}}transformDropIndex(e){return{kind:"DropIndexNode",name:this.transformNode(e.name),table:this.transformNode(e.table),ifExists:e.ifExists,cascade:e.cascade}}transformPrimaryKeyConstraint(e){return{kind:"PrimaryKeyConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name)}}transformUniqueConstraint(e){return{kind:"UniqueConstraintNode",columns:this.transformNodeList(e.columns),name:this.transformNode(e.name),nullsNotDistinct:e.nullsNotDistinct}}transformForeignKeyConstraint(e){return{kind:"ForeignKeyConstraintNode",columns:this.transformNodeList(e.columns),references:this.transformNode(e.references),name:this.transformNode(e.name),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformSetOperation(e){return{kind:"SetOperationNode",operator:e.operator,expression:this.transformNode(e.expression),all:e.all}}transformReferences(e){return{kind:"ReferencesNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns),onDelete:e.onDelete,onUpdate:e.onUpdate}}transformCheckConstraint(e){return{kind:"CheckConstraintNode",expression:this.transformNode(e.expression),name:this.transformNode(e.name)}}transformWith(e){return{kind:"WithNode",expressions:this.transformNodeList(e.expressions),recursive:e.recursive}}transformCommonTableExpression(e){return{kind:"CommonTableExpressionNode",name:this.transformNode(e.name),materialized:e.materialized,expression:this.transformNode(e.expression)}}transformCommonTableExpressionName(e){return{kind:"CommonTableExpressionNameNode",table:this.transformNode(e.table),columns:this.transformNodeList(e.columns)}}transformHaving(e){return{kind:"HavingNode",having:this.transformNode(e.having)}}transformCreateSchema(e){return{kind:"CreateSchemaNode",schema:this.transformNode(e.schema),ifNotExists:e.ifNotExists}}transformDropSchema(e){return{kind:"DropSchemaNode",schema:this.transformNode(e.schema),ifExists:e.ifExists,cascade:e.cascade}}transformAlterTable(e){return{kind:"AlterTableNode",table:this.transformNode(e.table),renameTo:this.transformNode(e.renameTo),setSchema:this.transformNode(e.setSchema),columnAlterations:this.transformNodeList(e.columnAlterations),addConstraint:this.transformNode(e.addConstraint),dropConstraint:this.transformNode(e.dropConstraint),addIndex:this.transformNode(e.addIndex),dropIndex:this.transformNode(e.dropIndex)}}transformDropColumn(e){return{kind:"DropColumnNode",column:this.transformNode(e.column)}}transformRenameColumn(e){return{kind:"RenameColumnNode",column:this.transformNode(e.column),renameTo:this.transformNode(e.renameTo)}}transformAlterColumn(e){return{kind:"AlterColumnNode",column:this.transformNode(e.column),dataType:this.transformNode(e.dataType),dataTypeExpression:this.transformNode(e.dataTypeExpression),setDefault:this.transformNode(e.setDefault),dropDefault:e.dropDefault,setNotNull:e.setNotNull,dropNotNull:e.dropNotNull}}transformModifyColumn(e){return{kind:"ModifyColumnNode",column:this.transformNode(e.column)}}transformAddConstraint(e){return{kind:"AddConstraintNode",constraint:this.transformNode(e.constraint)}}transformDropConstraint(e){return{kind:"DropConstraintNode",constraintName:this.transformNode(e.constraintName),ifExists:e.ifExists,modifier:e.modifier}}transformCreateView(e){return{kind:"CreateViewNode",name:this.transformNode(e.name),temporary:e.temporary,orReplace:e.orReplace,ifNotExists:e.ifNotExists,materialized:e.materialized,columns:this.transformNodeList(e.columns),as:this.transformNode(e.as)}}transformDropView(e){return{kind:"DropViewNode",name:this.transformNode(e.name),ifExists:e.ifExists,materialized:e.materialized,cascade:e.cascade}}transformGenerated(e){return{kind:"GeneratedNode",byDefault:e.byDefault,always:e.always,identity:e.identity,stored:e.stored,expression:this.transformNode(e.expression)}}transformDefaultValue(e){return{kind:"DefaultValueNode",defaultValue:this.transformNode(e.defaultValue)}}transformOn(e){return{kind:"OnNode",on:this.transformNode(e.on)}}transformSelectModifier(e){return{kind:"SelectModifierNode",modifier:e.modifier,rawModifier:this.transformNode(e.rawModifier),of:this.transformNodeList(e.of)}}transformCreateType(e){return{kind:"CreateTypeNode",name:this.transformNode(e.name),enum:this.transformNode(e.enum)}}transformDropType(e){return{kind:"DropTypeNode",name:this.transformNode(e.name),ifExists:e.ifExists}}transformExplain(e){return{kind:"ExplainNode",format:e.format,options:this.transformNode(e.options)}}transformSchemableIdentifier(e){return{kind:"SchemableIdentifierNode",schema:this.transformNode(e.schema),identifier:this.transformNode(e.identifier)}}transformAggregateFunction(e){return{kind:"AggregateFunctionNode",aggregated:this.transformNodeList(e.aggregated),distinct:e.distinct,filter:this.transformNode(e.filter),func:e.func,over:this.transformNode(e.over)}}transformOver(e){return{kind:"OverNode",orderBy:this.transformNode(e.orderBy),partitionBy:this.transformNode(e.partitionBy)}}transformPartitionBy(e){return{kind:"PartitionByNode",items:this.transformNodeList(e.items)}}transformPartitionByItem(e){return{kind:"PartitionByItemNode",partitionBy:this.transformNode(e.partitionBy)}}transformBinaryOperation(e){return{kind:"BinaryOperationNode",leftOperand:this.transformNode(e.leftOperand),operator:this.transformNode(e.operator),rightOperand:this.transformNode(e.rightOperand)}}transformUnaryOperation(e){return{kind:"UnaryOperationNode",operator:this.transformNode(e.operator),operand:this.transformNode(e.operand)}}transformUsing(e){return{kind:"UsingNode",tables:this.transformNodeList(e.tables)}}transformFunction(e){return{kind:"FunctionNode",func:e.func,arguments:this.transformNodeList(e.arguments)}}transformCase(e){return{kind:"CaseNode",value:this.transformNode(e.value),when:this.transformNodeList(e.when),else:this.transformNode(e.else),isStatement:e.isStatement}}transformWhen(e){return{kind:"WhenNode",condition:this.transformNode(e.condition),result:this.transformNode(e.result)}}transformJSONReference(e){return{kind:"JSONReferenceNode",reference:this.transformNode(e.reference),traversal:this.transformNode(e.traversal)}}transformJSONPath(e){return{kind:"JSONPathNode",inOperator:this.transformNode(e.inOperator),pathLegs:this.transformNodeList(e.pathLegs)}}transformJSONPathLeg(e){return{kind:"JSONPathLegNode",type:e.type,value:e.value}}transformJSONOperatorChain(e){return{kind:"JSONOperatorChainNode",operator:this.transformNode(e.operator),values:this.transformNodeList(e.values)}}transformTuple(e){return{kind:"TupleNode",values:this.transformNodeList(e.values)}}transformMergeQuery(e){return{kind:"MergeQueryNode",into:this.transformNode(e.into),using:this.transformNode(e.using),whens:this.transformNodeList(e.whens),with:this.transformNode(e.with),top:this.transformNode(e.top),output:this.transformNode(e.output)}}transformMatched(e){return{kind:"MatchedNode",not:e.not,bySource:e.bySource}}transformAddIndex(e){return{kind:"AddIndexNode",name:this.transformNode(e.name),columns:this.transformNodeList(e.columns),unique:e.unique,using:this.transformNode(e.using),ifNotExists:e.ifNotExists}}transformCast(e){return{kind:"CastNode",expression:this.transformNode(e.expression),dataType:this.transformNode(e.dataType)}}transformFetch(e){return{kind:"FetchNode",rowCount:this.transformNode(e.rowCount),modifier:e.modifier}}transformTop(e){return{kind:"TopNode",expression:e.expression,modifiers:e.modifiers}}transformOutput(e){return{kind:"OutputNode",selections:this.transformNodeList(e.selections)}}transformDataType(e){return e}transformSelectAll(e){return e}transformIdentifier(e){return e}transformValue(e){return e}transformPrimitiveValueList(e){return e}transformOperator(e){return e}transformDefaultInsertValue(e){return e}}},871624:(e,t,r)=>{r.r(t),r.d(t,{ARITHMETIC_OPERATORS:()=>o,BINARY_OPERATORS:()=>a,COMPARISON_OPERATORS:()=>n,JSON_OPERATORS:()=>s,OPERATORS:()=>c,OperatorNode:()=>u,UNARY_FILTER_OPERATORS:()=>d,UNARY_OPERATORS:()=>p,isArithmeticOperator:()=>m,isBinaryOperator:()=>h,isComparisonOperator:()=>f,isJSONOperator:()=>N,isOperator:()=>l});var i=r(464580);const n=["=","==","!=","<>",">",">=","<","<=","in","not in","is","is not","like","not like","match","ilike","not ilike","@>","<@","^@","&&","?","?&","?|","!<","!>","<=>","!~","~","~*","!~*","@@","@@@","!!","<->","regexp","is distinct from","is not distinct from"],o=["+","-","*","/","%","^","&","|","#","<<",">>"],s=["->","->>"],a=[...n,...o,"&&","||"],d=["exists","not exists"],p=["not","-",...d],c=[...a,...s,...p,"between","between symmetric"],u=(0,i.freeze)({is:e=>"OperatorNode"===e.kind,create:e=>(0,i.freeze)({kind:"OperatorNode",operator:e})});function l(e){return(0,i.isString)(e)&&c.includes(e)}function h(e){return(0,i.isString)(e)&&a.includes(e)}function f(e){return(0,i.isString)(e)&&n.includes(e)}function m(e){return(0,i.isString)(e)&&o.includes(e)}function N(e){return(0,i.isString)(e)&&s.includes(e)}},570135:(e,t,r)=>{r.r(t),r.d(t,{OrNode:()=>n});var i=r(464580);const n=(0,i.freeze)({is:e=>"OrNode"===e.kind,create:(e,t)=>(0,i.freeze)({kind:"OrNode",left:e,right:t})})},356578:(e,t,r)=>{r.r(t),r.d(t,{OrderByNode:()=>n});var i=r(464580);const n=(0,i.freeze)({is:e=>"OrderByNode"===e.kind,create:e=>(0,i.freeze)({kind:"OrderByNode",items:(0,i.freeze)([...e])}),cloneWithItems:(e,t)=>(0,i.freeze)({...e,items:(0,i.freeze)([...e.items,...t])})})},367071:(e,t,r)=>{r.r(t),r.d(t,{ParensNode:()=>n});var i=r(464580);const n=(0,i.freeze)({is:e=>"ParensNode"===e.kind,create:e=>(0,i.freeze)({kind:"ParensNode",node:e})})},837408:(e,t,r)=>{r.r(t),r.d(t,{PrimitiveValueListNode:()=>n});var i=r(464580);const n=(0,i.freeze)({is:e=>"PrimitiveValueListNode"===e.kind,create:e=>(0,i.freeze)({kind:"PrimitiveValueListNode",values:(0,i.freeze)([...e])})})},430144:(e,t,r)=>{r.r(t),r.d(t,{QueryNode:()=>h});var i=r(72396),n=r(266125),o=r(381784),s=r(674875),a=r(211533),d=r(464580);const p=(0,d.freeze)({is:e=>"ReturningNode"===e.kind,create:e=>(0,d.freeze)({kind:"ReturningNode",selections:(0,d.freeze)(e)}),cloneWithSelections:(e,t)=>(0,d.freeze)({...e,selections:e.selections?(0,d.freeze)([...e.selections,...t]):(0,d.freeze)(t)})}),c=(0,d.freeze)({is:e=>"ExplainNode"===e.kind,create:(e,t)=>(0,d.freeze)({kind:"ExplainNode",format:e,options:t})});var u=r(938691);const l=(0,d.freeze)({is:e=>"OutputNode"===e.kind,create:e=>(0,d.freeze)({kind:"OutputNode",selections:(0,d.freeze)(e)}),cloneWithSelections:(e,t)=>(0,d.freeze)({...e,selections:e.selections?(0,d.freeze)([...e.selections,...t]):(0,d.freeze)(t)})}),h=(0,d.freeze)({is:e=>n.SelectQueryNode.is(e)||i.InsertQueryNode.is(e)||o.UpdateQueryNode.is(e)||s.DeleteQueryNode.is(e)||u.MergeQueryNode.is(e),cloneWithWhere:(e,t)=>(0,d.freeze)({...e,where:e.where?a.WhereNode.cloneWithOperation(e.where,"And",t):a.WhereNode.create(t)}),cloneWithJoin:(e,t)=>(0,d.freeze)({...e,joins:e.joins?(0,d.freeze)([...e.joins,t]):(0,d.freeze)([t])}),cloneWithReturning:(e,t)=>(0,d.freeze)({...e,returning:e.returning?p.cloneWithSelections(e.returning,t):p.create(t)}),cloneWithoutReturning:e=>(0,d.freeze)({...e,returning:void 0}),cloneWithoutWhere:e=>(0,d.freeze)({...e,where:void 0}),cloneWithExplain:(e,t,r)=>(0,d.freeze)({...e,explain:c.create(t,r?.toOperationNode())}),cloneWithTop:(e,t)=>(0,d.freeze)({...e,top:t}),cloneWithOutput:(e,t)=>(0,d.freeze)({...e,output:e.output?l.cloneWithSelections(e.output,t):l.create(t)})})},249350:(e,t,r)=>{r.r(t),r.d(t,{RawNode:()=>n});var i=r(464580);const n=(0,i.freeze)({is:e=>"RawNode"===e.kind,create:(e,t)=>(0,i.freeze)({kind:"RawNode",sqlFragments:(0,i.freeze)(e),parameters:(0,i.freeze)(t)}),createWithSql:e=>n.create([e],[]),createWithChild:e=>n.create(["",""],[e]),createWithChildren:e=>n.create(new Array(e.length+1).fill(""),e)})},871367:(e,t,r)=>{r.r(t),r.d(t,{ReferenceNode:()=>o});var i=r(56274),n=r(464580);const o=(0,n.freeze)({is:e=>"ReferenceNode"===e.kind,create:(e,t)=>(0,n.freeze)({kind:"ReferenceNode",table:t,column:e}),createSelectAll:e=>(0,n.freeze)({kind:"ReferenceNode",table:e,column:i.SelectAllNode.create()})})},176764:(e,t,r)=>{r.r(t),r.d(t,{SchemableIdentifierNode:()=>o});var i=r(464580),n=r(861509);const o=(0,i.freeze)({is:e=>"SchemableIdentifierNode"===e.kind,create:e=>(0,i.freeze)({kind:"SchemableIdentifierNode",identifier:n.IdentifierNode.create(e)}),createWithSchema:(e,t)=>(0,i.freeze)({kind:"SchemableIdentifierNode",schema:n.IdentifierNode.create(e),identifier:n.IdentifierNode.create(t)})})},56274:(e,t,r)=>{r.r(t),r.d(t,{SelectAllNode:()=>n});var i=r(464580);const n=(0,i.freeze)({is:e=>"SelectAllNode"===e.kind,create:()=>(0,i.freeze)({kind:"SelectAllNode"})})},266125:(e,t,r)=>{r.r(t),r.d(t,{SelectQueryNode:()=>c});var i=r(464580),n=r(162760);const o=(0,i.freeze)({is:e=>"GroupByNode"===e.kind,create:e=>(0,i.freeze)({kind:"GroupByNode",items:(0,i.freeze)(e)}),cloneWithItems:(e,t)=>(0,i.freeze)({...e,items:(0,i.freeze)([...e.items,...t])})});var s=r(823819),a=r(570135);const d=(0,i.freeze)({is:e=>"HavingNode"===e.kind,create:e=>(0,i.freeze)({kind:"HavingNode",having:e}),cloneWithOperation:(e,t,r)=>(0,i.freeze)({...e,having:"And"===t?s.AndNode.create(e.having,r):a.OrNode.create(e.having,r)})});var p=r(356578);const c=(0,i.freeze)({is:e=>"SelectQueryNode"===e.kind,create:e=>(0,i.freeze)({kind:"SelectQueryNode",...e&&{with:e}}),createFrom:(e,t)=>(0,i.freeze)({kind:"SelectQueryNode",from:n.FromNode.create(e),...t&&{with:t}}),cloneWithSelections:(e,t)=>(0,i.freeze)({...e,selections:e.selections?(0,i.freeze)([...e.selections,...t]):(0,i.freeze)(t)}),cloneWithDistinctOn:(e,t)=>(0,i.freeze)({...e,distinctOn:e.distinctOn?(0,i.freeze)([...e.distinctOn,...t]):(0,i.freeze)(t)}),cloneWithFrontModifier:(e,t)=>(0,i.freeze)({...e,frontModifiers:e.frontModifiers?(0,i.freeze)([...e.frontModifiers,t]):(0,i.freeze)([t])}),cloneWithEndModifier:(e,t)=>(0,i.freeze)({...e,endModifiers:e.endModifiers?(0,i.freeze)([...e.endModifiers,t]):(0,i.freeze)([t])}),cloneWithOrderByItems:(e,t)=>(0,i.freeze)({...e,orderBy:e.orderBy?p.OrderByNode.cloneWithItems(e.orderBy,t):p.OrderByNode.create(t)}),cloneWithGroupByItems:(e,t)=>(0,i.freeze)({...e,groupBy:e.groupBy?o.cloneWithItems(e.groupBy,t):o.create(t)}),cloneWithLimit:(e,t)=>(0,i.freeze)({...e,limit:t}),cloneWithOffset:(e,t)=>(0,i.freeze)({...e,offset:t}),cloneWithFetch:(e,t)=>(0,i.freeze)({...e,fetch:t}),cloneWithHaving:(e,t)=>(0,i.freeze)({...e,having:e.having?d.cloneWithOperation(e.having,"And",t):d.create(t)}),cloneWithSetOperations:(e,t)=>(0,i.freeze)({...e,setOperations:e.setOperations?(0,i.freeze)([...e.setOperations,...t]):(0,i.freeze)([...t])}),cloneWithoutSelections:e=>(0,i.freeze)({...e,selections:[]}),cloneWithoutLimit:e=>(0,i.freeze)({...e,limit:void 0}),cloneWithoutOffset:e=>(0,i.freeze)({...e,offset:void 0}),cloneWithoutOrderBy:e=>(0,i.freeze)({...e,orderBy:void 0}),cloneWithoutGroupBy:e=>(0,i.freeze)({...e,groupBy:void 0})})},657444:(e,t,r)=>{r.r(t),r.d(t,{SetOperationNode:()=>n});var i=r(464580);const n=(0,i.freeze)({is:e=>"SetOperationNode"===e.kind,create:(e,t,r)=>(0,i.freeze)({kind:"SetOperationNode",operator:e,expression:t,all:r})})},336724:(e,t,r)=>{r.r(t),r.d(t,{TableNode:()=>o});var i=r(464580),n=r(176764);const o=(0,i.freeze)({is:e=>"TableNode"===e.kind,create:e=>(0,i.freeze)({kind:"TableNode",table:n.SchemableIdentifierNode.create(e)}),createWithSchema:(e,t)=>(0,i.freeze)({kind:"TableNode",table:n.SchemableIdentifierNode.createWithSchema(e,t)})})},381784:(e,t,r)=>{r.r(t),r.d(t,{UpdateQueryNode:()=>o});var i=r(464580),n=r(162760);const o=(0,i.freeze)({is:e=>"UpdateQueryNode"===e.kind,create:(e,t)=>(0,i.freeze)({kind:"UpdateQueryNode",table:e,...t&&{with:t}}),createWithoutTable:()=>(0,i.freeze)({kind:"UpdateQueryNode"}),cloneWithFromItems:(e,t)=>(0,i.freeze)({...e,from:e.from?n.FromNode.cloneWithFroms(e.from,t):n.FromNode.create(t)}),cloneWithUpdates:(e,t)=>(0,i.freeze)({...e,updates:e.updates?(0,i.freeze)([...e.updates,...t]):t}),cloneWithLimit:(e,t)=>(0,i.freeze)({...e,limit:t})})},291788:(e,t,r)=>{r.r(t),r.d(t,{ValueListNode:()=>n});var i=r(464580);const n=(0,i.freeze)({is:e=>"ValueListNode"===e.kind,create:e=>(0,i.freeze)({kind:"ValueListNode",values:(0,i.freeze)(e)})})},769539:(e,t,r)=>{r.r(t),r.d(t,{ValueNode:()=>n});var i=r(464580);const n=(0,i.freeze)({is:e=>"ValueNode"===e.kind,create:e=>(0,i.freeze)({kind:"ValueNode",value:e}),createImmediate:e=>(0,i.freeze)({kind:"ValueNode",value:e,immediate:!0})})},901872:(e,t,r)=>{r.r(t),r.d(t,{WhenNode:()=>n});var i=r(464580);const n=(0,i.freeze)({is:e=>"WhenNode"===e.kind,create:e=>(0,i.freeze)({kind:"WhenNode",condition:e}),cloneWithResult:(e,t)=>(0,i.freeze)({...e,result:t})})},211533:(e,t,r)=>{r.r(t),r.d(t,{WhereNode:()=>s});var i=r(464580),n=r(823819),o=r(570135);const s=(0,i.freeze)({is:e=>"WhereNode"===e.kind,create:e=>(0,i.freeze)({kind:"WhereNode",where:e}),cloneWithOperation:(e,t,r)=>(0,i.freeze)({...e,where:"And"===t?n.AndNode.create(e.where,r):o.OrNode.create(e.where,r)})})},314271:(e,t,r)=>{r.r(t),r.d(t,{parseFilterList:()=>y,parseFilterObject:()=>N,parseReferentialBinaryOperation:()=>m,parseValueBinaryOperation:()=>f,parseValueBinaryOperationOrExpression:()=>h});var i=r(112083),n=r(464580),o=r(286833),s=r(871624),a=r(16149),d=r(673221),p=r(769539),c=r(823819),u=r(367071),l=r(570135);function h(e){if(3===e.length)return f(e[0],e[1],e[2]);if(1===e.length)return(0,d.parseValueExpression)(e[0]);throw new Error(`invalid arguments: ${JSON.stringify(e)}`)}function f(e,t,r){return function(e){return"is"===e||"is not"===e}(t)&&w(r)?i.BinaryOperationNode.create((0,a.parseReferenceExpression)(e),g(t),p.ValueNode.createImmediate(r)):i.BinaryOperationNode.create((0,a.parseReferenceExpression)(e),g(t),(0,d.parseValueExpressionOrList)(r))}function m(e,t,r){return i.BinaryOperationNode.create((0,a.parseReferenceExpression)(e),g(t),(0,a.parseReferenceExpression)(r))}function N(e,t){return y(Object.entries(e).filter((([,e])=>!(0,n.isUndefined)(e))).map((([e,t])=>f(e,w(t)?"is":"=",t))),t)}function y(e,t,r=!0){const n="and"===t?c.AndNode.create:l.OrNode.create;if(0===e.length)return i.BinaryOperationNode.create(p.ValueNode.createImmediate(1),s.OperatorNode.create("="),p.ValueNode.createImmediate("and"===t?1:0));let o=v(e[0]);for(let i=1;i<e.length;++i)o=n(o,v(e[i]));return e.length>1&&r?u.ParensNode.create(o):o}function w(e){return(0,n.isNull)(e)||(0,n.isBoolean)(e)}function g(e){if((0,n.isString)(e)&&s.OPERATORS.includes(e))return s.OperatorNode.create(e);if((0,o.isOperationNodeSource)(e))return e.toOperationNode();throw new Error(`invalid operator ${JSON.stringify(e)}`)}function v(e){return(0,o.isOperationNodeSource)(e)?e.toOperationNode():e}},608489:(e,t,r)=>{r.r(t),r.d(t,{parseDataTypeExpression:()=>d});var i=r(464580);const n=["varchar","char","text","integer","int2","int4","int8","smallint","bigint","boolean","real","double precision","float4","float8","decimal","numeric","binary","bytea","date","datetime","time","timetz","timestamp","timestamptz","serial","bigserial","uuid","json","jsonb","blob","varbinary"],o=[/^varchar\(\d+\)$/,/^char\(\d+\)$/,/^decimal\(\d+, \d+\)$/,/^numeric\(\d+, \d+\)$/,/^binary\(\d+\)$/,/^datetime\(\d+\)$/,/^time\(\d+\)$/,/^timetz\(\d+\)$/,/^timestamp\(\d+\)$/,/^timestamptz\(\d+\)$/,/^varbinary\(\d+\)$/],s=(0,i.freeze)({is:e=>"DataTypeNode"===e.kind,create:e=>(0,i.freeze)({kind:"DataTypeNode",dataType:e})});var a=r(286833);function d(e){if((0,a.isOperationNodeSource)(e))return e.toOperationNode();if(function(e){return!!n.includes(e)||!!o.some((t=>t.test(e)))}(e))return s.create(e);throw new Error(`invalid column data type ${JSON.stringify(e)}`)}},716175:(e,t,r)=>{r.r(t),r.d(t,{isExpressionOrFactory:()=>d,parseAliasedExpression:()=>a,parseExpression:()=>s});var i=r(286833),n=r(464580);var o=r(558743);function s(e){if((0,i.isOperationNodeSource)(e))return e.toOperationNode();if((0,n.isFunction)(e))return e((0,o.expressionBuilder)()).toOperationNode();throw new Error(`invalid expression: ${JSON.stringify(e)}`)}function a(e){if((0,i.isOperationNodeSource)(e))return e.toOperationNode();if((0,n.isFunction)(e))return e((0,o.expressionBuilder)()).toOperationNode();throw new Error(`invalid aliased expression: ${JSON.stringify(e)}`)}function d(e){return function(e){return(0,n.isObject)(e)&&"expressionType"in e&&(0,i.isOperationNodeSource)(e)}(e)||function(e){return(0,n.isObject)(e)&&"expression"in e&&(0,n.isString)(e.alias)&&(0,i.isOperationNodeSource)(e)}(e)||(0,n.isFunction)(e)}},403440:(e,t,r)=>{r.r(t),r.d(t,{parseJoin:()=>a});var i=r(310519),n=r(532234),o=r(314271),s=r(664210);function a(e,t){if(3===t.length)return function(e,t,r,s){return i.JoinNode.createWithOn(e,(0,n.parseTableExpression)(t),(0,o.parseReferentialBinaryOperation)(r,"=",s))}(e,t[0],t[1],t[2]);if(2===t.length)return function(e,t,r){return r((0,s.createJoinBuilder)(e,t)).toOperationNode()}(e,t[0],t[1]);throw new Error("not implemented")}},874217:(e,t,r)=>{r.r(t),r.d(t,{isOrderByDirection:()=>p,parseOrderBy:()=>c,parseOrderByItem:()=>u});var i=r(172695),n=r(464580);const o=(0,n.freeze)({is:e=>"OrderByItemNode"===e.kind,create:(e,t)=>(0,n.freeze)({kind:"OrderByItemNode",orderBy:e,direction:t})});var s=r(249350),a=r(716175),d=r(16149);function p(e){return"asc"===e||"desc"===e}function c(e){if(2===e.length)return[u(e[0],e[1])];if(1===e.length){const[t]=e;return Array.isArray(t)?t.map((e=>u(e))):[u(t)]}throw new Error(`Invalid number of arguments at order by! expected 1-2, received ${e.length}`)}function u(e,t){const r=function(e){if((0,a.isExpressionOrFactory)(e))return(0,a.parseExpression)(e);if((0,i.isDynamicReferenceBuilder)(e))return e.toOperationNode();const[t,r]=e.split(" ");if(r){if(!p(r))throw new Error(`Invalid order by direction: ${r}`);return o.create((0,d.parseStringReference)(t),l(r))}return(0,d.parseStringReference)(e)}(e);if(o.is(r)){if(t)throw new Error("Cannot specify direction twice!");return r}return o.create(r,l(t))}function l(e){if(e)return"asc"===e||"desc"===e?s.RawNode.createWithSql(e):e.toOperationNode()}},664210:(e,t,r)=>{r.r(t),r.d(t,{createJoinBuilder:()=>W,createOverBuilder:()=>C,createQueryCreator:()=>S,createSelectQueryBuilder:()=>O});var i=r(310519),n=r(464580),o=r(356578);const s=(0,n.freeze)({is:e=>"PartitionByNode"===e.kind,create:e=>(0,n.freeze)({kind:"PartitionByNode",items:(0,n.freeze)(e)}),cloneWithItems:(e,t)=>(0,n.freeze)({...e,items:(0,n.freeze)([...e.items,...t])})}),a=(0,n.freeze)({is:e=>"OverNode"===e.kind,create:()=>(0,n.freeze)({kind:"OverNode"}),cloneWithOrderByItems:(e,t)=>(0,n.freeze)({...e,orderBy:e.orderBy?o.OrderByNode.cloneWithItems(e.orderBy,t):o.OrderByNode.create(t)}),cloneWithPartitionByItems:(e,t)=>(0,n.freeze)({...e,partitionBy:e.partitionBy?s.cloneWithItems(e.partitionBy,t):s.create(t)})});var d=r(266125),p=r(249350),c=r(314271),u=r(210922);class l{#i;constructor(e){this.#i=(0,n.freeze)(e)}on(...e){return new l({...this.#i,joinNode:i.JoinNode.cloneWithOn(this.#i.joinNode,(0,c.parseValueBinaryOperationOrExpression)(e))})}onRef(e,t,r){return new l({...this.#i,joinNode:i.JoinNode.cloneWithOn(this.#i.joinNode,(0,c.parseReferentialBinaryOperation)(e,t,r))})}onTrue(){return new l({...this.#i,joinNode:i.JoinNode.cloneWithOn(this.#i.joinNode,p.RawNode.createWithSql("true"))})}$call(e){return e(this)}toOperationNode(){return this.#i.joinNode}}(0,u.preventAwait)(l,"don't await JoinBuilder instances. They are never executed directly and are always just a part of a query.");var h=r(874217);const f=(0,n.freeze)({is:e=>"PartitionByItemNode"===e.kind,create:e=>(0,n.freeze)({kind:"PartitionByItemNode",partitionBy:e})});var m=r(16149);function N(e){return(0,m.parseReferenceExpressionOrList)(e).map(f.create)}class y{#i;constructor(e){this.#i=(0,n.freeze)(e)}orderBy(e,t){return new y({overNode:a.cloneWithOrderByItems(this.#i.overNode,(0,h.parseOrderBy)([e,t]))})}partitionBy(e){return new y({overNode:a.cloneWithPartitionByItems(this.#i.overNode,N(e))})}$call(e){return e(this)}toOperationNode(){return this.#i.overNode}}(0,u.preventAwait)(y,"don't await OverBuilder instances. They are never executed directly and are always just a part of a query.");var w=r(623973),g=r(384391),v=r(684664),x=r(426048),b=r(532234);function O(){return(0,w.createSelectQueryBuilder)({queryId:(0,x.createQueryId)(),executor:v.NOOP_QUERY_EXECUTOR,queryNode:d.SelectQueryNode.createFrom((0,b.parseTableExpressionOrList)([]))})}function S(){return new g.QueryCreator({executor:v.NOOP_QUERY_EXECUTOR})}function W(e,t){return new l({joinNode:i.JoinNode.create(e,(0,b.parseTableExpression)(t))})}function C(){return new y({overNode:a.create()})}},16149:(e,t,r)=>{r.r(t),r.d(t,{parseAliasedStringReference:()=>v,parseColumnName:()=>x,parseJSONReference:()=>w,parseOrderedColumnName:()=>b,parseReferenceExpression:()=>y,parseReferenceExpressionOrList:()=>N,parseSimpleReferenceExpression:()=>m,parseStringReference:()=>g});var i=r(457004),n=r(11602),o=r(871367),s=r(336724),a=r(464580),d=r(716175),p=r(861509),c=r(874217),u=r(871624),l=r(766874),h=r(307523),f=r(707742);function m(e){return(0,a.isString)(e)?g(e):e.toOperationNode()}function N(e){return(0,a.isReadonlyArray)(e)?e.map((e=>y(e))):[y(e)]}function y(e){return(0,d.isExpressionOrFactory)(e)?(0,d.parseExpression)(e):m(e)}function w(e,t){const r=g(e);if((0,u.isJSONOperator)(t))return l.JSONReferenceNode.create(r,h.JSONOperatorChainNode.create(u.OperatorNode.create(t)));const i=t.slice(0,-1);if((0,u.isJSONOperator)(i))return l.JSONReferenceNode.create(r,f.JSONPathNode.create(u.OperatorNode.create(i)));throw new Error(`Invalid JSON operator: ${t}`)}function g(e){if(!e.includes("."))return o.ReferenceNode.create(n.ColumnNode.create(e));const t=e.split(".").map(O);if(3===t.length)return function(e){const[t,r,i]=e;return o.ReferenceNode.create(n.ColumnNode.create(i),s.TableNode.createWithSchema(t,r))}(t);if(2===t.length)return function(e){const[t,r]=e;return o.ReferenceNode.create(n.ColumnNode.create(r),s.TableNode.create(t))}(t);throw new Error(`invalid column reference ${e}`)}function v(e){const t=" as ";if(e.includes(t)){const[r,n]=e.split(t).map(O);return i.AliasNode.create(g(r),p.IdentifierNode.create(n))}return g(e)}function x(e){return n.ColumnNode.create(e)}function b(e){if(e.includes(" ")){const[t,r]=e.split(" ").map(O);if(!(0,c.isOrderByDirection)(r))throw new Error(`invalid order direction "${r}" next to "${t}"`);return(0,c.parseOrderBy)([t,r])[0]}return x(e)}function O(e){return e.trim()}},669746:(e,t,r)=>{r.r(t),r.d(t,{parseSelectAll:()=>f,parseSelectArg:()=>l});var i=r(464580),n=r(871367),o=r(56274);const s=(0,i.freeze)({is:e=>"SelectionNode"===e.kind,create:e=>(0,i.freeze)({kind:"SelectionNode",selection:e}),createSelectAll:()=>(0,i.freeze)({kind:"SelectionNode",selection:o.SelectAllNode.create()}),createSelectAllFromTable:e=>(0,i.freeze)({kind:"SelectionNode",selection:n.ReferenceNode.createSelectAll(e)})});var a=r(16149),d=r(172695),p=r(716175),c=r(532234),u=r(558743);function l(e){return(0,i.isFunction)(e)?l(e((0,u.expressionBuilder)())):(0,i.isReadonlyArray)(e)?e.map((e=>h(e))):[h(e)]}function h(e){return(0,i.isString)(e)?s.create((0,a.parseAliasedStringReference)(e)):(0,d.isDynamicReferenceBuilder)(e)?s.create(e.toOperationNode()):s.create((0,p.parseAliasedExpression)(e))}function f(e){return e?Array.isArray(e)?e.map(m):[m(e)]:[s.createSelectAll()]}function m(e){if((0,i.isString)(e))return s.createSelectAllFromTable((0,c.parseTable)(e));throw new Error(`invalid value selectAll expression: ${JSON.stringify(e)}`)}},532234:(e,t,r)=>{r.r(t),r.d(t,{parseAliasedTable:()=>c,parseTable:()=>u,parseTableExpression:()=>p,parseTableExpressionOrList:()=>d});var i=r(464580),n=r(457004),o=r(336724),s=r(716175),a=r(861509);function d(e){return(0,i.isReadonlyArray)(e)?e.map((e=>p(e))):[p(e)]}function p(e){return(0,i.isString)(e)?c(e):(0,s.parseAliasedExpression)(e)}function c(e){const t=" as ";if(e.includes(t)){const[r,i]=e.split(t).map(l);return n.AliasNode.create(u(r),a.IdentifierNode.create(i))}return u(e)}function u(e){if(e.includes(".")){const[t,r]=e.split(".").map(l);return o.TableNode.createWithSchema(t,r)}return o.TableNode.create(e)}function l(e){return e.trim()}},634799:(e,t,r)=>{r.r(t),r.d(t,{parseTop:()=>o});var i=r(464580);const n=(0,i.freeze)({is:e=>"TopNode"===e.kind,create:(e,t)=>(0,i.freeze)({kind:"TopNode",expression:e,modifiers:t})});function o(e,t){if(!(0,i.isNumber)(e)&&!(0,i.isBigInt)(e))throw new Error(`Invalid top expression: ${e}`);if(!(0,i.isUndefined)(t)&&!function(e){return"percent"===e||"with ties"===e||"percent with ties"===e}(t))throw new Error(`Invalid top modifiers: ${t}`);return n.create(e,t)}},673221:(e,t,r)=>{r.r(t),r.d(t,{isSafeImmediateValue:()=>c,parseSafeImmediateValue:()=>u,parseValueExpression:()=>p,parseValueExpressionOrList:()=>d});var i=r(837408),n=r(291788),o=r(769539),s=r(464580),a=r(716175);function d(e){return(0,s.isReadonlyArray)(e)?function(e){if(e.some(a.isExpressionOrFactory))return n.ValueListNode.create(e.map((e=>p(e))));return i.PrimitiveValueListNode.create(e)}(e):p(e)}function p(e){return(0,a.isExpressionOrFactory)(e)?(0,a.parseExpression)(e):o.ValueNode.create(e)}function c(e){return(0,s.isNumber)(e)||(0,s.isBoolean)(e)||(0,s.isNull)(e)}function u(e){if(!c(e))throw new Error(`unsafe immediate value ${JSON.stringify(e)}`);return o.ValueNode.createImmediate(e)}},691031:(e,t,r)=>{r.r(t),r.d(t,{WithSchemaPlugin:()=>c});var i=r(457004),n=r(861509),o=r(146774),s=r(176764),a=r(336724);const d=(0,r(464580).freeze)({AlterTableNode:!0,CreateIndexNode:!0,CreateSchemaNode:!0,CreateTableNode:!0,CreateTypeNode:!0,CreateViewNode:!0,DeleteQueryNode:!0,DropIndexNode:!0,DropSchemaNode:!0,DropTableNode:!0,DropTypeNode:!0,DropViewNode:!0,InsertQueryNode:!0,RawNode:!0,SelectQueryNode:!0,UpdateQueryNode:!0,MergeQueryNode:!0});class p extends o.OperationNodeTransformer{#Q;#R=new Set;#D=new Set;constructor(e){super(),this.#Q=e}transformNodeImpl(e){if(!this.#B(e))return super.transformNodeImpl(e);const t=this.#L(e);for(const n of t)this.#D.add(n);const r=this.#P(e);for(const n of r)this.#R.add(n);const i=super.transformNodeImpl(e);for(const n of r)this.#R.delete(n);for(const n of t)this.#D.delete(n);return i}transformSchemableIdentifier(e){const t=super.transformSchemableIdentifier(e);return t.schema||!this.#R.has(e.identifier.name)?t:{...t,schema:n.IdentifierNode.create(this.#Q)}}transformReferences(e){const t=super.transformReferences(e);return t.table.table.schema?t:{...t,table:a.TableNode.createWithSchema(this.#Q,t.table.table.identifier.name)}}#B(e){return e.kind in d}#P(e){const t=new Set;if("name"in e&&e.name&&s.SchemableIdentifierNode.is(e.name)&&this.#M(e.name,t),"from"in e&&e.from)for(const r of e.from.froms)this.#F(r,t);if("into"in e&&e.into&&this.#F(e.into,t),"table"in e&&e.table&&this.#F(e.table,t),"joins"in e&&e.joins)for(const r of e.joins)this.#F(r.table,t);return"using"in e&&e.using&&this.#F(e.using,t),t}#L(e){const t=new Set;return"with"in e&&e.with&&this.#V(e.with,t),t}#F(e,t){const r=a.TableNode.is(e)?e:i.AliasNode.is(e)&&a.TableNode.is(e.node)?e.node:null;r&&this.#M(r.table,t)}#M(e,t){const r=e.identifier.name;this.#R.has(r)||this.#D.has(r)||t.add(r)}#V(e,t){for(const r of e.expressions){const e=r.name.table.table.identifier.name;this.#D.has(e)||t.add(e)}}}class c{#n;constructor(e){this.#n=new p(e)}transformQuery(e){return this.#n.transformNode(e.node)}async transformResult(e){return e.result}}},20589:(e,t,r)=>{r.r(t),r.d(t,{CaseBuilder:()=>p,CaseEndBuilder:()=>l,CaseThenBuilder:()=>c,CaseWhenBuilder:()=>u});var i=r(685121),n=r(464580),o=r(323964),s=r(901872),a=r(314271),d=r(673221);class p{#i;constructor(e){this.#i=(0,n.freeze)(e)}when(...e){return new c({...this.#i,node:o.CaseNode.cloneWithWhen(this.#i.node,s.WhenNode.create((0,a.parseValueBinaryOperationOrExpression)(e)))})}}class c{#i;constructor(e){this.#i=(0,n.freeze)(e)}then(e){return new u({...this.#i,node:o.CaseNode.cloneWithThen(this.#i.node,(0,d.isSafeImmediateValue)(e)?(0,d.parseSafeImmediateValue)(e):(0,d.parseValueExpression)(e))})}}class u{#i;constructor(e){this.#i=(0,n.freeze)(e)}when(...e){return new c({...this.#i,node:o.CaseNode.cloneWithWhen(this.#i.node,s.WhenNode.create((0,a.parseValueBinaryOperationOrExpression)(e)))})}else(e){return new l({...this.#i,node:o.CaseNode.cloneWith(this.#i.node,{else:(0,d.isSafeImmediateValue)(e)?(0,d.parseSafeImmediateValue)(e):(0,d.parseValueExpression)(e)})})}end(){return new i.ExpressionWrapper(o.CaseNode.cloneWith(this.#i.node,{isStatement:!1}))}endCase(){return new i.ExpressionWrapper(o.CaseNode.cloneWith(this.#i.node,{isStatement:!0}))}}class l{#i;constructor(e){this.#i=(0,n.freeze)(e)}end(){return new i.ExpressionWrapper(o.CaseNode.cloneWith(this.#i.node,{isStatement:!1}))}endCase(){return new i.ExpressionWrapper(o.CaseNode.cloneWith(this.#i.node,{isStatement:!0}))}}},643366:(e,t,r)=>{r.r(t),r.d(t,{createFunctionModule:()=>w});var i=r(685121),n=r(464580),o=r(211533);const s=(0,n.freeze)({is:e=>"AggregateFunctionNode"===e.kind,create:(e,t=[])=>(0,n.freeze)({kind:"AggregateFunctionNode",func:e,aggregated:t}),cloneWithDistinct:e=>(0,n.freeze)({...e,distinct:!0}),cloneWithFilter:(e,t)=>(0,n.freeze)({...e,filter:e.filter?o.WhereNode.cloneWithOperation(e.filter,"And",t):o.WhereNode.create(t)}),cloneWithOrFilter:(e,t)=>(0,n.freeze)({...e,filter:e.filter?o.WhereNode.cloneWithOperation(e.filter,"Or",t):o.WhereNode.create(t)}),cloneWithOver:(e,t)=>(0,n.freeze)({...e,over:t})}),a=(0,n.freeze)({is:e=>"FunctionNode"===e.kind,create:(e,t)=>(0,n.freeze)({kind:"FunctionNode",func:e,arguments:t})});var d=r(16149),p=r(669746),c=r(457004),u=r(861509),l=r(210922),h=r(664210),f=r(314271);class m{#i;constructor(e){this.#i=(0,n.freeze)(e)}get expressionType(){}as(e){return new N(this,e)}distinct(){return new m({...this.#i,aggregateFunctionNode:s.cloneWithDistinct(this.#i.aggregateFunctionNode)})}filterWhere(...e){return new m({...this.#i,aggregateFunctionNode:s.cloneWithFilter(this.#i.aggregateFunctionNode,(0,f.parseValueBinaryOperationOrExpression)(e))})}filterWhereRef(e,t,r){return new m({...this.#i,aggregateFunctionNode:s.cloneWithFilter(this.#i.aggregateFunctionNode,(0,f.parseReferentialBinaryOperation)(e,t,r))})}over(e){const t=(0,h.createOverBuilder)();return new m({...this.#i,aggregateFunctionNode:s.cloneWithOver(this.#i.aggregateFunctionNode,(e?e(t):t).toOperationNode())})}$call(e){return e(this)}$castTo(){return new m(this.#i)}$notNull(){return new m(this.#i)}toOperationNode(){return this.#i.aggregateFunctionNode}}(0,l.preventAwait)(m,"don't await AggregateFunctionBuilder instances. They are never executed directly and are always just a part of a query.");class N{#J;#I;constructor(e,t){this.#J=e,this.#I=t}get expression(){return this.#J}get alias(){return this.#I}toOperationNode(){return c.AliasNode.create(this.#J.toOperationNode(),u.IdentifierNode.create(this.#I))}}var y=r(532234);function w(){const e=(e,t)=>new i.ExpressionWrapper(a.create(e,(0,d.parseReferenceExpressionOrList)(t??[]))),t=(e,t)=>new m({aggregateFunctionNode:s.create(e,t?(0,d.parseReferenceExpressionOrList)(t):void 0)});return Object.assign(e,{agg:t,avg:e=>t("avg",[e]),coalesce:(...t)=>e("coalesce",t),count:e=>t("count",[e]),countAll:e=>new m({aggregateFunctionNode:s.create("count",(0,p.parseSelectAll)(e))}),max:e=>t("max",[e]),min:e=>t("min",[e]),sum:e=>t("sum",[e]),any:t=>e("any",[t]),jsonAgg:e=>new m({aggregateFunctionNode:s.create("json_agg",[(0,n.isString)(e)?(0,y.parseTable)(e):e.toOperationNode()])}),toJson:e=>new i.ExpressionWrapper(a.create("to_json",[(0,n.isString)(e)?(0,y.parseTable)(e):e.toOperationNode()]))})}},966319:(e,t,r)=>{r.r(t),r.d(t,{NoResultError:()=>i,isNoResultErrorConstructor:()=>n});class i extends Error{node;constructor(e){super("no result"),this.node=e}}function n(e){return Object.prototype.hasOwnProperty.call(e,"prototype")}},623973:(e,t,r)=>{r.r(t),r.d(t,{createSelectQueryBuilder:()=>E});var i=r(457004),n=r(464580);const o=(0,n.freeze)({is:e=>"SelectModifierNode"===e.kind,create:(e,t)=>(0,n.freeze)({kind:"SelectModifierNode",modifier:e,of:t}),createWithExpression:e=>(0,n.freeze)({kind:"SelectModifierNode",rawModifier:e})});var s=r(403440),a=r(532234),d=r(669746),p=r(16149),c=r(266125),u=r(430144),l=r(874217),h=r(210922),f=r(137861);const m=(0,n.freeze)({is:e=>"OffsetNode"===e.kind,create:e=>(0,n.freeze)({kind:"OffsetNode",offset:e})}),N=(0,n.freeze)({is:e=>"GroupByItemNode"===e.kind,create:e=>(0,n.freeze)({kind:"GroupByItemNode",groupBy:e})});var y=r(558743);function w(e){return e=(0,n.isFunction)(e)?e((0,y.expressionBuilder)()):e,(0,p.parseReferenceExpressionOrList)(e).map(N.create)}var g=r(966319),v=r(861509),x=r(657444),b=r(716175);function O(e,t,r){return(0,n.isFunction)(t)&&(t=t((0,y.createExpressionBuilder)())),(0,n.isReadonlyArray)(t)||(t=[t]),t.map((t=>x.SetOperationNode.create(e,(0,b.parseExpression)(t),r)))}var S=r(314271),W=r(685121),C=r(673221),q=r(769539);const T={is:e=>"FetchNode"===e.kind,create:(e,t)=>({kind:"FetchNode",rowCount:q.ValueNode.create(e),modifier:t})};function k(e,t){if(!(0,n.isNumber)(e)&&!(0,n.isBigInt)(e))throw new Error(`Invalid fetch row count: ${e}`);if("only"!==(r=t)&&"with ties"!==r)throw new Error(`Invalid fetch modifier: ${t}`);var r;return T.create(e,t)}var z=r(634799);class I{#i;constructor(e){this.#i=(0,n.freeze)(e)}get expressionType(){}get isSelectQueryBuilder(){return!0}where(...e){return new I({...this.#i,queryNode:u.QueryNode.cloneWithWhere(this.#i.queryNode,(0,S.parseValueBinaryOperationOrExpression)(e))})}whereRef(e,t,r){return new I({...this.#i,queryNode:u.QueryNode.cloneWithWhere(this.#i.queryNode,(0,S.parseReferentialBinaryOperation)(e,t,r))})}having(...e){return new I({...this.#i,queryNode:c.SelectQueryNode.cloneWithHaving(this.#i.queryNode,(0,S.parseValueBinaryOperationOrExpression)(e))})}havingRef(e,t,r){return new I({...this.#i,queryNode:c.SelectQueryNode.cloneWithHaving(this.#i.queryNode,(0,S.parseReferentialBinaryOperation)(e,t,r))})}select(e){return new I({...this.#i,queryNode:c.SelectQueryNode.cloneWithSelections(this.#i.queryNode,(0,d.parseSelectArg)(e))})}distinctOn(e){return new I({...this.#i,queryNode:c.SelectQueryNode.cloneWithDistinctOn(this.#i.queryNode,(0,p.parseReferenceExpressionOrList)(e))})}modifyFront(e){return new I({...this.#i,queryNode:c.SelectQueryNode.cloneWithFrontModifier(this.#i.queryNode,o.createWithExpression(e.toOperationNode()))})}modifyEnd(e){return new I({...this.#i,queryNode:c.SelectQueryNode.cloneWithEndModifier(this.#i.queryNode,o.createWithExpression(e.toOperationNode()))})}distinct(){return new I({...this.#i,queryNode:c.SelectQueryNode.cloneWithFrontModifier(this.#i.queryNode,o.create("Distinct"))})}forUpdate(e){return new I({...this.#i,queryNode:c.SelectQueryNode.cloneWithEndModifier(this.#i.queryNode,o.create("ForUpdate",e?(0,n.asArray)(e).map(a.parseTable):void 0))})}forShare(e){return new I({...this.#i,queryNode:c.SelectQueryNode.cloneWithEndModifier(this.#i.queryNode,o.create("ForShare",e?(0,n.asArray)(e).map(a.parseTable):void 0))})}forKeyShare(e){return new I({...this.#i,queryNode:c.SelectQueryNode.cloneWithEndModifier(this.#i.queryNode,o.create("ForKeyShare",e?(0,n.asArray)(e).map(a.parseTable):void 0))})}forNoKeyUpdate(e){return new I({...this.#i,queryNode:c.SelectQueryNode.cloneWithEndModifier(this.#i.queryNode,o.create("ForNoKeyUpdate",e?(0,n.asArray)(e).map(a.parseTable):void 0))})}skipLocked(){return new I({...this.#i,queryNode:c.SelectQueryNode.cloneWithEndModifier(this.#i.queryNode,o.create("SkipLocked"))})}noWait(){return new I({...this.#i,queryNode:c.SelectQueryNode.cloneWithEndModifier(this.#i.queryNode,o.create("NoWait"))})}selectAll(e){return new I({...this.#i,queryNode:c.SelectQueryNode.cloneWithSelections(this.#i.queryNode,(0,d.parseSelectAll)(e))})}innerJoin(...e){return new I({...this.#i,queryNode:u.QueryNode.cloneWithJoin(this.#i.queryNode,(0,s.parseJoin)("InnerJoin",e))})}leftJoin(...e){return new I({...this.#i,queryNode:u.QueryNode.cloneWithJoin(this.#i.queryNode,(0,s.parseJoin)("LeftJoin",e))})}rightJoin(...e){return new I({...this.#i,queryNode:u.QueryNode.cloneWithJoin(this.#i.queryNode,(0,s.parseJoin)("RightJoin",e))})}fullJoin(...e){return new I({...this.#i,queryNode:u.QueryNode.cloneWithJoin(this.#i.queryNode,(0,s.parseJoin)("FullJoin",e))})}innerJoinLateral(...e){return new I({...this.#i,queryNode:u.QueryNode.cloneWithJoin(this.#i.queryNode,(0,s.parseJoin)("LateralInnerJoin",e))})}leftJoinLateral(...e){return new I({...this.#i,queryNode:u.QueryNode.cloneWithJoin(this.#i.queryNode,(0,s.parseJoin)("LateralLeftJoin",e))})}orderBy(...e){return new I({...this.#i,queryNode:c.SelectQueryNode.cloneWithOrderByItems(this.#i.queryNode,(0,l.parseOrderBy)(e))})}groupBy(e){return new I({...this.#i,queryNode:c.SelectQueryNode.cloneWithGroupByItems(this.#i.queryNode,w(e))})}limit(e){return new I({...this.#i,queryNode:c.SelectQueryNode.cloneWithLimit(this.#i.queryNode,f.LimitNode.create((0,C.parseValueExpression)(e)))})}offset(e){return new I({...this.#i,queryNode:c.SelectQueryNode.cloneWithOffset(this.#i.queryNode,m.create((0,C.parseValueExpression)(e)))})}fetch(e,t="only"){return new I({...this.#i,queryNode:c.SelectQueryNode.cloneWithFetch(this.#i.queryNode,k(e,t))})}top(e,t){return new I({...this.#i,queryNode:u.QueryNode.cloneWithTop(this.#i.queryNode,(0,z.parseTop)(e,t))})}union(e){return new I({...this.#i,queryNode:c.SelectQueryNode.cloneWithSetOperations(this.#i.queryNode,O("union",e,!1))})}unionAll(e){return new I({...this.#i,queryNode:c.SelectQueryNode.cloneWithSetOperations(this.#i.queryNode,O("union",e,!0))})}intersect(e){return new I({...this.#i,queryNode:c.SelectQueryNode.cloneWithSetOperations(this.#i.queryNode,O("intersect",e,!1))})}intersectAll(e){return new I({...this.#i,queryNode:c.SelectQueryNode.cloneWithSetOperations(this.#i.queryNode,O("intersect",e,!0))})}except(e){return new I({...this.#i,queryNode:c.SelectQueryNode.cloneWithSetOperations(this.#i.queryNode,O("except",e,!1))})}exceptAll(e){return new I({...this.#i,queryNode:c.SelectQueryNode.cloneWithSetOperations(this.#i.queryNode,O("except",e,!0))})}as(e){return new A(this,e)}clearSelect(){return new I({...this.#i,queryNode:c.SelectQueryNode.cloneWithoutSelections(this.#i.queryNode)})}clearWhere(){return new I({...this.#i,queryNode:u.QueryNode.cloneWithoutWhere(this.#i.queryNode)})}clearLimit(){return new I({...this.#i,queryNode:c.SelectQueryNode.cloneWithoutLimit(this.#i.queryNode)})}clearOffset(){return new I({...this.#i,queryNode:c.SelectQueryNode.cloneWithoutOffset(this.#i.queryNode)})}clearOrderBy(){return new I({...this.#i,queryNode:c.SelectQueryNode.cloneWithoutOrderBy(this.#i.queryNode)})}clearGroupBy(){return new I({...this.#i,queryNode:c.SelectQueryNode.cloneWithoutGroupBy(this.#i.queryNode)})}$call(e){return e(this)}$if(e,t){return e?t(this):new I({...this.#i})}$castTo(){return new I(this.#i)}$narrowType(){return new I(this.#i)}$assertType(){return new I(this.#i)}$asTuple(){return new W.ExpressionWrapper(this.toOperationNode())}withPlugin(e){return new I({...this.#i,executor:this.#i.executor.withPlugin(e)})}toOperationNode(){return this.#i.executor.transformQuery(this.#i.queryNode,this.#i.queryId)}compile(){return this.#i.executor.compileQuery(this.toOperationNode(),this.#i.queryId)}async execute(){const e=this.compile();return(await this.#i.executor.executeQuery(e,this.#i.queryId)).rows}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=g.NoResultError){const t=await this.executeTakeFirst();if(void 0===t){throw(0,g.isNoResultErrorConstructor)(e)?new e(this.toOperationNode()):e(this.toOperationNode())}return t}async*stream(e=100){const t=this.compile(),r=this.#i.executor.stream(t,e,this.#i.queryId);for await(const i of r)yield*i.rows}async explain(e,t){const r=new I({...this.#i,queryNode:u.QueryNode.cloneWithExplain(this.#i.queryNode,e,t)});return await r.execute()}}function E(e){return new I(e)}(0,h.preventAwait)(I,"don't await SelectQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");class A{#U;#I;constructor(e,t){this.#U=e,this.#I=t}get expression(){return this.#U}get alias(){return this.#I}get isAliasedSelectQueryBuilder(){return!0}toOperationNode(){return i.AliasNode.create(this.#U.toOperationNode(),v.IdentifierNode.create(this.#I))}}(0,h.preventAwait)(A,"don't await AliasedSelectQueryBuilder instances directly. AliasedSelectQueryBuilder should never be executed directly since it's always a part of another query.")},384391:(e,t,r)=>{r.r(t),r.d(t,{QueryCreator:()=>fe});var i=r(623973),n=r(669746),o=r(11602),s=r(837408),a=r(291788),d=r(464580),p=r(673221);const c=(0,d.freeze)({is:e=>"ValuesNode"===e.kind,create:e=>(0,d.freeze)({kind:"ValuesNode",values:(0,d.freeze)(e)})});var u=r(716175);const l=(0,d.freeze)({is:e=>"DefaultInsertValueNode"===e.kind,create:()=>(0,d.freeze)({kind:"DefaultInsertValueNode"})});var h=r(558743);function f(e){const t=(0,d.isFunction)(e)?e((0,h.expressionBuilder)()):e;return function(e){const t=function(e){const t=new Map;for(const r of e){const e=Object.keys(r);for(const i of e)t.has(i)||void 0===r[i]||t.set(i,t.size)}return t}(e);return[(0,d.freeze)([...t.keys()].map(o.ColumnNode.create)),c.create(e.map((e=>function(e,t){const r=Object.keys(e),i=Array.from({length:t.size});let n=!1;for(const s of r){const r=t.get(s);if((0,d.isUndefined)(r))continue;const o=e[s];((0,d.isUndefined)(o)||(0,u.isExpressionOrFactory)(o))&&(n=!0),i[r]=o}const o=r.length<t.size;if(o||n){const e=l.create();return a.ValueListNode.create(i.map((t=>(0,d.isUndefined)(t)?e:(0,p.parseValueExpression)(t))))}return s.PrimitiveValueListNode.create(i)}(e,t))))]}((0,d.isReadonlyArray)(t)?t:(0,d.freeze)([t]))}var m=r(72396),N=r(430144);const y=(0,d.freeze)({is:e=>"ColumnUpdateNode"===e.kind,create:(e,t)=>(0,d.freeze)({kind:"ColumnUpdateNode",column:e,value:t})});var w=r(16149);function g(...e){return 2===e.length?[y.create((0,w.parseReferenceExpression)(e[0]),(0,p.parseValueExpression)(e[1]))]:v(e[0])}function v(e){const t=(0,d.isFunction)(e)?e((0,h.expressionBuilder)()):e;return Object.entries(t).filter((([e,t])=>void 0!==t)).map((([e,t])=>y.create(o.ColumnNode.create(e),(0,p.parseValueExpression)(t))))}var x=r(210922);const b=(0,d.freeze)({is:e=>"OnDuplicateKeyNode"===e.kind,create:e=>(0,d.freeze)({kind:"OnDuplicateKeyNode",updates:e})});class O{insertId;numInsertedOrUpdatedRows;constructor(e,t){this.insertId=e,this.numInsertedOrUpdatedRows=t}}var S=r(966319),W=r(861509),C=r(211533);const q=(0,d.freeze)({is:e=>"OnConflictNode"===e.kind,create:()=>(0,d.freeze)({kind:"OnConflictNode"}),cloneWith:(e,t)=>(0,d.freeze)({...e,...t}),cloneWithIndexWhere:(e,t)=>(0,d.freeze)({...e,indexWhere:e.indexWhere?C.WhereNode.cloneWithOperation(e.indexWhere,"And",t):C.WhereNode.create(t)}),cloneWithIndexOrWhere:(e,t)=>(0,d.freeze)({...e,indexWhere:e.indexWhere?C.WhereNode.cloneWithOperation(e.indexWhere,"Or",t):C.WhereNode.create(t)}),cloneWithUpdateWhere:(e,t)=>(0,d.freeze)({...e,updateWhere:e.updateWhere?C.WhereNode.cloneWithOperation(e.updateWhere,"And",t):C.WhereNode.create(t)}),cloneWithUpdateOrWhere:(e,t)=>(0,d.freeze)({...e,updateWhere:e.updateWhere?C.WhereNode.cloneWithOperation(e.updateWhere,"Or",t):C.WhereNode.create(t)}),cloneWithoutIndexWhere:e=>(0,d.freeze)({...e,indexWhere:void 0}),cloneWithoutUpdateWhere:e=>(0,d.freeze)({...e,updateWhere:void 0})});var T=r(314271);class k{#i;constructor(e){this.#i=(0,d.freeze)(e)}column(e){const t=o.ColumnNode.create(e);return new k({...this.#i,onConflictNode:q.cloneWith(this.#i.onConflictNode,{columns:this.#i.onConflictNode.columns?(0,d.freeze)([...this.#i.onConflictNode.columns,t]):(0,d.freeze)([t])})})}columns(e){const t=e.map(o.ColumnNode.create);return new k({...this.#i,onConflictNode:q.cloneWith(this.#i.onConflictNode,{columns:this.#i.onConflictNode.columns?(0,d.freeze)([...this.#i.onConflictNode.columns,...t]):(0,d.freeze)(t)})})}constraint(e){return new k({...this.#i,onConflictNode:q.cloneWith(this.#i.onConflictNode,{constraint:W.IdentifierNode.create(e)})})}expression(e){return new k({...this.#i,onConflictNode:q.cloneWith(this.#i.onConflictNode,{indexExpression:e.toOperationNode()})})}where(...e){return new k({...this.#i,onConflictNode:q.cloneWithIndexWhere(this.#i.onConflictNode,(0,T.parseValueBinaryOperationOrExpression)(e))})}whereRef(e,t,r){return new k({...this.#i,onConflictNode:q.cloneWithIndexWhere(this.#i.onConflictNode,(0,T.parseReferentialBinaryOperation)(e,t,r))})}clearWhere(){return new k({...this.#i,onConflictNode:q.cloneWithoutIndexWhere(this.#i.onConflictNode)})}doNothing(){return new z({...this.#i,onConflictNode:q.cloneWith(this.#i.onConflictNode,{doNothing:!0})})}doUpdateSet(e){return new I({...this.#i,onConflictNode:q.cloneWith(this.#i.onConflictNode,{updates:v(e)})})}$call(e){return e(this)}}(0,x.preventAwait)(k,"don't await OnConflictBuilder instances.");class z{#i;constructor(e){this.#i=(0,d.freeze)(e)}toOperationNode(){return this.#i.onConflictNode}}(0,x.preventAwait)(z,"don't await OnConflictDoNothingBuilder instances.");class I{#i;constructor(e){this.#i=(0,d.freeze)(e)}where(...e){return new I({...this.#i,onConflictNode:q.cloneWithUpdateWhere(this.#i.onConflictNode,(0,T.parseValueBinaryOperationOrExpression)(e))})}whereRef(e,t,r){return new I({...this.#i,onConflictNode:q.cloneWithUpdateWhere(this.#i.onConflictNode,(0,T.parseReferentialBinaryOperation)(e,t,r))})}clearWhere(){return new I({...this.#i,onConflictNode:q.cloneWithoutUpdateWhere(this.#i.onConflictNode)})}$call(e){return e(this)}toOperationNode(){return this.#i.onConflictNode}}(0,x.preventAwait)(I,"don't await OnConflictUpdateBuilder instances.");var E=r(634799);class A{#i;constructor(e){this.#i=(0,d.freeze)(e)}values(e){const[t,r]=f(e);return new A({...this.#i,queryNode:m.InsertQueryNode.cloneWith(this.#i.queryNode,{columns:t,values:r})})}columns(e){return new A({...this.#i,queryNode:m.InsertQueryNode.cloneWith(this.#i.queryNode,{columns:(0,d.freeze)(e.map(o.ColumnNode.create))})})}expression(e){return new A({...this.#i,queryNode:m.InsertQueryNode.cloneWith(this.#i.queryNode,{values:(0,u.parseExpression)(e)})})}defaultValues(){return new A({...this.#i,queryNode:m.InsertQueryNode.cloneWith(this.#i.queryNode,{defaultValues:!0})})}ignore(){return new A({...this.#i,queryNode:m.InsertQueryNode.cloneWith(this.#i.queryNode,{ignore:!0})})}top(e,t){return new A({...this.#i,queryNode:N.QueryNode.cloneWithTop(this.#i.queryNode,(0,E.parseTop)(e,t))})}onConflict(e){return new A({...this.#i,queryNode:m.InsertQueryNode.cloneWith(this.#i.queryNode,{onConflict:e(new k({onConflictNode:q.create()})).toOperationNode()})})}onDuplicateKeyUpdate(e){return new A({...this.#i,queryNode:m.InsertQueryNode.cloneWith(this.#i.queryNode,{onDuplicateKey:b.create(v(e))})})}returning(e){return new A({...this.#i,queryNode:N.QueryNode.cloneWithReturning(this.#i.queryNode,(0,n.parseSelectArg)(e))})}returningAll(){return new A({...this.#i,queryNode:N.QueryNode.cloneWithReturning(this.#i.queryNode,(0,n.parseSelectAll)())})}output(e){return new A({...this.#i,queryNode:N.QueryNode.cloneWithOutput(this.#i.queryNode,(0,n.parseSelectArg)(e))})}outputAll(e){return new A({...this.#i,queryNode:N.QueryNode.cloneWithOutput(this.#i.queryNode,(0,n.parseSelectAll)(e))})}clearReturning(){return new A({...this.#i,queryNode:N.QueryNode.cloneWithoutReturning(this.#i.queryNode)})}$call(e){return e(this)}$if(e,t){return e?t(this):new A({...this.#i})}$castTo(){return new A(this.#i)}$narrowType(){return new A(this.#i)}$assertType(){return new A(this.#i)}withPlugin(e){return new A({...this.#i,executor:this.#i.executor.withPlugin(e)})}toOperationNode(){return this.#i.executor.transformQuery(this.#i.queryNode,this.#i.queryId)}compile(){return this.#i.executor.compileQuery(this.toOperationNode(),this.#i.queryId)}async execute(){const e=this.compile(),t=await this.#i.executor.executeQuery(e,this.#i.queryId),{adapter:r}=this.#i.executor,i=e.query;return i.returning&&r.supportsReturning||i.output&&r.supportsOutput?t.rows:[new O(t.insertId,t.numAffectedRows??t.numUpdatedOrDeletedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=S.NoResultError){const t=await this.executeTakeFirst();if(void 0===t){throw(0,S.isNoResultErrorConstructor)(e)?new e(this.toOperationNode()):e(this.toOperationNode())}return t}async*stream(e=100){const t=this.compile(),r=this.#i.executor.stream(t,e,this.#i.queryId);for await(const i of r)yield*i.rows}async explain(e,t){const r=new A({...this.#i,queryNode:N.QueryNode.cloneWithExplain(this.#i.queryNode,e,t)});return await r.execute()}}(0,x.preventAwait)(A,"don't await InsertQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");var Q=r(403440),R=r(532234);class D{numDeletedRows;constructor(e){this.numDeletedRows=e}}var B=r(674875),L=r(137861),P=r(874217);class M{#i;constructor(e){this.#i=(0,d.freeze)(e)}where(...e){return new M({...this.#i,queryNode:N.QueryNode.cloneWithWhere(this.#i.queryNode,(0,T.parseValueBinaryOperationOrExpression)(e))})}whereRef(e,t,r){return new M({...this.#i,queryNode:N.QueryNode.cloneWithWhere(this.#i.queryNode,(0,T.parseReferentialBinaryOperation)(e,t,r))})}clearWhere(){return new M({...this.#i,queryNode:N.QueryNode.cloneWithoutWhere(this.#i.queryNode)})}top(e,t){return new M({...this.#i,queryNode:N.QueryNode.cloneWithTop(this.#i.queryNode,(0,E.parseTop)(e,t))})}using(e){return new M({...this.#i,queryNode:B.DeleteQueryNode.cloneWithUsing(this.#i.queryNode,(0,R.parseTableExpressionOrList)(e))})}innerJoin(...e){return new M({...this.#i,queryNode:N.QueryNode.cloneWithJoin(this.#i.queryNode,(0,Q.parseJoin)("InnerJoin",e))})}leftJoin(...e){return new M({...this.#i,queryNode:N.QueryNode.cloneWithJoin(this.#i.queryNode,(0,Q.parseJoin)("LeftJoin",e))})}rightJoin(...e){return new M({...this.#i,queryNode:N.QueryNode.cloneWithJoin(this.#i.queryNode,(0,Q.parseJoin)("RightJoin",e))})}fullJoin(...e){return new M({...this.#i,queryNode:N.QueryNode.cloneWithJoin(this.#i.queryNode,(0,Q.parseJoin)("FullJoin",e))})}returning(e){return new M({...this.#i,queryNode:N.QueryNode.cloneWithReturning(this.#i.queryNode,(0,n.parseSelectArg)(e))})}returningAll(e){return new M({...this.#i,queryNode:N.QueryNode.cloneWithReturning(this.#i.queryNode,(0,n.parseSelectAll)(e))})}output(e){return new M({...this.#i,queryNode:N.QueryNode.cloneWithOutput(this.#i.queryNode,(0,n.parseSelectArg)(e))})}outputAll(e){return new M({...this.#i,queryNode:N.QueryNode.cloneWithOutput(this.#i.queryNode,(0,n.parseSelectAll)(e))})}clearReturning(){return new M({...this.#i,queryNode:N.QueryNode.cloneWithoutReturning(this.#i.queryNode)})}clearLimit(){return new M({...this.#i,queryNode:B.DeleteQueryNode.cloneWithoutLimit(this.#i.queryNode)})}clearOrderBy(){return new M({...this.#i,queryNode:B.DeleteQueryNode.cloneWithoutOrderBy(this.#i.queryNode)})}orderBy(e,t){return new M({...this.#i,queryNode:B.DeleteQueryNode.cloneWithOrderByItems(this.#i.queryNode,(0,P.parseOrderBy)([e,t]))})}limit(e){return new M({...this.#i,queryNode:B.DeleteQueryNode.cloneWithLimit(this.#i.queryNode,L.LimitNode.create((0,p.parseValueExpression)(e)))})}$call(e){return e(this)}$if(e,t){return e?t(this):new M({...this.#i})}$castTo(){return new M(this.#i)}$narrowType(){return new M(this.#i)}$assertType(){return new M(this.#i)}withPlugin(e){return new M({...this.#i,executor:this.#i.executor.withPlugin(e)})}toOperationNode(){return this.#i.executor.transformQuery(this.#i.queryNode,this.#i.queryId)}compile(){return this.#i.executor.compileQuery(this.toOperationNode(),this.#i.queryId)}async execute(){const e=this.compile(),t=await this.#i.executor.executeQuery(e,this.#i.queryId),{adapter:r}=this.#i.executor,i=e.query;return i.returning&&r.supportsReturning||i.output&&r.supportsOutput?t.rows:[new D(t.numAffectedRows??t.numUpdatedOrDeletedRows??BigInt(0))]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=S.NoResultError){const t=await this.executeTakeFirst();if(void 0===t){throw(0,S.isNoResultErrorConstructor)(e)?new e(this.toOperationNode()):e(this.toOperationNode())}return t}async*stream(e=100){const t=this.compile(),r=this.#i.executor.stream(t,e,this.#i.queryId);for await(const i of r)yield*i.rows}async explain(e,t){const r=new M({...this.#i,queryNode:N.QueryNode.cloneWithExplain(this.#i.queryNode,e,t)});return await r.execute()}}(0,x.preventAwait)(M,"don't await DeleteQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");var F=r(381784);class V{numUpdatedRows;numChangedRows;constructor(e,t){this.numUpdatedRows=e,this.numChangedRows=t}}class J{#i;constructor(e){this.#i=(0,d.freeze)(e)}where(...e){return new J({...this.#i,queryNode:N.QueryNode.cloneWithWhere(this.#i.queryNode,(0,T.parseValueBinaryOperationOrExpression)(e))})}whereRef(e,t,r){return new J({...this.#i,queryNode:N.QueryNode.cloneWithWhere(this.#i.queryNode,(0,T.parseReferentialBinaryOperation)(e,t,r))})}clearWhere(){return new J({...this.#i,queryNode:N.QueryNode.cloneWithoutWhere(this.#i.queryNode)})}top(e,t){return new J({...this.#i,queryNode:N.QueryNode.cloneWithTop(this.#i.queryNode,(0,E.parseTop)(e,t))})}from(e){return new J({...this.#i,queryNode:F.UpdateQueryNode.cloneWithFromItems(this.#i.queryNode,(0,R.parseTableExpressionOrList)(e))})}innerJoin(...e){return new J({...this.#i,queryNode:N.QueryNode.cloneWithJoin(this.#i.queryNode,(0,Q.parseJoin)("InnerJoin",e))})}leftJoin(...e){return new J({...this.#i,queryNode:N.QueryNode.cloneWithJoin(this.#i.queryNode,(0,Q.parseJoin)("LeftJoin",e))})}rightJoin(...e){return new J({...this.#i,queryNode:N.QueryNode.cloneWithJoin(this.#i.queryNode,(0,Q.parseJoin)("RightJoin",e))})}fullJoin(...e){return new J({...this.#i,queryNode:N.QueryNode.cloneWithJoin(this.#i.queryNode,(0,Q.parseJoin)("FullJoin",e))})}limit(e){return new J({...this.#i,queryNode:F.UpdateQueryNode.cloneWithLimit(this.#i.queryNode,L.LimitNode.create((0,p.parseValueExpression)(e)))})}set(...e){return new J({...this.#i,queryNode:F.UpdateQueryNode.cloneWithUpdates(this.#i.queryNode,g(...e))})}returning(e){return new J({...this.#i,queryNode:N.QueryNode.cloneWithReturning(this.#i.queryNode,(0,n.parseSelectArg)(e))})}returningAll(e){return new J({...this.#i,queryNode:N.QueryNode.cloneWithReturning(this.#i.queryNode,(0,n.parseSelectAll)(e))})}output(e){return new J({...this.#i,queryNode:N.QueryNode.cloneWithOutput(this.#i.queryNode,(0,n.parseSelectArg)(e))})}outputAll(e){return new J({...this.#i,queryNode:N.QueryNode.cloneWithOutput(this.#i.queryNode,(0,n.parseSelectAll)(e))})}clearReturning(){return new J({...this.#i,queryNode:N.QueryNode.cloneWithoutReturning(this.#i.queryNode)})}$call(e){return e(this)}$if(e,t){return e?t(this):new J({...this.#i})}$castTo(){return new J(this.#i)}$narrowType(){return new J(this.#i)}$assertType(){return new J(this.#i)}withPlugin(e){return new J({...this.#i,executor:this.#i.executor.withPlugin(e)})}toOperationNode(){return this.#i.executor.transformQuery(this.#i.queryNode,this.#i.queryId)}compile(){return this.#i.executor.compileQuery(this.toOperationNode(),this.#i.queryId)}async execute(){const e=this.compile(),t=await this.#i.executor.executeQuery(e,this.#i.queryId),{adapter:r}=this.#i.executor,i=e.query;return i.returning&&r.supportsReturning||i.output&&r.supportsOutput?t.rows:[new V(t.numAffectedRows??t.numUpdatedOrDeletedRows??BigInt(0),t.numChangedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=S.NoResultError){const t=await this.executeTakeFirst();if(void 0===t){throw(0,S.isNoResultErrorConstructor)(e)?new e(this.toOperationNode()):e(this.toOperationNode())}return t}async*stream(e=100){const t=this.compile(),r=this.#i.executor.stream(t,e,this.#i.queryId);for await(const i of r)yield*i.rows}async explain(e,t){const r=new J({...this.#i,queryNode:N.QueryNode.cloneWithExplain(this.#i.queryNode,e,t)});return await r.execute()}}(0,x.preventAwait)(J,"don't await UpdateQueryBuilder instances directly. To execute the query you need to call `execute` or `executeTakeFirst`.");var U=r(266125),$=r(336724);const j=(0,d.freeze)({is:e=>"CommonTableExpressionNameNode"===e.kind,create:(e,t)=>(0,d.freeze)({kind:"CommonTableExpressionNameNode",table:$.TableNode.create(e),columns:t?(0,d.freeze)(t.map(o.ColumnNode.create)):void 0})});var K=r(664210);const G=(0,d.freeze)({is:e=>"CommonTableExpressionNode"===e.kind,create:(e,t)=>(0,d.freeze)({kind:"CommonTableExpressionNode",name:e,expression:t}),cloneWith:(e,t)=>(0,d.freeze)({...e,...t})});class _{#i;constructor(e){this.#i=(0,d.freeze)(e)}materialized(){return new _({...this.#i,node:G.cloneWith(this.#i.node,{materialized:!0})})}notMaterialized(){return new _({...this.#i,node:G.cloneWith(this.#i.node,{materialized:!1})})}toOperationNode(){return this.#i.node}}function H(e,t){const r=t((0,K.createQueryCreator)()).toOperationNode();return(0,d.isFunction)(e)?e(function(e){return t=>new _({node:G.create(Y(t),e)})}(r)).toOperationNode():G.create(Y(e),r)}function Y(e){if(e.includes("(")){const t=e.split(/[\(\)]/),r=t[0],i=t[1].split(",").map((e=>e.trim()));return j.create(r,i)}return j.create(e)}(0,x.preventAwait)(_,"don't await CTEBuilder instances. They are never executed directly and are always just a part of a query.");const X=(0,d.freeze)({is:e=>"WithNode"===e.kind,create:(e,t)=>(0,d.freeze)({kind:"WithNode",expressions:(0,d.freeze)([e]),...t}),cloneWithExpression:(e,t)=>(0,d.freeze)({...e,expressions:(0,d.freeze)([...e.expressions,t])})});var Z=r(426048),ee=r(691031),te=r(938691);const re=(0,d.freeze)({is:e=>"MatchedNode"===e.kind,create:(e,t=!1)=>(0,d.freeze)({kind:"MatchedNode",not:e,bySource:t})});var ie=r(286833),ne=r(249350),oe=r(901872);function se(e,t,r){return oe.WhenNode.create((0,T.parseFilterList)([re.create(!e.isMatched,e.bySource),...t&&t.length>0?[3===t.length&&r?(0,T.parseReferentialBinaryOperation)(t[0],t[1],t[2]):(0,T.parseValueBinaryOperationOrExpression)(t)]:[]],"and",!1))}function ae(e){return(0,d.isString)(e)?ne.RawNode.create([e],[]):(0,ie.isOperationNodeSource)(e)?e.toOperationNode():e}var de=r(684664);class pe{numChangedRows;constructor(e){this.numChangedRows=e}}class ce{#i;constructor(e){this.#i=(0,d.freeze)(e)}top(e,t){return new ce({...this.#i,queryNode:N.QueryNode.cloneWithTop(this.#i.queryNode,(0,E.parseTop)(e,t))})}using(...e){return new ue({...this.#i,queryNode:te.MergeQueryNode.cloneWithUsing(this.#i.queryNode,(0,Q.parseJoin)("Using",e))})}output(e){return new ce({...this.#i,queryNode:N.QueryNode.cloneWithOutput(this.#i.queryNode,(0,n.parseSelectArg)(e))})}outputAll(e){return new ce({...this.#i,queryNode:N.QueryNode.cloneWithOutput(this.#i.queryNode,(0,n.parseSelectAll)(e))})}}(0,x.preventAwait)(ce,"don't await MergeQueryBuilder instances directly. To execute the query you need to call `execute` when available.");class ue{#i;constructor(e){this.#i=(0,d.freeze)(e)}top(e,t){return new ue({...this.#i,queryNode:N.QueryNode.cloneWithTop(this.#i.queryNode,(0,E.parseTop)(e,t))})}whenMatched(){return this.#$([])}whenMatchedAnd(...e){return this.#$(e)}whenMatchedAndRef(e,t,r){return this.#$([e,t,r],!0)}#$(e,t){return new le({...this.#i,queryNode:te.MergeQueryNode.cloneWithWhen(this.#i.queryNode,se({isMatched:!0},e,t))})}whenNotMatched(){return this.#j([])}whenNotMatchedAnd(...e){return this.#j(e)}whenNotMatchedAndRef(e,t,r){return this.#j([e,t,r],!0)}whenNotMatchedBySource(){return this.#j([],!1,!0)}whenNotMatchedBySourceAnd(...e){return this.#j(e,!1,!0)}whenNotMatchedBySourceAndRef(e,t,r){return this.#j([e,t,r],!0,!0)}output(e){return new ue({...this.#i,queryNode:N.QueryNode.cloneWithOutput(this.#i.queryNode,(0,n.parseSelectArg)(e))})}outputAll(e){return new ue({...this.#i,queryNode:N.QueryNode.cloneWithOutput(this.#i.queryNode,(0,n.parseSelectAll)(e))})}#j(e,t=!1,r=!1){const i={...this.#i,queryNode:te.MergeQueryNode.cloneWithWhen(this.#i.queryNode,se({isMatched:!1,bySource:r},e,t))};return new(r?le:he)(i)}$call(e){return e(this)}$if(e,t){return e?t(this):new ue({...this.#i})}toOperationNode(){return this.#i.executor.transformQuery(this.#i.queryNode,this.#i.queryId)}compile(){return this.#i.executor.compileQuery(this.toOperationNode(),this.#i.queryId)}async execute(){const e=this.compile(),t=await this.#i.executor.executeQuery(e,this.#i.queryId);return e.query.output&&this.#i.executor.adapter.supportsOutput?t.rows:[new pe(t.numAffectedRows)]}async executeTakeFirst(){const[e]=await this.execute();return e}async executeTakeFirstOrThrow(e=S.NoResultError){const t=await this.executeTakeFirst();if(void 0===t){throw(0,S.isNoResultErrorConstructor)(e)?new e(this.toOperationNode()):e(this.toOperationNode())}return t}}(0,x.preventAwait)(ue,"don't await WheneableMergeQueryBuilder instances directly. To execute the query you need to call `execute`.");class le{#i;constructor(e){this.#i=(0,d.freeze)(e)}thenDelete(){return new ue({...this.#i,queryNode:te.MergeQueryNode.cloneWithThen(this.#i.queryNode,ae("delete"))})}thenDoNothing(){return new ue({...this.#i,queryNode:te.MergeQueryNode.cloneWithThen(this.#i.queryNode,ae("do nothing"))})}thenUpdate(e){return new ue({...this.#i,queryNode:te.MergeQueryNode.cloneWithThen(this.#i.queryNode,ae(e(new J({queryId:this.#i.queryId,executor:de.NOOP_QUERY_EXECUTOR,queryNode:F.UpdateQueryNode.createWithoutTable()}))))})}thenUpdateSet(...e){return this.thenUpdate((t=>t.set(...e)))}}(0,x.preventAwait)(le,"don't await MatchedThenableMergeQueryBuilder instances directly. To execute the query you need to call `execute` when available.");class he{#i;constructor(e){this.#i=(0,d.freeze)(e)}thenDoNothing(){return new ue({...this.#i,queryNode:te.MergeQueryNode.cloneWithThen(this.#i.queryNode,ae("do nothing"))})}thenInsertValues(e){const[t,r]=f(e);return new ue({...this.#i,queryNode:te.MergeQueryNode.cloneWithThen(this.#i.queryNode,ae(m.InsertQueryNode.cloneWith(m.InsertQueryNode.createWithoutInto(),{columns:t,values:r})))})}}(0,x.preventAwait)(he,"don't await NotMatchedThenableMergeQueryBuilder instances directly. To execute the query you need to call `execute` when available.");class fe{#i;constructor(e){this.#i=(0,d.freeze)(e)}selectFrom(e){return(0,i.createSelectQueryBuilder)({queryId:(0,Z.createQueryId)(),executor:this.#i.executor,queryNode:U.SelectQueryNode.createFrom((0,R.parseTableExpressionOrList)(e),this.#i.withNode)})}selectNoFrom(e){return(0,i.createSelectQueryBuilder)({queryId:(0,Z.createQueryId)(),executor:this.#i.executor,queryNode:U.SelectQueryNode.cloneWithSelections(U.SelectQueryNode.create(this.#i.withNode),(0,n.parseSelectArg)(e))})}insertInto(e){return new A({queryId:(0,Z.createQueryId)(),executor:this.#i.executor,queryNode:m.InsertQueryNode.create((0,R.parseTable)(e),this.#i.withNode)})}replaceInto(e){return new A({queryId:(0,Z.createQueryId)(),executor:this.#i.executor,queryNode:m.InsertQueryNode.create((0,R.parseTable)(e),this.#i.withNode,!0)})}deleteFrom(e){return new M({queryId:(0,Z.createQueryId)(),executor:this.#i.executor,queryNode:B.DeleteQueryNode.create((0,R.parseTableExpressionOrList)(e),this.#i.withNode)})}updateTable(e){return new J({queryId:(0,Z.createQueryId)(),executor:this.#i.executor,queryNode:F.UpdateQueryNode.create((0,R.parseTableExpression)(e),this.#i.withNode)})}mergeInto(e){return new ce({queryId:(0,Z.createQueryId)(),executor:this.#i.executor,queryNode:te.MergeQueryNode.create((0,R.parseAliasedTable)(e),this.#i.withNode)})}with(e,t){const r=H(e,t);return new fe({...this.#i,withNode:this.#i.withNode?X.cloneWithExpression(this.#i.withNode,r):X.create(r)})}withRecursive(e,t){const r=H(e,t);return new fe({...this.#i,withNode:this.#i.withNode?X.cloneWithExpression(this.#i.withNode,r):X.create(r,{recursive:!0})})}withPlugin(e){return new fe({...this.#i,executor:this.#i.executor.withPlugin(e)})}withoutPlugins(){return new fe({...this.#i,executor:this.#i.executor.withoutPlugins()})}withSchema(e){return new fe({...this.#i,executor:this.#i.executor.withPluginAtFront(new ee.WithSchemaPlugin(e))})}}},684664:(e,t,r)=>{r.r(t),r.d(t,{NOOP_QUERY_EXECUTOR:()=>o,NoopQueryExecutor:()=>n});var i=r(884432);class n extends i.QueryExecutorBase{get adapter(){throw new Error("this query cannot be compiled to SQL")}compileQuery(){throw new Error("this query cannot be compiled to SQL")}provideConnection(){throw new Error("this query cannot be executed")}withConnectionProvider(){throw new Error("this query cannot have a connection provider")}withPlugin(e){return new n([...this.plugins,e])}withPlugins(e){return new n([...this.plugins,...e])}withPluginAtFront(e){return new n([e,...this.plugins])}withoutPlugins(){return new n([])}}const o=new n},884432:(e,t,r)=>{r.r(t),r.d(t,{QueryExecutorBase:()=>a});var i=r(464580);class n{#K;#G;#_;constructor(){this.#K=new Promise(((e,t)=>{this.#_=t,this.#G=e}))}get promise(){return this.#K}resolve=e=>{this.#G&&this.#G(e)};reject=e=>{this.#_&&this.#_(e)}}const o=new Set;const s=(0,i.freeze)([]);class a{#H;constructor(e=s){this.#H=e}get plugins(){return this.#H}transformQuery(e,t){for(const r of this.#H){const i=r.transformQuery({node:e,queryId:t});if(i.kind!==e.kind)throw new Error(["KyselyPlugin.transformQuery must return a node","of the same kind that was given to it.",`The plugin was given a ${e.kind}`,`but it returned a ${i.kind}`].join(" "));e=i}return e}async executeQuery(e,t){return await this.provideConnection((async r=>{const i=await r.executeQuery(e),n=await this.#Y(i,t);return function(e,t){const{numAffectedRows:r}=e;if(void 0===r&&void 0===e.numUpdatedOrDeletedRows||void 0!==r&&void 0!==t.numAffectedRows)return;i="kysely:warning: outdated driver/plugin detected! QueryResult.numUpdatedOrDeletedRows is deprecated and will be removed in a future release.",o.has(i)||(o.add(i),console.log(i));var i}(i,n),n}))}async*stream(e,t,r){const i=new n,o=new n;this.provideConnection((async e=>(i.resolve(e),await o.promise))).catch((e=>i.reject(e)));const s=await i.promise;try{for await(const i of s.streamQuery(e,t))yield await this.#Y(i,r)}finally{o.resolve()}}async#Y(e,t){for(const r of this.#H)e=await r.transformResult({result:e,queryId:t});return e}}},464580:(e,t,r)=>{function i(e){return Array.isArray(e)||o(e)||u(e)?0===e.length:!!e&&0===Object.keys(e).length}function n(e){return"undefined"===typeof e||void 0===e}function o(e){return"string"===typeof e}function s(e){return"number"===typeof e}function a(e){return"boolean"===typeof e}function d(e){return null===e}function p(e){return e instanceof Date}function c(e){return"bigint"===typeof e}function u(e){return"undefined"!==typeof Buffer&&Buffer.isBuffer(e)}function l(e){return"function"===typeof e}function h(e){return"object"===typeof e&&null!==e}function f(e){return e instanceof ArrayBuffer||ArrayBuffer.isView(e)}function m(e){if(!h(e)||"[object Object]"!==function(e){if(null==e)return void 0===e?"[object Undefined]":"[object Null]";return O.call(e)}(e))return!1;if(null===Object.getPrototypeOf(e))return!0;let t=e;for(;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return Object.getPrototypeOf(e)===t}function N(e){return e[e.length-1]}function y(e){return Object.freeze(e)}function w(e){return v(e)?e:[e]}function g(e){return v(e)?e:y([e])}function v(e){return Array.isArray(e)}function x(e){return e}function b(e,t){return v(e)&&v(t)?function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(!b(e[r],t[r]))return!1;return!0}(e,t):h(e)&&h(t)?function(e,t){if(u(e)&&u(t))return i=e,n=t,0===Buffer.compare(i,n);if(p(e)&&p(t))return r=t,e.getTime()===r.getTime();var r;var i,n;return function(e,t){const r=Object.keys(e),i=Object.keys(t);if(r.length!==i.length)return!1;for(const n of r)if(!b(e[n],t[n]))return!1;return!0}(e,t)}(e,t):e===t}r.r(t),r.d(t,{asArray:()=>w,asReadonlyArray:()=>g,compare:()=>b,freeze:()=>y,getLast:()=>N,isArrayBufferOrView:()=>f,isBigInt:()=>c,isBoolean:()=>a,isBuffer:()=>u,isDate:()=>p,isEmpty:()=>i,isFunction:()=>l,isNull:()=>d,isNumber:()=>s,isObject:()=>h,isPlainObject:()=>m,isReadonlyArray:()=>v,isString:()=>o,isUndefined:()=>n,noop:()=>x});const O=Object.prototype.toString},210922:(e,t,r)=>{function i(e,t){Object.defineProperties(e.prototype,{then:{enumerable:!1,value:()=>{throw new Error(t)}}})}r.r(t),r.d(t,{preventAwait:()=>i})},426048:(e,t,r)=>{r.r(t),r.d(t,{createQueryId:()=>n});const i=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9"];function n(){return new o}class o{#X;get queryId(){return void 0===this.#X&&(this.#X=function(e){let t="";for(let r=0;r<e;++r)t+=i[~~(Math.random()*i.length)];return t}(8)),this.#X}}},254725:(e,t,r)=>{r.r(t),r.d(t,{LayerTypeId:()=>f,MemoMapTypeId:()=>m,annotateLogs:()=>w,annotateSpans:()=>g,build:()=>v,buildWithMemoMap:()=>Me,buildWithScope:()=>x,catchAll:()=>b,catchAllCause:()=>O,context:()=>S,die:()=>W,dieSync:()=>C,discard:()=>q,effect:()=>T,effectContext:()=>z,effectDiscard:()=>k,empty:()=>I,extendScope:()=>E,fail:()=>A,failCause:()=>R,failCauseSync:()=>D,failSync:()=>Q,fiberRefLocallyScopedWith:()=>ie,flatMap:()=>B,flatten:()=>L,fresh:()=>P,function:()=>M,isFresh:()=>y,isLayer:()=>N,launch:()=>F,locally:()=>ee,locallyEffect:()=>Z,locallyScoped:()=>re,locallyWith:()=>te,makeMemoMap:()=>Pe,map:()=>V,mapError:()=>J,match:()=>U,matchCause:()=>$,memoize:()=>j,merge:()=>K,mergeAll:()=>G,orDie:()=>_,orElse:()=>H,parentSpan:()=>qe,passthrough:()=>Y,project:()=>X,provide:()=>ve,provideMerge:()=>xe,retry:()=>ne,scope:()=>oe,scoped:()=>se,scopedContext:()=>de,scopedDiscard:()=>ae,service:()=>pe,setClock:()=>We,setConfigProvider:()=>Ce,setRequestBatching:()=>Te,setRequestCache:()=>ze,setRequestCaching:()=>ke,setScheduler:()=>Ie,setTracer:()=>Ae,setTracerEnabled:()=>Qe,setTracerTiming:()=>Re,setUnhandledErrorLogLevel:()=>De,span:()=>Ee,succeed:()=>ce,succeedContext:()=>ue,suspend:()=>le,sync:()=>he,syncContext:()=>fe,tap:()=>me,tapError:()=>Ne,tapErrorCause:()=>ye,toRuntime:()=>we,toRuntimeWithMemoMap:()=>ge,unwrapEffect:()=>Oe,unwrapScoped:()=>Se,withParentSpan:()=>Le,withSpan:()=>Be,zipWith:()=>be});var i=r(689702),n=r(114969),o=r(672620),s=r(344862),a=r(858657),d=r(277568),p=(r(361369),r(227561),r(66932)),c=r(848464),u=(r(95807),r(127514));p.CooperativeYielding,p.Interruption,p.OpSupervision,p.RuntimeMetrics,p.WindDown,p.CooperativeYielding,p.Interruption,p.OpSupervision,p.RuntimeMetrics,p.WindDown;var l=r(502787),h=r(71108);const f=d.LayerTypeId,m=d.MemoMapTypeId,N=d.isLayer,y=d.isFresh,w=d.annotateLogs,g=d.annotateSpans,v=d.build,x=d.buildWithScope,b=d.catchAll,O=d.catchAllCause,S=d.context,W=d.die,C=d.dieSync,q=d.discard,T=d.fromEffect,k=d.fromEffectDiscard,z=d.fromEffectContext,I=d.empty,E=d.extendScope,A=d.fail,Q=d.failSync,R=d.failCause,D=d.failCauseSync,B=d.flatMap,L=d.flatten,P=d.fresh,M=d.fromFunction,F=d.launch,V=d.map,J=d.mapError,U=d.match,$=d.matchCause,j=d.memoize,K=d.merge,G=d.mergeAll,_=d.orDie,H=d.orElse,Y=d.passthrough,X=d.project,Z=d.locallyEffect,ee=d.fiberRefLocally,te=d.fiberRefLocallyWith,re=d.fiberRefLocallyScoped,ie=d.fiberRefLocallyScopedWith,ne=d.retry,oe=d.scope,se=d.scoped,ae=d.scopedDiscard,de=d.scopedContext,pe=d.service,ce=d.succeed,ue=d.succeedContext,le=d.suspend,he=d.sync,fe=d.syncContext,me=d.tap,Ne=d.tapError,ye=d.tapErrorCause,we=d.toRuntime,ge=d.toRuntimeWithMemoMap,ve=d.provide,xe=d.provideMerge,be=d.zipWith,Oe=d.unwrapEffect,Se=d.unwrapScoped,We=e=>ae(a.fiberRefLocallyScopedWith(s.currentServices,i.add(n.clockTag,e))),Ce=e=>d.scopedDiscard(a.withConfigProviderScoped(e)),qe=e=>d.succeedContext(i.make(u.spanTag,e)),Te=e=>ae(a.fiberRefLocallyScoped(o.currentRequestBatching,e)),ke=e=>ae(a.fiberRefLocallyScoped(l.currentCacheEnabled,e)),ze=e=>ae(o.isEffect(e)?o.flatMap(e,(e=>a.fiberRefLocallyScoped(l.currentCache,e))):a.fiberRefLocallyScoped(l.currentCache,e)),Ie=e=>ae(a.fiberRefLocallyScoped(h.currentScheduler,e)),Ee=(e,t)=>(t=u.addSpanStackTrace(t),d.scoped(u.spanTag,t?.onEnd?o.tap(a.makeSpanScoped(e,t),(e=>a.addFinalizer((r=>t.onEnd(e,r))))):a.makeSpanScoped(e,t))),Ae=e=>d.scopedDiscard(a.withTracerScoped(e)),Qe=e=>ae(a.fiberRefLocallyScoped(o.currentTracerEnabled,e)),Re=e=>ae(a.fiberRefLocallyScoped(o.currentTracerTimingEnabled,e)),De=e=>ae(a.fiberRefLocallyScoped(o.currentUnhandledErrorLogLevel,e)),Be=d.withSpan,Le=d.withParentSpan,Pe=d.makeMemoMap,Me=d.buildWithMemoMap}}]);
//# sourceMappingURL=588.js.map